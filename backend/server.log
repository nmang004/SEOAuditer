
> seo-director-backend@1.0.0 dev
> ts-node-dev --respawn --transpile-only src/index.ts

[INFO] 06:29:02 ts-node-dev ver. 2.0.0 (using ts-node ver. 10.9.2, typescript ver. 5.8.3)
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:29:03.162 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:29:04.213 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:29:04.214 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:29:04.215 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:29:04.319 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:29:04.319 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCUexwRwRZc54X1\nzTaGCriFuW9bC/yzux4lAZ34MQDGYj3lRfnEt+0BXHjq5nZQ2WxcftTH+RtqOjR1\ngM7TwkNA9bt2YnM3GqXJXyqul+7Al7YU6Fa44FwHEVWRd8DVREFJ0M2bXDb7BMWU\nXVC7Gp8FsViT5gZb3+w9ALb7+O00llWE5Rv++WheWy7A+Rryub5jmXv5kNtRIRPY\n6gqqjKugI/m/VsJ8DG4bqMyuhSMJnD+YWXnWlT//XEhYwBWKHcRm0B9q7e1W/A/z\n2nwOMc9NPkGJdDhnBbTq8xlqjFmthn4G+IogDbOgafWkfoPX41pUaqEVIHh+pqHk\nGpmhOvFTAgMBAAECggEAC8XxNVUunUI8ZH+XlaxO8keAVWNPb77kBoIo0O+txI0w\npDfWtKryz3tSGSoZ8pIy3eiunYaajmM8Gp8Sh0bthz6U1S+8O//QanWx0DM62qmM\n5f6ANduQYH0W4FhzAVYOqTg1vV5j+6Zmtjtp9dQIDO8Be4SvN2S7eiDO4Y7c3CD6\njagXeJHlwUwQ99HN+G+d/UvXSjXtwtISJFBXY6y7hV5wm1AE4w/Y7i7ZgN1sQcrG\nHds7qalbuSNvAJaBA27JvaLrd+wMjY3A17orKQ8Z0PSydt5FnEnHEZvwBBjJ8zhI\nejt8B+IiTNR8JzCy+/T7YMR9CaAP797E7c+3Q6T4EQKBgQDGZa/9lWWqg6vR2bbR\n1SurvE7IWu9SkEDwAG8I0d7BY3ulSUvUnV+G1N+Lvr7LHAx9KTsdm7yo0vR2r2If\nYFE87u5ZntSw7nyC0QtabDL6G6sS+RJv7amlaCDeANAJ/VOTax85dxKN3IXus/NG\ndc8BV+3nXJB3BfEZgbUxY2sGowKBgQC/l0f7CG9kueiegP+LF7Z/Yhvli80opt9a\niMW0uRIPFNRfgifJuxIXh25m2/lslWb5NYlWAM/mr4OF5IIRKbwdoOLgPDKh/EAU\ncLguD4uo7V5NDh3TFmTWLGMpD35iW99H/OBF4LcORKDCD12jLekga0OD2GHRWA/E\n/+kPskkFkQKBgDNTvXsyenHpzLrmw2h36OtuNUeaVw4aKeKtigxTF3kavrNdShQA\nfuVID2l8+KldYVHEJ/oZ/24B3aMS7qTFa18DRYDEGayIlofVg0VqdqnEHLc03vM8\nHkafsNkehrP+6O9bqGFaj99JrRC7V3XkJqDnWbIgfXN9gwmhR/o2CUtXAoGAeOcx\nsFPhX9IF3siO+qqLKxWxfwja/bVYq5w2D1be8490eZT8IMyhnSGE5PoaC5C4e7ly\nIki+6deGix7piYUpxhS6N0Elvp0dnwiG4eJDguXQJZYr8gJmvdUi+k1htxY88AO/\nT7mAK0vZmrzxnUEipaeq4m/RQrdstCe+Xn5moFECgYEAtsPYqKLpQs2ip55c+VEQ\nC3bSLvuKJWABMiqXKL5axxdWnkIIWLbuqRAS74/G8ju3N89aPzlPlSjDLUnu3AVr\n33XJ4NBV5pPJnT+Rzjq0HdHp7p3VDWGu9SrVud+z2gvcIxcUqo4FifC1zQEFqaJw\naerRwGI3UNFyEBSlkBsEWmY=\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlHscEcEWXOeF9c02hgq4\nhblvWwv8s7seJQGd+DEAxmI95UX5xLftAVx46uZ2UNlsXH7Ux/kbajo0dYDO08JD\nQPW7dmJzNxqlyV8qrpfuwJe2FOhWuOBcBxFVkXfA1URBSdDNm1w2+wTFlF1Quxqf\nBbFYk+YGW9/sPQC2+/jtNJZVhOUb/vloXlsuwPka8rm+Y5l7+ZDbUSET2OoKqoyr\noCP5v1bCfAxuG6jMroUjCZw/mFl51pU//1xIWMAVih3EZtAfau3tVvwP89p8DjHP\nTT5BiXQ4ZwW06vMZaoxZrYZ+BviKIA2zoGn1pH6D1+NaVGqhFSB4fqah5BqZoTrx\nUwIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:29:04.667 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:29:04.740 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:29:04.740 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:29:04.741 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:29:04.742 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:29:04.743 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"0ms","timestamp":"2025-06-05 06:29:04.799 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:29:04.804 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:29:04.804 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:29:04.814 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:29:04.814 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:29:04.814 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:29:04.819 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:29:04.820 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:29:04.921 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:29:04.921 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:29:04.921 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:29:04.922 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:29:04.922 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:29:04.922 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:29:04.922 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:29:04.928 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:29:04.930 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:29:04.930 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:29:04.930 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:29:04.930 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:29:04.931 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:29:04.931 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:29:04.931 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:29:04.932 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:29:04.932 AM"}
✅ Server started successfully on port 4000
[0mGET /api/health [32m200[0m 1.459 ms - 103[0m
[32m[32minfo[32m[39m: 	[32mStarting email verification send process[39m {"email":"final-test@example.com","name":"Final Test User","timestamp":"2025-06-05 06:29:32.241 AM","userId":"c73d3962-a1dd-4506-843f-0338a1d71937"}
[32m[32minfo[32m[39m: 	[32mVerification token found, attempting to send email[39m {"email":"final-test@example.com","timestamp":"2025-06-05 06:29:32.243 AM","tokenLength":64,"userId":"c73d3962-a1dd-4506-843f-0338a1d71937"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail called[39m {"name":"Final Test User","timestamp":"2025-06-05 06:29:32.243 AM","to":"final-test@example.com","verificationToken":"9fbb9981..."}
[32m[32minfo[32m[39m: 	[32mGenerated verification URL[39m {"timestamp":"2025-06-05 06:29:32.263 AM","verificationUrl":"https://seoauditer.netlify.app/verify-email/9fbb99814f4c13a6c99909bc712040d406526a6b28df815299e8f3f799e075c2"}
[32m[32minfo[32m[39m: 	[32mEmail template rendered successfully[39m {"htmlLength":8516,"subject":"Welcome to SEO Director! Please verify your email","textLength":767,"timestamp":"2025-06-05 06:29:32.263 AM"}
[32m[32minfo[32m[39m: 	[32msendEmail called[39m {"initialized":true,"providerName":"SendGrid","subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:29:32.263 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAttempting to send email via SendGrid to final-test@example.com[39m {"timestamp":"2025-06-05 06:29:32.263 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid send method called[39m {"apiKeyLength":69,"apiKeyPrefix":"SG.Y6rjeWf","configured":true,"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:29:32.263 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid send details[39m {"environment":"development","fromEmail":"admin@seodirector.co","fromName":"SEO Director","timestamp":"2025-06-05 06:29:32.264 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAbout to call SendGrid API[39m {"from":"SEO Director <admin@seodirector.co>","msgStructure":["to","from","subject","html","text","trackingSettings","tracking_settings","headers"],"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:29:32.264 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid API call completed[39m {"messageId":"RdDA0HccRjizvZq2BVIu4Q","responseBody":"","responseHeaders":{"access-control-allow-headers":"Authorization, Content-Type, On-behalf-of, x-sg-elas-acl","access-control-allow-methods":"POST","access-control-allow-origin":"https://sendgrid.api-docs.io","access-control-max-age":"600","cache-control":"no-cache","connection":"keep-alive","content-length":"0","content-security-policy":"frame-ancestors 'none'","date":"Thu, 05 Jun 2025 10:29:32 GMT","referrer-policy":"strict-origin-when-cross-origin","server":"nginx","strict-transport-security":"max-age=31536000; includeSubDomains","x-content-type-options":"no-sniff","x-message-id":"RdDA0HccRjizvZq2BVIu4Q","x-no-cors-reason":"https://sendgrid.com/docs/Classroom/Basics/API/cors.html"},"statusCode":202,"timestamp":"2025-06-05 06:29:32.410 AM"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully via SendGrid to final-test@example.com[39m {"messageId":"RdDA0HccRjizvZq2BVIu4Q","statusCode":202,"timestamp":"2025-06-05 06:29:32.411 AM"}
[32m[32minfo[32m[39m: 	[32mProvider send result[39m {"result":true,"timestamp":"2025-06-05 06:29:32.411 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully to final-test@example.com via SendGrid[39m {"timestamp":"2025-06-05 06:29:32.411 AM"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail result[39m {"result":true,"timestamp":"2025-06-05 06:29:32.411 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail verification sent successfully[39m {"email":"final-test@example.com","timestamp":"2025-06-05 06:29:32.411 AM","userId":"c73d3962-a1dd-4506-843f-0338a1d71937"}
[32m[32minfo[32m[39m: 	[32mSecurity event[39m {"email":"final-test@example.com","event":"user_registered","ipAddress":"::1","timestamp":"2025-06-05 06:29:32.420 AM","userAgent":"node-fetch/1.0 (+https://github.com/bitinn/node-fetch)","userId":"c73d3962-a1dd-4506-843f-0338a1d71937"}
[32m[32minfo[32m[39m: 	[32mUser registered successfully[39m {"email":"final-test@example.com","ipAddress":"::1","timestamp":"2025-06-05 06:29:32.421 AM","userId":"c73d3962-a1dd-4506-843f-0338a1d71937"}
[0mPOST /api/auth/register [32m201[0m 433.700 ms - 336[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749119384627_6xnylajym","ip":"::1","timestamp":"2025-06-05 06:29:44.627 AM","tokenPrefix":"9fbb9981...","userAgent":"curl/8.7.1"}
[33m[33mwarn[33m[39m: 	[33mToken validation failed - not found or expired[39m {"hashedTokenPrefix":"9b295716...","purpose":"email_verification","timestamp":"2025-06-05 06:29:44.717 AM","validationTimeMs":89}
[33m[33mwarn[33m[39m: 	[33mEmail verification failed - invalid token[39m {"correlationId":"verify_1749119384627_6xnylajym","error":"Invalid or expired verification token","timestamp":"2025-06-05 06:29:44.717 AM","tokenPrefix":"9fbb9981..."}
[0mGET /api/secure-auth/verify-email/9fbb99814f4c13a6c99909bc712040d406526a6b28df815299e8f3f799e075c2 [33m400[0m 92.928 ms - 65[0m
[INFO] 06:32:00 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/services/SecureTokenService.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:32:00.386 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:00.387 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:00.387 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:32:00.387 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:32:00.396 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:32:00.396 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:32:00.399 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:32:01.402 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:32:01.402 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:32:01.403 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:32:01.403 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:32:01.410 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:32:01.410 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:32:01.413 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:32:01.413 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:32:02.150 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:32:02.866 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:32:02.868 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:32:02.868 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:32:02.888 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:32:02.888 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDDCxzNbVtPunHh\nVchTNSUHRuSMkZ5ErKkHq+CL/cGUIndiDReNLgIftmlo1LhA8j+t6q80DJnKIGSK\noCf6LIsDaKEIhjM9ScM4Fj6wRt29qwFPoVhOGCevJqp0eOCh0//wR3amhyYa6jZ+\nTlknZBLoE6mOTvsX5+QgbLplNOVqRJ23cvufqT1VRg6HuX1E/7TF+T3I+8gq4it6\nBZD0xF7fThq4Ue5dqtZ/nZs3r5RBRDWKdOhaUA52e7yE2oVK1MN4lkoB8ZMAcGri\ndSiEXK4nfDJGzjy0uoi6yjecdp+AcDi5QV88SVdSZMLGQxXSMycU+KhtD9k8QfHR\nQ5c82+89AgMBAAECggEAKiJE6xXEI4GN51U+LMduw9crOTid3Y0FCMy2+dbsEgGu\nE4brfwqg19Pyinxlf1Y1rm7jwVU1hcYgohe9+xvTPf3Ex9Ah0owUOZIIodD1Ruth\noZ+jsV8jd4FdUkLol9zxzajKd2f7sdXFxtxLAyjpsqvItZ7XPE9SZzTFwWY/Zwih\ngLTCwBpE4IsLBjt7g6dEzJERP1s50rfyV1qpvpHssj3P3dg6iHfqPIWIwLCJAntM\nBmz/qfQmfF4pC88BAgIydY9bkuqjGJg3z51PxvaV4pZyqRcpgPZQaDyIAWG2vArO\nOCM04sVVbDG4uPuVeMPluL906N2JqYOY/sGhuaP1awKBgQD5QbFd7PUHgkBIkrwl\nBtLdX6bk5QzoURfRu0IQiqOIFJDMAfxUrOFUlU4RveSGsxJJSfd/X9caX75x0sBP\nz6v2+zu8aVdwQVp2t9tx0J0o5r12sG322I/zx5YlO8kCUncPkQBb3SGuz3nctSuI\n/Ak68wOnfj+b/X93hPHMwWwWkwKBgQDIUfLYiACUxx3nIgzx/C3BYzIjEd8ju4+e\nQzdjpDSdweWn+P41+zSrID7JsOJ75v3YgtVXte9W3O193oCl/SY0XiWiA9zHHDjR\ncUE4jhzBayj61Fs3mZKTUAn7G3kqCTYVlY2+tGG+fWr+wSK3ftQj56NwzVplftIO\nMiAAb0807wKBgG/sY6x9XnmEr0DnQryNl9n3vYVCpM0cvMlcgInU9yF/upUgvyF2\nj6ffczLcReWGO0vVfuEfNAOPwoBx1hEAe4NnxKcR1kV90xVD8bHlruxSz/ifuIED\nNYCNuon1kokMZpIC1lpprVpFp77HS0kzgyGJRbbMJdvxtG8Cr2D16YcpAoGBAJvW\nZL3ez9TuMm0lKDz4mf/gU5jExnrd5xSP5f82N1ijBy5tnhYQnyChrTbqzMbnJIPT\nBHV/q/o/VOKeviZjkd0bgNtRdefQJMOK/9ondGdkHjVEDtJqPoUrtxgKf3AcSl7w\nQZ0iZwfyOdKGHaPynsZv5c5TcweSaYdxp0OvVEcxAoGBAL3OInrJe/Ofogfe3+T/\n7zdTmh1qo2tB9Ybgqa4tB7Ov0lvDVbFRqnAM7K7cY6/qdML8PENn1O4ZS1XG8toM\ny5yTyv9d7t9YeijNxEwIPmg2QUw7uSFamF4fo/Sv3Lg6HnCzh6CmcrOmNlzc5YTN\nMoZJLq7ohsHGGHb16DjZGhly\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwwsczW1bT7px4VXIUzUl\nB0bkjJGeRKypB6vgi/3BlCJ3Yg0XjS4CH7ZpaNS4QPI/reqvNAyZyiBkiqAn+iyL\nA2ihCIYzPUnDOBY+sEbdvasBT6FYThgnryaqdHjgodP/8Ed2pocmGuo2fk5ZJ2QS\n6BOpjk77F+fkIGy6ZTTlakSdt3L7n6k9VUYOh7l9RP+0xfk9yPvIKuIregWQ9MRe\n304auFHuXarWf52bN6+UQUQ1inToWlAOdnu8hNqFStTDeJZKAfGTAHBq4nUohFyu\nJ3wyRs48tLqIuso3nHafgHA4uUFfPElXUmTCxkMV0jMnFPiobQ/ZPEHx0UOXPNvv\nPQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:32:03.039 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:32:03.098 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:32:03.098 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:32:03.099 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:32:03.101 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:32:03.102 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 06:32:03.138 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:32:03.143 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:32:03.143 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:03.145 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:32:03.145 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:32:03.145 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:32:03.149 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:32:03.149 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:32:03.250 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:32:03.250 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:32:03.250 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:32:03.251 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:32:03.251 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:32:03.251 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:32:03.251 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:32:03.257 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:32:03.260 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:32:03.260 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:32:03.260 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:32:03.260 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:32:03.261 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:32:03.261 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:32:03.261 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:32:03.261 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:32:03.261 AM"}
✅ Server started successfully on port 4000
[32m[32minfo[32m[39m: 	[32mStarting email verification send process[39m {"email":"debug-test@example.com","name":"Debug Test User","timestamp":"2025-06-05 06:32:16.349 AM","userId":"3b645177-8140-41d0-8975-d664b98cf60e"}
[32m[32minfo[32m[39m: 	[32mVerification token found, attempting to send email[39m {"email":"debug-test@example.com","timestamp":"2025-06-05 06:32:16.350 AM","tokenLength":64,"userId":"3b645177-8140-41d0-8975-d664b98cf60e"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail called[39m {"name":"Debug Test User","timestamp":"2025-06-05 06:32:16.350 AM","to":"debug-test@example.com","verificationToken":"3e4844a8..."}
[32m[32minfo[32m[39m: 	[32mGenerated verification URL[39m {"timestamp":"2025-06-05 06:32:16.352 AM","verificationUrl":"https://seoauditer.netlify.app/verify-email/3e4844a8e696cbde067fd43a6d73425fbc49432657d881bc7640420fb099d8bd"}
[32m[32minfo[32m[39m: 	[32mEmail template rendered successfully[39m {"htmlLength":8516,"subject":"Welcome to SEO Director! Please verify your email","textLength":767,"timestamp":"2025-06-05 06:32:16.352 AM"}
[32m[32minfo[32m[39m: 	[32msendEmail called[39m {"initialized":true,"providerName":"SendGrid","subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:32:16.352 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAttempting to send email via SendGrid to debug-test@example.com[39m {"timestamp":"2025-06-05 06:32:16.353 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid send method called[39m {"apiKeyLength":69,"apiKeyPrefix":"SG.Y6rjeWf","configured":true,"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:32:16.353 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid send details[39m {"environment":"development","fromEmail":"admin@seodirector.co","fromName":"SEO Director","timestamp":"2025-06-05 06:32:16.353 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAbout to call SendGrid API[39m {"from":"SEO Director <admin@seodirector.co>","msgStructure":["to","from","subject","html","text","trackingSettings","tracking_settings","headers"],"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:32:16.353 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid API call completed[39m {"messageId":"SOTsJ-EcS7iVImuJtPTS3A","responseBody":"","responseHeaders":{"access-control-allow-headers":"Authorization, Content-Type, On-behalf-of, x-sg-elas-acl","access-control-allow-methods":"POST","access-control-allow-origin":"https://sendgrid.api-docs.io","access-control-max-age":"600","cache-control":"no-cache","connection":"keep-alive","content-length":"0","content-security-policy":"frame-ancestors 'none'","date":"Thu, 05 Jun 2025 10:32:16 GMT","referrer-policy":"strict-origin-when-cross-origin","server":"nginx","strict-transport-security":"max-age=31536000; includeSubDomains","x-content-type-options":"no-sniff","x-message-id":"SOTsJ-EcS7iVImuJtPTS3A","x-no-cors-reason":"https://sendgrid.com/docs/Classroom/Basics/API/cors.html"},"statusCode":202,"timestamp":"2025-06-05 06:32:16.535 AM"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully via SendGrid to debug-test@example.com[39m {"messageId":"SOTsJ-EcS7iVImuJtPTS3A","statusCode":202,"timestamp":"2025-06-05 06:32:16.536 AM"}
[32m[32minfo[32m[39m: 	[32mProvider send result[39m {"result":true,"timestamp":"2025-06-05 06:32:16.536 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully to debug-test@example.com via SendGrid[39m {"timestamp":"2025-06-05 06:32:16.536 AM"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail result[39m {"result":true,"timestamp":"2025-06-05 06:32:16.536 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail verification sent successfully[39m {"email":"debug-test@example.com","timestamp":"2025-06-05 06:32:16.536 AM","userId":"3b645177-8140-41d0-8975-d664b98cf60e"}
[32m[32minfo[32m[39m: 	[32mSecurity event[39m {"email":"debug-test@example.com","event":"user_registered","ipAddress":"::1","timestamp":"2025-06-05 06:32:16.542 AM","userAgent":"node-fetch/1.0 (+https://github.com/bitinn/node-fetch)","userId":"3b645177-8140-41d0-8975-d664b98cf60e"}
[32m[32minfo[32m[39m: 	[32mUser registered successfully[39m {"email":"debug-test@example.com","ipAddress":"::1","timestamp":"2025-06-05 06:32:16.542 AM","userId":"3b645177-8140-41d0-8975-d664b98cf60e"}
[0mPOST /api/auth/register [32m201[0m 443.999 ms - 336[0m
[INFO] 06:32:56 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/auth-rs256.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:32:56.133 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:56.134 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:56.134 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:32:56.134 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:32:56.136 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:32:56.136 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:32:56.137 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:32:57.137 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:32:57.138 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:32:57.138 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:32:57.138 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:32:57.145 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:32:57.145 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:32:57.145 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:32:57.146 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:32:57.807 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:32:58.541 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:32:58.543 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:32:58.543 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:32:58.561 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:32:58.562 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCzp5GrkejLWPjp\nxNccXkMoKh7paTM9GwTQJiNWt8iyafumiJBnODpOiP986mEr3UFPInoeR0/zgs58\nceC650LMrAuvgjIFMsNhD3mIbPu8lAlKKlLrNwN4yKJ9PD9/lcXXSSaxcAVKYjcv\nOaE/3RJfOTS6olF2DKv6z2P8IdFT3iZO+iiivdM9PVpswBtc/gCqq6Qgld/6dKmP\nyePWX066cKaS7Scx92pPZWXbCmOTb49sRWQv8+YwcEMI1b7v2LtD5bGUVYy4+b1N\nfQf9tA+k51YuyRxULc5Elp03ExmSKPDF3Atn2/OxG0CKFmuIA5sdM/0mr4ssY8rF\nGD6TgYx7AgMBAAECggEAOQzH9fdOOTDmTnnrI3+NjPYfPdjh5BAt7ZmG1FVlXr7I\nIqCwVo7k+SaJF1ZoiCDpSeN1ayMTMQ2DW8Jf7opczJj/1vqdvsfZgnuDCP8uy7oo\n3wvkq/wa1qLD8sgMlAvwOQbqSiN8Epxw0MbYvWqLGIEWjQPZoYaxoGJ2ak0k56AV\nLSBTS/afRztpWonFaryLtPoQgjZ9lHW8DwNZml0cCqJnCg9dx61D3rU1ByaUV5Fk\nLNlEQWbaced6sNnUJxDenhE/EULM2RVln+c1vqt0AzxcTcDfbhxdBu+N+u9g2OPU\ni2q4NMidXozKFfRFN71DnwKDhp9GcXuOmwtW0DWAmQKBgQDz79kVWJLOYbo6NeId\nDYLSsIo8cRmfPSMuX0RuKgVTF68L63BJnr29i5faYBgs189FzrbGlzldM+XIOJDu\n2+nofX5JxgnYyVZp/yocXYLgDNyUSWyuMyO/axbiqcGHENLHsaeB3a86n1OIEhOz\nTndxPq4CZVO1MpMh41ymunqzKQKBgQC8ie4dG8H9samIyOoDDWhK0ofUHUuhSJ88\nI2W79szOiaadI7Wfsec1iFuflnr5pqmb0C6f07860s4Q2YAYzuTVL8/bWqtBPncZ\n5N0/jmPrL7OGcCyoTNhlyeNay73C5MTFWK5YZ18clOZJYF69kDH5olI19TQKqd2M\nyQiEvm87AwKBgBEsg7YTBFLvYnMStBajiuBWeYUD2W/yl/V9042F+9X7xuEp9D/a\nozUjDM/dEBaoIvmhMhENOIatTrIn+Vw3s2Ig47FB9hODKUhRJJ/WnY40mZr/CF3D\nT/L8ESJoHS3rK0vP4CEugFW6PeFIlIZ9Mb+RUCLvC1Ooed9a6Hz8iALxAoGAVQq+\nHeEcYotVlj5R16ifh0hpPhMsvwYb1St+QwdyoCLUxYKK9Qpw6OOluFlPBPbZAFAq\nB6uiUS0vB8ijkA0aiNK1JhNCtf4wCL0D0xwuE7KDfrtwWUW4QkmLRLQr1xILc5yp\nn3SZITJEoYpXkZfOAvTlsjL1E25FYbB4KDAhyfMCgYAp0kV8Rt0s3jAPG6Hqum6k\nJeRBuMVcQC1HBhsz63IwBJ2L0coM4X6rFuNMftbVubPXKBxMMUCbUX2IPC07ebfv\n85f1XgjgbrVvSWbLIGMiIu3IGCit+Cz0716suE3ZIeprK8lCyvFvjXs5FvxfDMPp\nOqHDLc/Ms2GzHgSlHBmlTg==\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAs6eRq5Hoy1j46cTXHF5D\nKCoe6WkzPRsE0CYjVrfIsmn7poiQZzg6Toj/fOphK91BTyJ6HkdP84LOfHHguudC\nzKwLr4IyBTLDYQ95iGz7vJQJSipS6zcDeMiifTw/f5XF10kmsXAFSmI3LzmhP90S\nXzk0uqJRdgyr+s9j/CHRU94mTvooor3TPT1abMAbXP4AqqukIJXf+nSpj8nj1l9O\nunCmku0nMfdqT2Vl2wpjk2+PbEVkL/PmMHBDCNW+79i7Q+WxlFWMuPm9TX0H/bQP\npOdWLskcVC3ORJadNxMZkijwxdwLZ9vzsRtAihZriAObHTP9Jq+LLGPKxRg+k4GM\newIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:32:58.663 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:32:58.717 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:32:58.718 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:32:58.719 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:32:58.719 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:32:58.719 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"2ms","timestamp":"2025-06-05 06:32:58.744 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:32:58.747 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:32:58.747 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:58.748 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:32:58.749 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:32:58.749 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:32:58.752 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:32:58.752 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:32:58.854 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:32:58.854 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:32:58.854 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:32:58.855 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:32:58.855 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:32:58.855 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:32:58.855 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:32:58.862 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:32:58.866 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:32:58.866 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:32:58.866 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:32:58.866 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:32:58.866 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:32:58.866 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:32:58.867 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:32:58.867 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:32:58.867 AM"}
✅ Server started successfully on port 4000
[INFO] 06:33:44 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/auth-rs256.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:33:44.959 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:33:44.963 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:33:44.963 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:33:44.963 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:33:44.981 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:33:44.982 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:33:44.988 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:33:45.990 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:33:45.991 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:33:45.993 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:33:45.993 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:33:46.000 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:33:46.000 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:33:46.001 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:33:46.001 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:33:46.693 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:33:47.394 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:33:47.396 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:33:47.396 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:33:47.415 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:33:47.415 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCpga+r2PXoPJhF\n+NG6ni2m8NMk0jXeCBnax/rQzOnAmTarijCjkmPDC4NWLeul5UtCg6z1nY1yJYSx\nvtJGkWQoyk1DQV2FTdW6EucgTGWhuo1TbIpmmzuWV86MBYokDAjz/J7Yw/fdodeM\nsIJNKBVUtQ61qQsp3c2nQzvwAODkDtSqotZ/d7Weg8CNtH9Wo549FtGl6+m0k5aN\nbCeoSVV81pI9Vf5Wf7/a8kwXdyKYP/KEZdKAPLlvQdDbq0is+lWTL6SfaUoWmlPE\nna8spBJnRid7wQJtO7IK+Fr5iCczSjWmynHAHfVaYEuW4Un/cWYkRQUoe4zrkRZ1\n0TAixi0nAgMBAAECggEACEueaeCfBRkm8tDNHBtO12tGSuovW7ASXEpYlgkFpfjO\n4vSSLncd2Gjtqeb5E35Hz6mQlPTQ36rs7waaf+5iJfSqylAzxzAIy1l5XLqs2X/3\n3vTM8V3GrbQMtijDBWzsr+j5FVls743SrtdS+9Bx3eio5q8g45EFOajsgvGFZVdJ\nl8yVVLixCR7LAsgGCfVQScT3MbIQy6Yl3nL69kCnNW4oFpxHFI2vyIYwijkfv0Xx\n6Btd9TQcTF2Hgx5zLSBzVXPiEcCB48ItbKUQvI9kAurLtlbrMIGc8fgIbEDqk4FX\nQUjIiWL4lXzluUekJZaNG6REqkWW0MdFhK94FT+t4QKBgQDdc/ptY2ySrwo62qFD\nlYpqN3gIwlqL0x1EeBKo49dtmX9KryYtVqh4HwR9FSuUr58oqiU043fg0kvjwNqz\nE2WcMRqwPaw7ykfSKOAgu9jn3hKDdg0ZDB9l8NQ89x1Gew3IXWG6lDQsdYhrWOTk\nwntXGmw/PIiyYPgLgTyr6GC8BwKBgQDD8yhCsUn381L35WS7yfu+a6lFPNii7uO3\nAG1Qo+spepcGwKbQoIeZU8SbumatX87ubo9USf8EE4JfQ60ODZ0Tw1q5GxWLpSaE\nIeTZkP1+rzOrmB+tdHgOkZ9JJ7JZ4an87qlH4LJu2B9hfnaiafsQEvJ0YkgKJDpm\nFJoGVSL94QKBgQCHvJDg/7IK7rNMg7mY3U4r8LfoVoh9b/degmKdlpnzGcTGGDlE\nTPuSNSDhMlq2FjduC2wm0M4nxX6yqQDkBp2fcRG0uPia5U/EZz2JktpOtPWQEonQ\nsneEWmscuzL8gmxeRa6jWDfqkFf/xEr4VKSZLR7wW8BF5d3j32E61YKFfQKBgHGv\ndtFS2O6BfsaSkaIeKu+suPWRusK1ROqc1c9uevaCyHLDfUUXjfSYVD5hpEa8imtt\nO70UfV9ZDk/FDPdVUKfxtIYmv5ZYiAMrQwIzi89fSOQqi15wb2NMe5TO8jwRoDU+\nJnqsU/nZbEN9QskyIdaOl5qMlu1DXZpyI3a/GGEhAoGAVxpibkWklZBcdDG7j/kw\naLsN+aRayaXBBZF3jZOagiP4Iken2bp5k72x7PYDP8WsKOoOkxZutBEB7zGlW1Dv\n8m2gsNtfXuH7bMuNKhTHRc2STLbQW+xNc3dw8AOPWnfugXge40qpodcGuBJFvp/H\nyXmczfT7UdONyL97Pio2TP8=\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqYGvq9j16DyYRfjRup4t\npvDTJNI13ggZ2sf60MzpwJk2q4owo5JjwwuDVi3rpeVLQoOs9Z2NciWEsb7SRpFk\nKMpNQ0FdhU3VuhLnIExlobqNU2yKZps7llfOjAWKJAwI8/ye2MP33aHXjLCCTSgV\nVLUOtakLKd3Np0M78ADg5A7UqqLWf3e1noPAjbR/VqOePRbRpevptJOWjWwnqElV\nfNaSPVX+Vn+/2vJMF3cimD/yhGXSgDy5b0HQ26tIrPpVky+kn2lKFppTxJ2vLKQS\nZ0Yne8ECbTuyCvha+YgnM0o1pspxwB31WmBLluFJ/3FmJEUFKHuM65EWddEwIsYt\nJwIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:33:47.468 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:33:47.522 AM"}
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:33:47.522 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:33:47.522 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:33:47.523 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:33:47.523 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 06:33:47.546 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:33:47.550 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:33:47.550 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:33:47.551 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:33:47.551 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:33:47.551 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:33:47.555 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:33:47.555 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:33:47.657 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:33:47.657 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:33:47.657 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:33:47.658 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:33:47.658 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:33:47.658 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:33:47.658 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:33:47.664 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:33:47.667 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:33:47.667 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:33:47.667 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:33:47.667 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:33:47.667 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:33:47.667 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:33:47.668 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:33:47.668 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:33:47.668 AM"}
✅ Server started successfully on port 4000
[INFO] 06:33:58 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/auth-rs256.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:33:58.765 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:33:58.766 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:33:58.766 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:33:58.766 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:33:58.771 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:33:58.771 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:33:58.774 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:33:59.775 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:33:59.775 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:33:59.776 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:33:59.777 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:33:59.782 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:33:59.782 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:33:59.784 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:33:59.784 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:34:00.334 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:34:00.998 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:34:01.000 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:34:01.000 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:34:01.017 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:34:01.017 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDE0tbiK8ganaLH\nuFOfaVAyr5oXS6J4BdHFtvFzfp5UF0ccfH+MLWnhuw8uOc/N7vmM80Vn2olwr5fm\nb3/Ev287ODfr2hjQqorzHIrDYLVY4KvMFx7o/7acvU+I0DmCn7L5cTUI8XgICva7\niAbRr0ZH6U5hgvjUzkUDIzlnDF5NEBd3Mg5Zy/j6pu2tXhY1APy1TvIkAnySQl55\nbZs+OZ9A+8FuB+T6ahrUJ67791R8J3Z1dqRDrOGyLEdB6R2gHd22URi1TPBnV3/Z\nMpzSkTdRBaH4soVKuWqg+hXgJpzpukNaxRCB2tcw5I+IpcUedV7iniu1faPPMz1A\nqDu5gO73AgMBAAECggEAEgQ2tUdKrt0FHIEL7oimVa1rTnyW56Oouw9u9KJ/fbUP\nxlTDHCLAEXCdCB80nWYlo7hU/xerAwyfu/Ey4eCgHuybedRh9x/VTkGrlgzRLMyM\nDUeEhdF6dsiBckWVLhbOPDUXpLTtxtayFSJzdVg097oseZKSknA7MvlTdNJWA3mv\ngvj1eqWtn368/FUBhvtsYObM6YMF9AW99fUC82Tnlq4DzuYZeogpeEJEI1dasQLS\nkdyCYbuQQeI7r4LflQRYBfDKP6LOxpY5cvlrA+bY/cLVZcoZuaUaHf9mcfdoqlHU\nf82EftsahHwS0AZeX5Gz9K1YbFc0DM04P48nyS/SqQKBgQDjfmhPRtMJLE8kv1Kn\nsX16JAql8zod5XtN2N/X076MAKowDtxSKtpN42s8iZmUCy47dnO8ug+tUYyQspZA\nWiMgHqSzmHxw4VuOcqGXKuMISx/lCZZymosmyi/HqB5FtjP/80cnKfRIzGzzGL+n\n3jGmQYdqBU6DUC+JYucKGkyqjQKBgQDdfJZZDtOLAM+ByigHdQG5Quj70o/OpiIs\nl2FNG16nuyaTFRer4EMzd66PpwEw3wHeUnpWhY/55TC8rFFo0kBW/hk0fStgLxmv\nYDa5jdNxRPoLQamDve3Wdj12kpeyk9FrZ79GZiDKPRjG+onLPBRJygr5bv6XFhxd\nrLSMNCcAkwKBgG80R4EZOefuBPINpDXdCV0/aQUeFHawysmPDjzOgQKnAIpleUWh\nNP2GAdGh4bUAkiT3DjRfL3KlvnStF811Ql5dHF2+WHZFcx/64QqoKDrRnlGzkhuL\neCIKC7kpcULagijHnyyB0awUYd2jZ2yDrPl8ZtlopqyB8frSoeXKXVexAoGBAKyH\nv2pSVVEjaYE142ajq5sP1wNK64DTAy3vIfl5h4trCspqFM1rXY26/fyi4BecsAzp\n/KhnVFcaRJPEO4pGtZ3OQ/4SPvam2gA2F4sFQp8qVwjrtkuMaLe11X0HBioyYWCk\nKWiCZ6qCW0msoifxffBY9aGF58XzkFccEGxit7sHAoGAYhmWuFsZh2utdhE66J90\nUliLbhOUQMyWQbWGPj4/OoIwg7ppdVqOvmh4jB12EKVXysPnnl+hSkFxbna/CpxR\nRcFzmiz2+xlEG1GN1HRTn2VbemPP7LwRWPi3uBOhWl2CztkzgRrsfLuJ2PRyA+XG\nvCSJ7Ztfbm51HExIGvz5994=\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxNLW4ivIGp2ix7hTn2lQ\nMq+aF0uieAXRxbbxc36eVBdHHHx/jC1p4bsPLjnPze75jPNFZ9qJcK+X5m9/xL9v\nOzg369oY0KqK8xyKw2C1WOCrzBce6P+2nL1PiNA5gp+y+XE1CPF4CAr2u4gG0a9G\nR+lOYYL41M5FAyM5ZwxeTRAXdzIOWcv4+qbtrV4WNQD8tU7yJAJ8kkJeeW2bPjmf\nQPvBbgfk+moa1Ceu+/dUfCd2dXakQ6zhsixHQekdoB3dtlEYtUzwZ1d/2TKc0pE3\nUQWh+LKFSrlqoPoV4Cac6bpDWsUQgdrXMOSPiKXFHnVe4p4rtX2jzzM9QKg7uYDu\n9wIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:34:01.058 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:34:01.107 AM"}
Redis client connected successfully in rate-limit middleware
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:34:01.112 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:34:01.112 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:34:01.112 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:34:01.112 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 06:34:01.135 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:34:01.139 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:34:01.139 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:34:01.141 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:34:01.141 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:34:01.141 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:34:01.145 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:34:01.145 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:34:01.246 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:34:01.246 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:34:01.246 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:34:01.247 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:34:01.247 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:34:01.247 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:34:01.247 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:34:01.253 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:34:01.256 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:34:01.256 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:34:01.256 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:34:01.256 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:34:01.257 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:34:01.257 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:34:01.258 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:34:01.258 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:34:01.258 AM"}
✅ Server started successfully on port 4000
🔐 GENERATING SECURE TOKEN for user: 8e93e260-ed00-454f-bbe7-da069b47a650
[31m[31merror[31m[39m: 	[31mToken generation failed[39m {"email":"fixed-test@example.com","error":"Cannot read properties of undefined (reading 'verificationToken')","generationTimeMs":0,"purpose":"email_verification","timestamp":"2025-06-05 06:34:42.874 AM","userId":"8e93e260-ed00-454f-bbe7-da069b47a650"}
[31m[31merror[31m[39m: 	[31m500 - Internal Server Error - /api/auth/register - POST - ::1[39m {"body":{"email":"fixed-test@example.com","name":"Fixed Test User","password":"TestPassword123!@#"},"error":"Error: Failed to generate secure token\n    at SecureTokenService.generateVerificationToken (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/services/SecureTokenService.ts:130:13)\n    at AuthController.register (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/auth-rs256.controller.ts:129:27)","params":{},"query":{},"timestamp":"2025-06-05 06:34:42.885 AM"}
[0mPOST /api/auth/register [31m500[0m 265.685 ms - 162[0m
[INFO] 06:35:11 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/auth-rs256.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:35:11.137 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:35:11.139 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:35:11.140 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:35:11.140 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:35:11.143 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:35:11.143 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:35:11.145 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:35:12.145 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:35:12.146 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:35:12.146 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:35:12.146 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:35:12.153 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:35:12.153 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:35:12.153 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:35:12.153 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:35:12.806 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:35:13.532 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:35:13.533 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:35:13.534 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:35:13.554 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:35:13.555 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCritjlGPUY2vzE\n4YThI8B615hncAZrPEXVoxQwRUmAPH1q06X8aXAYQMWKQOReYoeN4iiOA0lBCTO7\nTL3MHGKmGvS/RZ/L34bN709KMENf7SRT6noNX9UmIY2hj2xIHhnOcEjhuLQ3D4IG\nRfYy7SGFOLw7/ea8fRV4tvAaUPa17bF3f+3ktbDIjuX9Q3GN6H2zg+Ibvx3QLNfa\nJZRKotYF1jM7exPBGlMGCPpKzFOmnLTKumejE8As0Cf1ojKerdl6eMHX5Tjatn2i\nGKbxXeOQbauxgpqEpNbWhYgK9It/Z6CM0huDf3zk0UmCouXiliHrg9J+xzQJVVr2\n/yVxYaJtAgMBAAECggEAVKf4gxMufd4wiR78ezkwF8+HDGEKIejEU/qfj3TaIZl4\nkXwyuZ71LVrlweVlbjj0ya33MqJnh9t5NrFYJz9I5c1+xFghVLUSq1WzDRtFXLVE\nzM71/dyx7Zf4c+c6WlrUhH8AULjc4yFZmyvypM5G0R6fMoIKWTHno0OwuWQEZOJB\nUswEEDKyg8+0HKtRcdzXf29zV7h53yU83FW5/S9w8W3OslcXAZIyw2h+V/ePHMpA\n0TIlvPvYG/GJVxUYsqSXr2aHZ8q7nDlh8KyiTbflPmU6nISXdmt0+kwhMXVjtf2J\nnNvEe4pwfoj3n40ANewS757JlyObt/npeYGBXgRglwKBgQDofjR5vfiXXDcylxyT\nW5C/pIoe0XZn/ViYB1n4slk3bC2uKJsUYJ229rwWZGfWSHA2RZYzodwkSjnujMz6\nV9b3YPbqtuMptnD53ItxfTVW+L1ZGPkEYtJ7/X9dajgPIqRdQVSvOKKLPC3OW3jD\nhN9k5Ln9rimDy11A76sadoFW3wKBgQC84wKyktDZp1djg9q+7ARkQuqHFtH/Ad1j\nMDX3ggCt37DSa7KxE+GL7XXirGTihbxGQzssfv6OCfvl07/CYG9jZ1szEPyF70BH\nCIe2OYQ2YIHxZ/a17HszVSiaHi1QFdDsgCzMmWQlBnFiTYVkM7iTaxXK59Ju3HWy\nosrhRjEsMwKBgCeIjlPFQeg6/gfUOj+0akCsMfBbnc7A/becSGhJq3IJKxtaPESS\nyT67ZfBI0n9Vgf84hfnxpAVnucIenxxSo3MdQd9Xifkl1MAoCG4b5F4NneTwoidk\nxnXe/TFdRnsMYPaajVPeRYV3jjJwy3Azv+jgG+BPJTAL/Kd2GZo+XG/xAoGBAJyU\ns0/FVUyY5GCilVtf2+QhdLm3uS1kJlprRNGA+38nyDUnAmK40Ghm2SqnLpp5srGs\nWglw3SRyMlc7SeOgfbYxn/CdTDjbNLWt5JKy618Ica/lNydoelj7Z0UbbwTMkPz8\n5CZXoiTvSl7rVIDUP1Y1l0M1GcS9DPSg7v4AahLxAoGBANZD5+Om4AainKb/4HQG\nh2MRBLA2+82VWTsrpJxelkk7anJEI9rSJceTdOkmJ5VLqvgUC8Le20KZEV9Oex+2\nNrQj73zHLooXjlRmis+XPGsLl4n5WFuUmIySEf0GISSxEEvHQQtb7MA1bcgGMJTV\nFhjFTLYWHFUMvSJ5zHtOHP2P\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAq4rY5Rj1GNr8xOGE4SPA\neteYZ3AGazxF1aMUMEVJgDx9atOl/GlwGEDFikDkXmKHjeIojgNJQQkzu0y9zBxi\nphr0v0Wfy9+Gze9PSjBDX+0kU+p6DV/VJiGNoY9sSB4ZznBI4bi0Nw+CBkX2Mu0h\nhTi8O/3mvH0VeLbwGlD2te2xd3/t5LWwyI7l/UNxjeh9s4PiG78d0CzX2iWUSqLW\nBdYzO3sTwRpTBgj6SsxTppy0yrpnoxPALNAn9aIynq3ZenjB1+U42rZ9ohim8V3j\nkG2rsYKahKTW1oWICvSLf2egjNIbg3985NFJgqLl4pYh64PSfsc0CVVa9v8lcWGi\nbQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:35:13.785 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:35:13.837 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:35:13.837 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:35:13.838 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:35:13.838 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:35:13.840 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"0ms","timestamp":"2025-06-05 06:35:13.860 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:35:13.864 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:35:13.864 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:35:13.866 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:35:13.866 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:35:13.866 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:35:13.870 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:35:13.870 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:35:13.971 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:35:13.971 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:35:13.971 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:35:13.972 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:35:13.972 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:35:13.972 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:35:13.972 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:35:13.978 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:35:13.981 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:35:13.981 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:35:13.981 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:35:13.981 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:35:13.982 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:35:13.982 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:35:13.982 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:35:13.982 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:35:13.982 AM"}
✅ Server started successfully on port 4000
🔐 GENERATING SECURE TOKEN for user: d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7
=== STORING TOKEN DEBUG ===
Email: final-fixed-test@example.com
HashedToken prefix: c01d521651962110...
UserId: d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7
Purpose: email_verification
Sequence: 1
ExpiresAt: 2025-06-05T11:35:44.602Z
Creating token with data: {
  hashedToken: 'c01d521651962110253bf4188c465e77ec4d116cfcaa5a281fcd8e7f9df6d0f1',
  userId: 'd0ba879f-ca57-487e-bc84-a7cd4a5dd0a7',
  email: 'final-fixed-test@example.com',
  purpose: 'email_verification',
  sequence: 1,
  expiresAt: 2025-06-05T11:35:44.602Z,
  isValid: true,
  createdAt: 2025-06-05T10:35:44.602Z
}
✅ Token stored successfully: {
  id: 'f7cab79e-c64a-4aa8-92ca-2a40ef827117',
  email: 'final-fixed-test@example.com',
  hashedTokenPrefix: 'c01d521651962110...'
}
✅ Token verified in database: {
  id: 'f7cab79e-c64a-4aa8-92ca-2a40ef827117',
  email: 'final-fixed-test@example.com',
  isValid: true,
  expiresAt: 2025-06-05T11:35:44.602Z
}
[32m[32minfo[32m[39m: 	[32mSecure token generated[39m {"email":"final-fixed-test@example.com","expiresAt":"2025-06-05T11:35:44.602Z","generationTimeMs":26,"hashedTokenPrefix":"c01d5216...","purpose":"email_verification","sequence":1,"timestamp":"2025-06-05 06:35:44.628 AM","tokenLength":64,"userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
✅ SECURE TOKEN GENERATED: {
  userId: 'd0ba879f-ca57-487e-bc84-a7cd4a5dd0a7',
  email: 'final-fixed-test@example.com',
  tokenLength: 64,
  tokenPrefix: 'de2af091ed4df453...'
}
[32m[32minfo[32m[39m: 	[32mStarting email verification send process[39m {"email":"final-fixed-test@example.com","name":"Final Fixed Test User","timestamp":"2025-06-05 06:35:44.628 AM","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[32m[32minfo[32m[39m: 	[32mVerification token found, attempting to send email[39m {"email":"final-fixed-test@example.com","timestamp":"2025-06-05 06:35:44.629 AM","tokenLength":64,"userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail called[39m {"name":"Final Fixed Test User","timestamp":"2025-06-05 06:35:44.629 AM","to":"final-fixed-test@example.com","verificationToken":"de2af091..."}
[32m[32minfo[32m[39m: 	[32mGenerated verification URL[39m {"timestamp":"2025-06-05 06:35:44.631 AM","verificationUrl":"https://seoauditer.netlify.app/verify-email/de2af091ed4df4534ff1ee7d3f0c182ad17197906a14e6930d4453b6edea1490"}
[32m[32minfo[32m[39m: 	[32mEmail template rendered successfully[39m {"htmlLength":8522,"subject":"Welcome to SEO Director! Please verify your email","textLength":773,"timestamp":"2025-06-05 06:35:44.631 AM"}
[32m[32minfo[32m[39m: 	[32msendEmail called[39m {"initialized":true,"providerName":"SendGrid","subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:35:44.631 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAttempting to send email via SendGrid to final-fixed-test@example.com[39m {"timestamp":"2025-06-05 06:35:44.632 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid send method called[39m {"apiKeyLength":69,"apiKeyPrefix":"SG.Y6rjeWf","configured":true,"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:35:44.632 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid send details[39m {"environment":"development","fromEmail":"admin@seodirector.co","fromName":"SEO Director","timestamp":"2025-06-05 06:35:44.632 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAbout to call SendGrid API[39m {"from":"SEO Director <admin@seodirector.co>","msgStructure":["to","from","subject","html","text","trackingSettings","tracking_settings","headers"],"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:35:44.632 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid API call completed[39m {"messageId":"v2RX4BkEQQ6HhsnmO2LC4w","responseBody":"","responseHeaders":{"access-control-allow-headers":"Authorization, Content-Type, On-behalf-of, x-sg-elas-acl","access-control-allow-methods":"POST","access-control-allow-origin":"https://sendgrid.api-docs.io","access-control-max-age":"600","cache-control":"no-cache","connection":"keep-alive","content-length":"0","content-security-policy":"frame-ancestors 'none'","date":"Thu, 05 Jun 2025 10:35:45 GMT","referrer-policy":"strict-origin-when-cross-origin","server":"nginx","strict-transport-security":"max-age=31536000; includeSubDomains","x-content-type-options":"no-sniff","x-message-id":"v2RX4BkEQQ6HhsnmO2LC4w","x-no-cors-reason":"https://sendgrid.com/docs/Classroom/Basics/API/cors.html"},"statusCode":202,"timestamp":"2025-06-05 06:35:44.908 AM"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully via SendGrid to final-fixed-test@example.com[39m {"messageId":"v2RX4BkEQQ6HhsnmO2LC4w","statusCode":202,"timestamp":"2025-06-05 06:35:44.908 AM"}
[32m[32minfo[32m[39m: 	[32mProvider send result[39m {"result":true,"timestamp":"2025-06-05 06:35:44.908 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully to final-fixed-test@example.com via SendGrid[39m {"timestamp":"2025-06-05 06:35:44.908 AM"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail result[39m {"result":true,"timestamp":"2025-06-05 06:35:44.908 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail verification sent successfully[39m {"email":"final-fixed-test@example.com","timestamp":"2025-06-05 06:35:44.908 AM","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[32m[32minfo[32m[39m: 	[32mSecurity event[39m {"email":"final-fixed-test@example.com","event":"user_registered","ipAddress":"::1","timestamp":"2025-06-05 06:35:44.912 AM","userAgent":"node-fetch/1.0 (+https://github.com/bitinn/node-fetch)","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[32m[32minfo[32m[39m: 	[32mUser registered successfully[39m {"email":"final-fixed-test@example.com","ipAddress":"::1","timestamp":"2025-06-05 06:35:44.913 AM","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[0mPOST /api/auth/register [32m201[0m 553.286 ms - 348[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749119760889_dni4v0sxq","ip":"::1","timestamp":"2025-06-05 06:36:00.894 AM","tokenPrefix":"de2af091...","userAgent":"curl/8.7.1"}
[32m[32minfo[32m[39m: 	[32mToken validation successful[39m {"email":"final-fixed-test@example.com","purpose":"email_verification","sequence":1,"timestamp":"2025-06-05 06:36:00.952 AM","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7","validationTimeMs":54}
[32m[32minfo[32m[39m: 	[32mToken invalidated[39m {"affectedRows":1,"hashedTokenPrefix":"c01d5216...","timestamp":"2025-06-05 06:36:00.991 AM"}
[32m[32minfo[32m[39m: 	[32mEmail verification successful[39m {"correlationId":"verify_1749119760889_dni4v0sxq","email":"final-fixed-test@example.com","timestamp":"2025-06-05 06:36:00.992 AM","tokenPrefix":"de2af091...","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[0mGET /api/secure-auth/verify-email/de2af091ed4df4534ff1ee7d3f0c182ad17197906a14e6930d4453b6edea1490 [32m200[0m 105.556 ms - 222[0m
[32m[32minfo[32m[39m: 	[32mFound existing user during registration[39m {"email":"nmang004@gmail.com","emailVerified":false,"timestamp":"2025-06-05 06:38:50.496 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mResending verification email for existing unverified user[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 06:38:50.496 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mStarting email verification send process[39m {"email":"nmang004@gmail.com","name":"Nicholas Mangubat","timestamp":"2025-06-05 06:38:50.496 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mVerification token found, attempting to send email[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 06:38:50.520 AM","tokenLength":64,"userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail called[39m {"name":"Nicholas Mangubat","timestamp":"2025-06-05 06:38:50.520 AM","to":"nmang004@gmail.com","verificationToken":"90bd1137..."}
[32m[32minfo[32m[39m: 	[32mGenerated verification URL[39m {"timestamp":"2025-06-05 06:38:50.521 AM","verificationUrl":"https://seoauditer.netlify.app/verify-email/90bd1137b2886e58430f78cbc28127f00315f366101cba6467379f473ef26481"}
[32m[32minfo[32m[39m: 	[32mEmail template rendered successfully[39m {"htmlLength":8518,"subject":"Welcome to SEO Director! Please verify your email","textLength":769,"timestamp":"2025-06-05 06:38:50.521 AM"}
[32m[32minfo[32m[39m: 	[32msendEmail called[39m {"initialized":true,"providerName":"SendGrid","subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:38:50.521 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mAttempting to send email via SendGrid to nmang004@gmail.com[39m {"timestamp":"2025-06-05 06:38:50.521 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid send method called[39m {"apiKeyLength":69,"apiKeyPrefix":"SG.Y6rjeWf","configured":true,"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:38:50.521 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid send details[39m {"environment":"development","fromEmail":"admin@seodirector.co","fromName":"SEO Director","timestamp":"2025-06-05 06:38:50.521 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mAbout to call SendGrid API[39m {"from":"SEO Director <admin@seodirector.co>","msgStructure":["to","from","subject","html","text","trackingSettings","tracking_settings","headers"],"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:38:50.521 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid API call completed[39m {"messageId":"V5lyMxwqR4W5nPGHnvDy4w","responseBody":"","responseHeaders":{"access-control-allow-headers":"Authorization, Content-Type, On-behalf-of, x-sg-elas-acl","access-control-allow-methods":"POST","access-control-allow-origin":"https://sendgrid.api-docs.io","access-control-max-age":"600","cache-control":"no-cache","connection":"keep-alive","content-length":"0","content-security-policy":"frame-ancestors 'none'","date":"Thu, 05 Jun 2025 10:38:51 GMT","referrer-policy":"strict-origin-when-cross-origin","server":"nginx","strict-transport-security":"max-age=31536000; includeSubDomains","x-content-type-options":"no-sniff","x-message-id":"V5lyMxwqR4W5nPGHnvDy4w","x-no-cors-reason":"https://sendgrid.com/docs/Classroom/Basics/API/cors.html"},"statusCode":202,"timestamp":"2025-06-05 06:38:50.856 AM"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully via SendGrid to nmang004@gmail.com[39m {"messageId":"V5lyMxwqR4W5nPGHnvDy4w","statusCode":202,"timestamp":"2025-06-05 06:38:50.857 AM"}
[32m[32minfo[32m[39m: 	[32mProvider send result[39m {"result":true,"timestamp":"2025-06-05 06:38:50.857 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully to nmang004@gmail.com via SendGrid[39m {"timestamp":"2025-06-05 06:38:50.857 AM"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail result[39m {"result":true,"timestamp":"2025-06-05 06:38:50.857 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mEmail verification sent successfully[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 06:38:50.857 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[0mPOST /api/auth/register [32m200[0m 418.780 ms - 131[0m
[INFO] 06:40:46 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/services/SecureTokenService.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:40:46.328 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:40:46.330 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:40:46.331 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:40:46.332 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:40:46.345 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:40:46.346 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:40:46.350 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:40:47.352 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:40:47.353 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:40:47.355 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:40:47.355 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:40:47.362 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:40:47.362 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:40:47.369 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:40:47.369 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:40:48.000 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:40:48.698 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:40:48.700 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:40:48.700 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:40:48.721 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:40:48.721 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDGdpaE560IVKNx\nDILeqtalnJxxeMWFWLmXbA292LD2HoOqghHNd6hIcdErtO2hOmzqszzSstUSaEib\nZw/iVeymMxOnWNZKmEq81Q0YQ2K8lA7G2MzaDi5PjW7uNSk8BzB7rtLb8Rc28qNn\nbaGnvzXWAo+hVGxkFJNaBqXO82QeYyREh0WEZTomKK9I2OEt7/gXrkJrZ2XIK69w\n3oMAbftMhoi9Hl/JQI0fXy09fcDGSABkcH6yYvCH1c/9J4Z7kM3rSur4HwWg3QY/\nPf2biO6ljqG2/rVNWedhPT64m8fieLSaHXjCjnt0hWnDmKEG5Et51uluC6BZ1okx\nO3mCRgS1AgMBAAECggEAF0EH6/S1apd4OyPLJcoAspECJ62N/0zhGiP4DDmaqovy\nw4TQDzIpDqv/ZU6i1VRiNLHhu5JmsuxzLXpK+ys0OlkbwW0AVuc3Qp74FNK4e/4h\nKR14C0jEFmAtEk46UaVKAgP/AvRh0vdlPBY1bdFSvou4Rp/8v1FF3rOOtAwCvCiO\n1B2Rf9BNMvAUHcN6COsS3hPHYbN/mKGSd2KICkdAEswQ9PJsMTXTVb7aS0HQwE89\nKpV4byE6ikvBKXOzjJ8tztQ9MJNtTU/hJZ2PUhG8tbawqgxODG+LBYpKzcsuwE6K\ndTj4v494LCc2TI/1e9VaGMvdlXnSNxCFNdqQLClLwQKBgQDr0Fg3NI8M+k7F4NYX\nRA98bZzltc3O0bRupuomlUa8zCpK/XUUKblL5cro8kt8YOiHJtYWB/+Zu6ELjZBz\nUhM20ggmSZmIeUqoItAXoGicsQyC28YxrnRy6XW0NjkERNArKoGvtyC1OoycuACA\n6FqbQr9Sp9p4DhAEy1syA1aNkQKBgQDXc7y4dGGgpR/aNaa3f34k4Z7D6CTUzME5\n47D4rbgNIHFzwVlQTXvVyrmjEa9qoVB9Nrbg7YqWp7mRwXjWaPl99jiqlaGHqiY8\n/YBvrYwsxMFiAdOqGdv4yEeL1wfViQM5IiaauItJfU0Yy8b/J76Y+VGVdm9PI2EH\nM9gCurpC5QKBgAPNo26YgWojK1wTqUBMz7chCXPG/9/DEBbsyEABDlgDLvdwqQ+/\nMIbh2Ojy53bFFVsArFlEncG7/ffyu46wlzC+KHV9oGVMF4EotpR6+NT2Ig6GPucU\nOjqUO1rBuR+xgG4BzH+qA3QI0rXAXfm2RafVZsKNhH+FMorxQLJIzX+RAoGBAKKi\npB/dAmEgpIW0oC++FrvCcHVTxJG6KlYHkWx2vgtypRGLL19VzhfZWv5EeFUWhkqu\nxafOyCHnZEYpdIztWwABoE7seq2M/CZn+c7Tg4+7ynqwBFZQBOOsU420+R3wujUj\nmV6L1eDYrBz+ni23k8Gn2jTn3Sgw/apRMUsGJ1odAoGBAMXQMGl2LjKMMCcJOj+J\ntp2uEZZMzXcBxqC4ATvK9yfyLA3gLAKNTvigxzhELwn/tzeRbM176CIrvPVSvKB3\noKiSzvVvs9Z0fyzcWbCUClbrq9ptkf0YtgLGibGqjnFM4Xqa++gYZiLew0EmRlT0\n6f34z3gtrU4VUkupV2/7K9RW\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxnaWhOetCFSjcQyC3qrW\npZyccXjFhVi5l2wNvdiw9h6DqoIRzXeoSHHRK7TtoTps6rM80rLVEmhIm2cP4lXs\npjMTp1jWSphKvNUNGENivJQOxtjM2g4uT41u7jUpPAcwe67S2/EXNvKjZ22hp781\n1gKPoVRsZBSTWgalzvNkHmMkRIdFhGU6JiivSNjhLe/4F65Ca2dlyCuvcN6DAG37\nTIaIvR5fyUCNH18tPX3AxkgAZHB+smLwh9XP/SeGe5DN60rq+B8FoN0GPz39m4ju\npY6htv61TVnnYT0+uJvH4ni0mh14wo57dIVpw5ihBuRLedbpbgugWdaJMTt5gkYE\ntQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:40:48.835 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:40:48.894 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:40:48.895 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:40:48.895 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:40:48.895 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:40:48.901 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 06:40:48.930 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:40:48.935 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:40:48.936 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:40:48.937 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:40:48.937 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:40:48.937 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:40:48.941 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:40:48.941 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:40:49.041 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:40:49.041 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:40:49.041 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:40:49.042 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:40:49.042 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:40:49.042 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:40:49.042 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:40:49.049 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:40:49.050 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:40:49.051 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
✅ Server started successfully on port 4000
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749121202301_9dzuzbhcx","ip":"::1","timestamp":"2025-06-05 07:00:02.303 AM","tokenPrefix":"90bd1137...","userAgent":"axios/1.9.0"}
[33m[33mwarn[33m[39m: 	[33mToken validation failed - not found or expired[39m {"hashedTokenPrefix":"8733bf27...","purpose":"email_verification","timestamp":"2025-06-05 07:00:02.464 AM","validationTimeMs":153}
[33m[33mwarn[33m[39m: 	[33mEmail verification failed - invalid token[39m {"correlationId":"verify_1749121202301_9dzuzbhcx","error":"Invalid or expired verification token","timestamp":"2025-06-05 07:00:02.465 AM","tokenPrefix":"90bd1137..."}
[0mGET /api/secure-auth/verify-email/90bd1137b2886e58430f78cbc28127f00315f366101cba646737f473ef2d5bef8 [33m400[0m 183.980 ms - 65[0m
[32m[32minfo[32m[39m: 	[32mFound existing user during registration[39m {"email":"nmang004@gmail.com","emailVerified":false,"timestamp":"2025-06-05 07:03:44.095 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mResending verification email for existing unverified user[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 07:03:44.095 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mStarting email verification send process[39m {"email":"nmang004@gmail.com","name":"Nicholas Mangubat","timestamp":"2025-06-05 07:03:44.095 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mVerification token found, attempting to send email[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 07:03:44.096 AM","tokenLength":64,"userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail called[39m {"name":"Nicholas Mangubat","timestamp":"2025-06-05 07:03:44.098 AM","to":"nmang004@gmail.com","verificationToken":"90bd1137..."}
[32m[32minfo[32m[39m: 	[32mGenerated verification URL[39m {"timestamp":"2025-06-05 07:03:44.105 AM","verificationUrl":"https://seoauditer.netlify.app/verify-email/90bd1137b2886e58430f78cbc28127f00315f366101cba6467379f473ef26481"}
[32m[32minfo[32m[39m: 	[32mEmail template rendered successfully[39m {"htmlLength":8518,"subject":"Welcome to SEO Director! Please verify your email","textLength":769,"timestamp":"2025-06-05 07:03:44.107 AM"}
[32m[32minfo[32m[39m: 	[32msendEmail called[39m {"initialized":true,"providerName":"SendGrid","subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 07:03:44.107 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mAttempting to send email via SendGrid to nmang004@gmail.com[39m {"timestamp":"2025-06-05 07:03:44.107 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid send method called[39m {"apiKeyLength":69,"apiKeyPrefix":"SG.Y6rjeWf","configured":true,"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 07:03:44.108 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid send details[39m {"environment":"development","fromEmail":"admin@seodirector.co","fromName":"SEO Director","timestamp":"2025-06-05 07:03:44.108 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mAbout to call SendGrid API[39m {"from":"SEO Director <admin@seodirector.co>","msgStructure":["to","from","subject","html","text","trackingSettings","tracking_settings","headers"],"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 07:03:44.109 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid API call completed[39m {"messageId":"_q-OJTq_Tu28syHqFgu65A","responseBody":"","responseHeaders":{"access-control-allow-headers":"Authorization, Content-Type, On-behalf-of, x-sg-elas-acl","access-control-allow-methods":"POST","access-control-allow-origin":"https://sendgrid.api-docs.io","access-control-max-age":"600","cache-control":"no-cache","connection":"keep-alive","content-length":"0","content-security-policy":"frame-ancestors 'none'","date":"Thu, 05 Jun 2025 11:03:44 GMT","referrer-policy":"strict-origin-when-cross-origin","server":"nginx","strict-transport-security":"max-age=31536000; includeSubDomains","x-content-type-options":"no-sniff","x-message-id":"_q-OJTq_Tu28syHqFgu65A","x-no-cors-reason":"https://sendgrid.com/docs/Classroom/Basics/API/cors.html"},"statusCode":202,"timestamp":"2025-06-05 07:03:44.461 AM"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully via SendGrid to nmang004@gmail.com[39m {"messageId":"_q-OJTq_Tu28syHqFgu65A","statusCode":202,"timestamp":"2025-06-05 07:03:44.461 AM"}
[32m[32minfo[32m[39m: 	[32mProvider send result[39m {"result":true,"timestamp":"2025-06-05 07:03:44.461 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully to nmang004@gmail.com via SendGrid[39m {"timestamp":"2025-06-05 07:03:44.461 AM"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail result[39m {"result":true,"timestamp":"2025-06-05 07:03:44.461 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mEmail verification sent successfully[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 07:03:44.461 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[0mPOST /api/auth/register [32m200[0m 509.640 ms - 131[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749121811069_7a24g4hrk","ip":"::1","timestamp":"2025-06-05 07:10:11.071 AM","tokenPrefix":"aaa76376...","userAgent":"axios/1.9.0"}
[32m[32minfo[32m[39m: 	[32mToken validation successful[39m {"email":"nmang004@gmail.com","purpose":"email_verification","sequence":1,"timestamp":"2025-06-05 07:10:11.092 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80","validationTimeMs":18}
[32m[32minfo[32m[39m: 	[32mToken invalidated[39m {"affectedRows":1,"hashedTokenPrefix":"52e2cea4...","timestamp":"2025-06-05 07:10:11.114 AM"}
[32m[32minfo[32m[39m: 	[32mEmail verification successful[39m {"correlationId":"verify_1749121811069_7a24g4hrk","email":"nmang004@gmail.com","timestamp":"2025-06-05 07:10:11.115 AM","tokenPrefix":"aaa76376...","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[0mGET /api/secure-auth/verify-email/aaa76376c53cf903a027817bc1f516aff273a8c3120d70034ed44291f15e9b38 [32m200[0m 52.877 ms - 212[0m
[INFO] 07:11:19 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/secure-token-auth.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:11:19.327 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:11:19.330 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:11:19.330 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:11:19.332 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:11:19.351 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:11:19.352 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:11:19.357 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:11:20.358 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:11:20.359 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:11:20.362 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:11:20.364 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:11:20.369 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:11:20.369 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:11:20.372 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:11:20.374 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:11:21.153 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:11:21.905 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:11:21.906 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:11:21.906 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:11:21.929 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:11:21.930 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDIX/Pt3NgyB/G4\nq9k1SHyq4bUYq2xPetpkcAg9bXCjgEkBgM01cRM6UmgPgndAE4pZKtjAm3ymuBMg\nPlhNFdEXelewFlR7tUIsdP+WFg4YU8/EYCGPROfb77A/YjC3YYZJ9pn9gic0wek1\nI/qXJa0ZEVlnl1ZvBRwaaO/xHc/2r1E4I/pq4RT3Z+nnesWq5mTs/jAXQoUr4xxi\nfFpvb4lrz3vmcRfdP8nV47U4/Sr2jNP8tArGcEAjy9hV/7FI9JoM3/2ZN+kpJmux\nJc+WnvRD1JKjpJbCPJy7BvTQpBXMkjgxUF1YkMuPAbAukl8Hq8AfbU8Kdn6c3/QR\ntO6yW2XHAgMBAAECggEAT8cMSp8MINdS4VDieTl0EWEuBjVyOS7Ttvt3/GUPXLmd\n15Bdo7Jyklzu+4XZTtS414mcpQsDFSniy4qnA4H1LuDR+tTZLCvdve+TN0FuuTbd\nWPVhRzaLDeEfjgzdEpYsrlQVuX5Rd8rgu/yoL/ebNIjYzMrPagJhzw4Kwjg5baBo\n9ii+EQxifU2WzKzqqDU9jYiSj5IbVCjqLCs2+LV+e8T77OGJvzD9K7PHo0MkScqJ\ndLDu0eSBPbjcCNa9hgWG5jcepqp1FmZxAqtILB5MJALibq1DMuydKuafN0+u1iYv\nAbc8IKWZyN49pz1UXIwwbeGd9JpjH07k5zGEK/lboQKBgQDyTVs71F07MJ+WKl7c\n6V3eAERY9gzLoJnXM53GjNpSR1/p23MnYsH/zVvIh3G+9BYkBwx7vy5A94EyLkL7\n+SslxkeWmiKQz4bjM8gOzJKkOr+IlCH51c3dws8GTUWyQl2eXbNWr7+B6wKyqhZJ\nlrKVeQzFykWjGcoAT3uvt9kndwKBgQDTs9DRF/o0v2nlBzHzjobP/WnPg9L3ttNH\nd96noC1S/kuvQvglCfsQJWzNsK7zwZCvKaO3smiXmG2ZMqEvRnnKBubX02JEKQse\nAlou9CcOF6G5veKbCbrylJ5grOFa7+0lOSBFJbID/L8lBZ44aLyGUF91YZWXH0SS\ngDNsqfHoMQKBgQCMTtsr1BeAtPFUhYiVJ9WhPkpVsXVLXN54zXzpgprR1l7mDpuq\nDPgF5qblgfkN+E3x4tsJtXVVTX1Uz5EeU/T2VNETloG5lVKosk2AtFmeHB7ZOd5K\ny9IAPlSfc5OOW/vWPrAg3HhrBOl1CCULy+XxxDzvM+gLQF3GvEAFStLGlQKBgQDM\n8dYkpfa2G9xTOSz1YTRHpEdL+o1A/D/7fyMQ2fMm1kHE0KtTiB8CWYjEc9ha6De+\nKyxwSIoSwCDR337FOo/qsdXGeMA3xhgaHCLcM8afUOdi3l3Cw5+0+YV9h7++fmjw\n0SXZaw2z6HnPSGoMp/Bigup2w1rC6yVCQlQGTVt/8QKBgQCiSlc1nR4HN8coPZx0\nRd8Y80LrVLWM4c3mxES/tvc/haNIV0rguaXCGIJAQC3jv81Dg1TWOpcdkWvImajd\nNwRFFYvouXG/l6hFRYULsweIUTghyv6n5TXC9/m4TLoidrFlCRHSoHewq7vX64jO\nUJwYcH0v4t4HS+XJVL5sVwB5SA==\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyF/z7dzYMgfxuKvZNUh8\nquG1GKtsT3raZHAIPW1wo4BJAYDNNXETOlJoD4J3QBOKWSrYwJt8prgTID5YTRXR\nF3pXsBZUe7VCLHT/lhYOGFPPxGAhj0Tn2++wP2Iwt2GGSfaZ/YInNMHpNSP6lyWt\nGRFZZ5dWbwUcGmjv8R3P9q9ROCP6auEU92fp53rFquZk7P4wF0KFK+McYnxab2+J\na8975nEX3T/J1eO1OP0q9ozT/LQKxnBAI8vYVf+xSPSaDN/9mTfpKSZrsSXPlp70\nQ9SSo6SWwjycuwb00KQVzJI4MVBdWJDLjwGwLpJfB6vAH21PCnZ+nN/0EbTusltl\nxwIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:11:22.041 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:11:22.098 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:11:22.098 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:11:22.099 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:11:22.101 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:11:22.101 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"2ms","timestamp":"2025-06-05 07:11:22.140 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:11:22.147 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:11:22.147 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:11:22.148 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:11:22.148 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:11:22.148 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:11:22.152 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:11:22.152 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:11:22.253 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:11:22.253 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:11:22.253 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:11:22.254 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:11:22.254 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:11:22.254 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:11:22.254 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:11:22.260 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:11:22.262 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:11:22.262 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:11:22.262 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:11:22.262 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:11:22.263 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:11:22.263 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:11:22.263 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:11:22.263 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:11:22.263 AM"}
✅ Server started successfully on port 4000
[32m[32minfo[32m[39m: 	[32mRegistration attempt started[39m {"correlationId":"reg_1749121892637_nlmclvrmm","email":"token-test@example.com","ip":"::1","name":"Token Test User","timestamp":"2025-06-05 07:11:32.637 AM","userAgent":"axios/1.9.0"}
[32m[32minfo[32m[39m: 	[32mCreating new user[39m {"correlationId":"reg_1749121892637_nlmclvrmm","email":"token-test@example.com","timestamp":"2025-06-05 07:11:32.884 AM"}
[32m[32minfo[32m[39m: 	[32mSending verification email[39m {"correlationId":"reg_1749121892637_nlmclvrmm","email":"token-test@example.com","isNewUser":true,"timestamp":"2025-06-05 07:11:32.915 AM","userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[32m[32minfo[32m[39m: 	[32mStarting verification email send[39m {"correlationId":"email_1749121892915_ngi7pb52l","email":"token-test@example.com","name":"Token Test User","timestamp":"2025-06-05 07:11:32.915 AM","userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
=== STORING TOKEN DEBUG ===
Email: token-test@example.com
HashedToken prefix: ae793b5b140869c9...
UserId: 15dd73a1-2133-44d7-93fc-a935290e9e06
Purpose: email_verification
Sequence: 1
ExpiresAt: 2025-06-05T12:11:32.915Z
Creating token with data: {
  hashedToken: 'ae793b5b140869c9a0b291db326bc78f890cf7d5e5f816452cb53a9e36c3a6fe',
  userId: '15dd73a1-2133-44d7-93fc-a935290e9e06',
  email: 'token-test@example.com',
  purpose: 'email_verification',
  sequence: 1,
  expiresAt: 2025-06-05T12:11:32.915Z,
  isValid: true,
  createdAt: 2025-06-05T11:11:32.915Z
}
✅ Token stored successfully: {
  id: '4a563f1a-d8a7-4d1e-9a50-92d60bede6f3',
  email: 'token-test@example.com',
  hashedTokenPrefix: 'ae793b5b140869c9...'
}
✅ Token verified in database: {
  id: '4a563f1a-d8a7-4d1e-9a50-92d60bede6f3',
  email: 'token-test@example.com',
  isValid: true,
  expiresAt: 2025-06-05T12:11:32.915Z
}
[32m[32minfo[32m[39m: 	[32mSecure token generated[39m {"email":"token-test@example.com","expiresAt":"2025-06-05T12:11:32.915Z","generationTimeMs":16,"hashedTokenPrefix":"ae793b5b...","purpose":"email_verification","sequence":1,"timestamp":"2025-06-05 07:11:32.931 AM","tokenLength":64,"userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[32m[32minfo[32m[39m: 	[32mFresh token generated for email[39m {"correlationId":"email_1749121892915_ngi7pb52l","email":"token-test@example.com","expiresAt":"2025-06-05T12:11:32.915Z","timestamp":"2025-06-05 07:11:32.931 AM","tokenPrefix":"697bf974...","tokenSequence":1,"userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[32m[32minfo[32m[39m: 	[32mSending email via SendGrid[39m {"correlationId":"email_1749121892915_ngi7pb52l","templateId":"d-seo-verification-template","timestamp":"2025-06-05 07:11:32.931 AM","to":"token-test@example.com","tokenPrefix":"697bf974...","trackingDisabled":true}
[31m[31merror[31m[39m: 	[31mSendGrid email send failed[39m {"correlationId":"email_1749121892915_ngi7pb52l","error":"Bad Request","responseBody":{"errors":[{"field":"template_id","help":"http://sendgrid.com/docs/API_Reference/Web_API_v3/Mail/errors.html#message.template_id","message":"The template_id must be a valid GUID, you provided 'd-seo-verification-template'."},{"field":"subject","help":"http://sendgrid.com/docs/API_Reference/Web_API_v3/Mail/errors.html#message.subject","message":"The subject is required. You can get around this requirement if you use a template with a subject defined or if every personalization has a subject defined."},{"field":"content","help":"http://sendgrid.com/docs/API_Reference/Web_API_v3/Mail/errors.html#message.content","message":"Unless a valid template_id is provided, the content parameter is required. There must be at least one defined content block. We typically suggest both text/plain and text/html blocks are included, but only one block is required."}]},"statusCode":400,"timestamp":"2025-06-05 07:11:33.296 AM"}
[31m[31merror[31m[39m: 	[31mVerification email send failed[39m {"correlationId":"email_1749121892915_ngi7pb52l","email":"token-test@example.com","error":"Bad Request","timestamp":"2025-06-05 07:11:33.296 AM","totalTimeMs":381,"userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[31m[31merror[31m[39m: 	[31mFailed to send verification email[39m {"correlationId":"reg_1749121892637_nlmclvrmm","email":"token-test@example.com","error":"Bad Request","timestamp":"2025-06-05 07:11:33.296 AM","userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[0mPOST /api/secure-auth/register [31m500[0m 660.756 ms - 61[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749121942046_xjcchxx8g","ip":"::1","timestamp":"2025-06-05 07:12:22.046 AM","tokenPrefix":"3a983207...","userAgent":"axios/1.9.0"}
[32m[32minfo[32m[39m: 	[32mToken validation successful[39m {"email":"token-test@example.com","purpose":"email_verification","sequence":2,"timestamp":"2025-06-05 07:12:22.055 AM","userId":"15dd73a1-2133-44d7-93fc-a935290e9e06","validationTimeMs":8}
[32m[32minfo[32m[39m: 	[32mToken invalidated[39m {"affectedRows":1,"hashedTokenPrefix":"a238b096...","timestamp":"2025-06-05 07:12:22.075 AM"}
[32m[32minfo[32m[39m: 	[32mEmail verification successful[39m {"correlationId":"verify_1749121942046_xjcchxx8g","email":"token-test@example.com","timestamp":"2025-06-05 07:12:22.076 AM","tokenPrefix":"3a983207...","userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[0mGET /api/secure-auth/verify-email/3a983207d458477aac59ae0f3b4e2a6937542325d1ca72f8c30c2e76b247dced [32m200[0m 39.286 ms - 216[0m
[32m[32minfo[32m[39m: 	[32mResend verification attempt[39m {"correlationId":"resend_1749122037357_l6kkcflzp","email":"nmang004@gmail.com","ip":"::1","timestamp":"2025-06-05 07:13:57.357 AM"}
[33m[33mwarn[33m[39m: 	[33mResend verification failed - already verified[39m {"correlationId":"resend_1749122037357_l6kkcflzp","email":"nmang004@gmail.com","timestamp":"2025-06-05 07:13:57.362 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[0mPOST /api/secure-auth/resend-verification [33m400[0m 5.428 ms - 53[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749122046488_dhgqncmgs","ip":"::1","timestamp":"2025-06-05 07:14:06.488 AM","tokenPrefix":"90bd137b...","userAgent":"curl/8.7.1"}
[33m[33mwarn[33m[39m: 	[33mToken validation failed - not found or expired[39m {"hashedTokenPrefix":"008c43f0...","purpose":"email_verification","timestamp":"2025-06-05 07:14:06.491 AM","validationTimeMs":3}
[33m[33mwarn[33m[39m: 	[33mEmail verification failed - invalid token[39m {"correlationId":"verify_1749122046488_dhgqncmgs","error":"Invalid or expired verification token","timestamp":"2025-06-05 07:14:06.491 AM","tokenPrefix":"90bd137b..."}
[0mGET /api/secure-auth/verify-email/90bd137b2886e58430f78cbc28127f003f5f366101cba6467379f473ef26481 [33m400[0m 4.138 ms - 65[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749122054001_52tv8dlzd","ip":"::1","timestamp":"2025-06-05 07:14:14.001 AM","tokenPrefix":"90bd137b...","userAgent":"curl/8.7.1"}
[33m[33mwarn[33m[39m: 	[33mToken validation failed - not found or expired[39m {"hashedTokenPrefix":"008c43f0...","purpose":"email_verification","timestamp":"2025-06-05 07:14:14.003 AM","validationTimeMs":1}
[33m[33mwarn[33m[39m: 	[33mEmail verification failed - invalid token[39m {"correlationId":"verify_1749122054001_52tv8dlzd","error":"Invalid or expired verification token","timestamp":"2025-06-05 07:14:14.003 AM","tokenPrefix":"90bd137b..."}
[0mGET /api/secure-auth/verify-email/90bd137b2886e58430f78cbc28127f003f5f366101cba6467379f473ef26481 [33m400[0m 3.271 ms - 65[0m
[INFO] 07:17:00 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/secure-token-auth.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:17:00.765 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:17:00.772 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:17:00.774 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:17:00.777 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:17:00.894 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:17:00.895 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:17:00.903 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:17:01.906 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:17:01.908 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:17:01.912 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:17:01.913 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:17:01.927 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:17:01.927 AM"}
[31m[31merror[31m[39m: 	[31mForceful shutdown due to timeout[39m {"timestamp":"2025-06-05 07:17:11.928 AM"}
❌ Forceful shutdown due to timeout
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:17:11.930 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:17:12.757 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:17:13.632 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:17:13.634 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:17:13.634 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:17:13.653 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:17:13.653 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCT+fhX+j5R/p09\nmT+ocRURdw4AbVSdrUst0DmhDPKI//ch/MSz+mPN+a6i1+sONOgexutp3I00nAFq\nTqeEz6rTIRL+Q2Gxbzdac2ieZOApn7GpyZz7tLMjYHLi1iNGACda+AzX5Pp0d76X\nVRVdsqIQjeCUoOvADFDRDPZ2zre+Qr1L3dLNgoA9cIJDWdQxs2U5P8vk7yitAsUR\nnWFkd7B+BOfeN5gGZA6VJLaX2ip5RwYcLFZqaIBmrr92cbpVasthAQkw9xO4QHvz\nrkUpty/rn+D+U9WJa+uiel+P3m8MUaVVXxCYn7orb8zTjzwc7a5fBpkm+PnePzNP\nxg6NS4eDAgMBAAECggEABCpbtszztybV3KI1PAke4N8l6kDUSnH9NUdwxTCnnSVT\ncBtSRYditYLLSzM3ydkXFagKKsXgxbPZ3a5kIdAfYhJtcJyLTKLcVIlTecNOL23F\njbQqsp0wvmoHIeKJm1Ktc5lFnJ2J/VWnlvv3/itlS4EAQD7Svr+6AKsplEjtEYfQ\nHE2rXgG55dxhiBBLxLmS43nU/7qqaJhOFiKlX2S9Zgwhk7EcljXZb8MNuEZggmc5\nEtSl5kcoGKagd1qJkDKKMq7HY18PaWdVXoj9CH8B5o1PgvVEIaRJ8E3xtaqk2hws\nbs56/o4O8Gyd0oG/m3Jf5O03HnCo9QNXRWceAXjKRQKBgQDN93PA06fa3yKbWv1g\n5hWzxf5ZPbtvIbBu2AX3ap6RAW74arp3CPTutl7FiPtDK0z98nzh3hJ8OdAlPSQk\nbmieaooh6fNnB2RfhtAmC+4rxh6QMbvp3zqQBHYh/3/nO/M7uMiVLA9eGTTT5XKy\ng71mAzNUPrGXQG7f11BRQYEnNQKBgQC37EE56ofWzaAQ/AsoJpZefAN4IDq2nfqo\nZ+JG7p2ZHxOSFhK543KM1Q+bEfTV2cBJDTUlvUoZkmpM4z6cQMaXFnnySdfU3l03\nzbMkEVwrLYBKCCG50HrqcNF5K/I4nNwm0l8kY8qMtgkq3mXh8SsxiUGDKyYAzwjJ\nmI2wcqZy1wKBgQDEEr7CIXvY87SpOoydk0uzsVe6MvddCzA/xSyg5YIAPuIaYNgT\n+5XYLgq4d/ficLVBx3c1OkhUtGC/Ip5mhCjaLkhDksjhGvtlqRw8K/1W9Ksh0Aa4\n1IaWlXi0Utu7EKoz/2wL/j6+8LYGxpZS9PD3zTIvD+PWPkOOmhXe1MITxQKBgQCD\ncuffM76oB8gpu2lh5co8dxenqCkuUVRPPgfbuDiMskgzdXEmx+cbvj7sDnZUzM7/\npt/gPBwUkK9Ginc6B5WncBnxz1LhQZeQBYTN91ZPSbLRtmQcQGNI4R7lIkJ4sasq\nV9pF0Mh3rrZ4nABm7g131ugqjhEYLN/T7SL/A8HwewKBgC40Q20YMmDfT44o+XpV\nJh3yJxPF5Y7GAG9vdmkDLxs0Gu1I2WkP1+MmBsXsLBUZ1fjEgrwd+JqvuJ9F8QN8\nLe9I1PDlW+2ySnpFU421MD0TeJrwxSMiWKc5GczHxiqph6me+IMesmVhb5OEMl74\nRloaJv5SxCHtf5wx70htTSja\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAk/n4V/o+Uf6dPZk/qHEV\nEXcOAG1Una1LLdA5oQzyiP/3IfzEs/pjzfmuotfrDjToHsbradyNNJwBak6nhM+q\n0yES/kNhsW83WnNonmTgKZ+xqcmc+7SzI2By4tYjRgAnWvgM1+T6dHe+l1UVXbKi\nEI3glKDrwAxQ0Qz2ds63vkK9S93SzYKAPXCCQ1nUMbNlOT/L5O8orQLFEZ1hZHew\nfgTn3jeYBmQOlSS2l9oqeUcGHCxWamiAZq6/dnG6VWrLYQEJMPcTuEB7865FKbcv\n65/g/lPViWvronpfj95vDFGlVV8QmJ+6K2/M0488HO2uXwaZJvj53j8zT8YOjUuH\ngwIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:17:13.742 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:17:13.812 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:17:13.812 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:17:13.813 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:17:13.814 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:17:13.816 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"2ms","timestamp":"2025-06-05 07:17:13.872 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:17:13.882 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:17:13.882 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:17:13.884 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:17:13.884 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:17:13.884 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:17:13.888 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:17:13.888 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:17:13.989 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:17:13.989 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:17:13.989 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:17:13.990 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:17:13.990 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:17:13.990 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:17:13.990 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:17:13.996 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:17:14.000 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:17:14.000 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:17:14.000 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:17:14.000 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:17:14.001 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:17:14.001 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:17:14.001 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:17:14.001 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:17:14.001 AM"}
✅ Server started successfully on port 4000
[INFO] 07:18:40 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/secure-token-auth.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:18:40.931 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:18:40.936 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:18:40.936 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:18:40.937 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:18:40.942 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:18:40.943 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:18:40.947 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:18:41.949 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:18:41.949 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:18:41.951 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:18:41.951 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:18:41.963 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:18:41.963 AM"}
[31m[31merror[31m[39m: 	[31mForceful shutdown due to timeout[39m {"timestamp":"2025-06-05 07:18:51.964 AM"}
❌ Forceful shutdown due to timeout
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:18:51.965 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:18:52.713 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:18:53.441 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:18:53.442 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:18:53.442 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:18:53.463 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:18:53.463 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCcQTM7Co0cn5Yk\n0Cumsbn4g67kKCrLYO1VS/4aNuiSrDQrRqAL+JCXgeXKy/r2Emc5Rw1b5Ckk9veM\nQlxQmzKvCAvxKbe/bsdTow398yOzTvTogV5ly63VCenjqWqJiFlkhl06zeKnVDCb\naSL08tP3wedYZ8nOnjdpra+yimbzMjxkXBzIgb8qUqApDAXfhlbLfX7vnC5swFki\nIE7vMpvx09jq9WtJqRelgFlLWkXAOm0LCxCVLZQXy78LyqHVj4ANVaTOnWukfuss\n6gzXJ4f5yf6r00CU5qtL3FG+EI8UocO6SM0zpMx6E5Rle6dgfUK6+LX8405J5Q+z\nTzgmxThVAgMBAAECggEABscUp/H1XLYNrekbZwoOyJk8g9FONnh1/B0J4L83jDZM\n20n60KodWA4wzVwf/sed3J29X1Ep1Nx+sKZehwNo7mZkz1uTv4mPTUNKEV5O92hH\nyLIJky/xQDVoBMhyVLkqWKAPZujd4rB6nPxDxg0UHGalfQINx5kCJpnEyaqBM0Jp\nSXNWs6xN2QN29fposKqNt8RgBbe6eFG2K3AkTvDNtN9nVjr4aPqzk+ztaPDM/9L4\ncThajX1RZUvVgnjHnTh2OBDqU3nW9Oqm08H0n3L13o9udliCWXISp0+EVsayUNKx\nENKdhmERZZ7cVbcQZtELaWH916afeI8/L2iOY4r7/QKBgQDciX5AN6dRG6MuV80k\nY+nXphsX6IijVuD8FHXCj2gzOOhkBPR0zEUYlLOUX2ZvEmCQYZUhuLODqkCh0tfV\nfjVPS/gleyqNHUBN8f1C9fTcn9OOzGAKpUVANUxVKeBGCLGffwzkMUxgb3GL9QYA\nRIMznFWl6SIiIztFkUQ/acbxrwKBgQC1YX5gfrnY9l4+RCKU/m0UlRUg8Z1CPV1O\nXGkMxaHt1u/JP5ftUlWaC34bu8eqazaU3wKbMFEMUfP+deOzKhlwqNhpnP7kJYGP\nkb6U+yiKqoWOyB2VS5cDtZV1x3B/vYM2BBJw2dGeCYDbtRjLuIq3ytmGkesC4GuS\nZPbHbkcLOwKBgQDNIN5boOhyGsDXdDeNp5l0Sj5dKJ8fPsoZ7nXyOC11p3MQxUMT\n+IQ0buvyECJZIcDLythJ+2COESf43QKAw9mWHlV7l2pmw1Ryq6kkRV4ycD75TcPv\nYvZc2LZdaIwA2ElOz4AQKIKgGEiHI6snSJK4yKspnQVwt1CETrAqQ5sWZQKBgQCn\nnV/fJlzyXcH7wpU+oNwGwDpVRlJwCys1pfpCHkSk+RKAJK9uVb7bazFvyZkbKJa4\n/ll3NjA/tWBIT4NLZ2U5Eh9jgfyesvZGyYWYQX1Wn3xq1Q1ZkRAOEnj67YJN2cDu\nYtbzyKaIZ/nXj0RJxtESRXe9fwzxjJh8IadX5tXqTwKBgENpRrAahdxjVolL4SGK\nXd+w2eNhQVAtTOyn5aKuEby541/QBZ2f+NaDk5+Cgip4nhQRCE5Dd90mSqmYfY1j\nqeLHnhuZbFGaCDbWepWaPmllShfHD8oOE+D6niUvBuZ4gUK88PeFFz01p9kM3ktF\ndXl7xPkBnmuC3+cuLLS88gJ0\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnEEzOwqNHJ+WJNArprG5\n+IOu5Cgqy2DtVUv+Gjbokqw0K0agC/iQl4Hlysv69hJnOUcNW+QpJPb3jEJcUJsy\nrwgL8Sm3v27HU6MN/fMjs0706IFeZcut1Qnp46lqiYhZZIZdOs3ip1Qwm2ki9PLT\n98HnWGfJzp43aa2vsopm8zI8ZFwcyIG/KlKgKQwF34ZWy31+75wubMBZIiBO7zKb\n8dPY6vVrSakXpYBZS1pFwDptCwsQlS2UF8u/C8qh1Y+ADVWkzp1rpH7rLOoM1yeH\n+cn+q9NAlOarS9xRvhCPFKHDukjNM6TMehOUZXunYH1Cuvi1/ONOSeUPs084JsU4\nVQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:18:53.694 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:18:53.758 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:18:53.758 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:18:53.759 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:18:53.760 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:18:53.760 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 07:18:53.794 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:18:53.800 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:18:53.801 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:18:53.802 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:18:53.802 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:18:53.802 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:18:53.806 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:18:53.806 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:18:53.907 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:18:53.907 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:18:53.907 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:18:53.908 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:18:53.908 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:18:53.908 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:18:53.908 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:18:53.914 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:18:53.917 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:18:53.917 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:18:53.917 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:18:53.917 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:18:53.918 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:18:53.918 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:18:53.918 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:18:53.918 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:18:53.918 AM"}
✅ Server started successfully on port 4000
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749122359606_bwdomvfk2","ip":"::1","timestamp":"2025-06-05 07:19:19.606 AM","tokenPrefix":"90bd137b...","userAgent":"curl/8.7.1"}
[33m[33mwarn[33m[39m: 	[33mToken validation failed - not found or expired[39m {"hashedTokenPrefix":"008c43f0...","purpose":"email_verification","timestamp":"2025-06-05 07:19:19.788 AM","validationTimeMs":181}
[33m[33mwarn[33m[39m: 	[33mEmail verification failed - invalid token[39m {"correlationId":"verify_1749122359606_bwdomvfk2","error":"Invalid or expired verification token","timestamp":"2025-06-05 07:19:19.788 AM","tokenPrefix":"90bd137b..."}
[0mGET /api/secure-auth/verify-email/90bd137b2886e58430f78cbc28127f003f5f366101cba6467379f473ef26481 [33m400[0m 186.171 ms - 155[0m
[32m[32minfo[32m[39m: 	[32mResend verification attempt[39m {"correlationId":"resend_1749122369448_oigpzx3ag","email":"nmang004@gmail.com","ip":"::1","timestamp":"2025-06-05 07:19:29.448 AM"}
[33m[33mwarn[33m[39m: 	[33mResend verification failed - already verified[39m {"correlationId":"resend_1749122369448_oigpzx3ag","email":"nmang004@gmail.com","timestamp":"2025-06-05 07:19:29.452 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[0mPOST /api/secure-auth/resend-verification [33m400[0m 4.490 ms - 53[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749122638830_atr89dcpe","ip":"::1","timestamp":"2025-06-05 07:23:58.832 AM","tokenPrefix":"90bd1137...","userAgent":"curl/8.7.1"}
[33m[33mwarn[33m[39m: 	[33mToken validation failed - not found or expired[39m {"hashedTokenPrefix":"81ee573f...","purpose":"email_verification","timestamp":"2025-06-05 07:23:59.007 AM","validationTimeMs":170}
[33m[33mwarn[33m[39m: 	[33mEmail verification failed - invalid token[39m {"correlationId":"verify_1749122638830_atr89dcpe","error":"Invalid or expired verification token","timestamp":"2025-06-05 07:23:59.008 AM","tokenPrefix":"90bd1137..."}
[0mGET /api/secure-auth/verify-email/90bd1137b2886e58430f78cbc28127f00315f366101cba6467379f473ef26481 [33m400[0m 186.297 ms - 155[0m
[INFO] 07:44:37 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/index.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:44:37.320 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:44:37.332 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:44:37.333 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:44:37.335 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:44:37.360 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:44:37.361 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:44:37.371 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:44:38.374 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:44:38.374 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:44:38.377 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:44:38.378 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:44:38.385 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:44:38.385 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:44:38.393 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:44:38.394 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:44:39.103 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:44:39.853 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:44:39.854 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:44:39.855 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:44:39.877 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:44:39.877 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC5jFWmrEXqh6zM\nYTbfXaybJ2jDtrA8ccLwtZXwqHA48z/e7GFAplpDhhE65LuwAkvOz7jHLQSCq+Ou\ntacZ27T7ZYwpQ2oXoUnyN8996TCIHdCbbTAzyFyqmPPTLCykr/fULVJtRPlwZsuu\nSj8TbrfymYn+xD1tV1GRLuQZnnSNsKWEKK5ItgnwmsKQoGK/A3qgbefMLpe6phnb\nkILvG5rtI2V4XGLCTUoM6+YbPzH7EvNa7qE1X5FO8myv3mx6kgX0wEvKSIlBBD+y\naW1F7DEGqXq2DY/RKnGLGMJzTWOrG55I58daVafyWtR7vVbzzhhlEwEsEmw6PJZG\naXUeaExnAgMBAAECggEABX9hT7hrasIox1G/fWTn64rwKn8y2yQxLfMNrp07lEWJ\nXyThraVXAy1N84ewuDllw3hHaBETnFmLl2CregW7Z9II7XV80Jciuve7XFQvptw7\n3CTHtA2lEc+ANMrqfSL3mVbbSiUZ9g/Ugq5IV7nXKCKhMCYrouc6D2WGojUeDIYP\n00E+//2IO22p+3C6/jNPBfO2tl3/R5DaljPrDY6xlLRIf0vXzkjCDFDsp8JKEgx2\npW4E4o1tbPeoueeexI1KMhPbyEXrLsg8itCbpVi9cV/XIjsOvQj2OkQCr0j/lQfI\n4A7UEKy1/Vo3SmGfk0axGSiHFQPuL7uDSB+0HW0j2QKBgQD5bmKxKZptnFbSPO6U\nNogwCr+qqorgTNTPGWnKhFCc9+k30/2az3tjMt8FpwN930PptMxR4nejR5lzLl2X\nyLhNE4dBLyU9Z3HTsXOvevxZLjdetved105Q98HOSHpwIex8F555/fISRhcPuNG1\nyctGE/ZCRyEScdxdV2TvlU/kmQKBgQC+b0NEQRlNa5YHXarWbJr1lyzH8g5mleNQ\nluYFOZ9rnO7Vu9SCAFzOH1pysa0/Wax2D8eojKztEC3M9IrPFA/PDiwXvoAT9kat\nGxdMlomCMU3yeiPggTiYbGW8S4+9u6X4HCzH5Nn2YHDFsLXAXcdLcE2xC7OKGTaI\nGlQEL5dY/wKBgEEa0OPRKh/GGNtTUCqbeTyg8ZpIXWtiYoGT7osPskLmapdJ2/4W\nfexMkO3WxBCMwBs2N8Z/yB50R9dKmN9PYturZzhaZ+v5HjrVLI73GPrmF0m/lC48\nzpJPuORxApRWJnXVbGYHJLIkXUybPxGmFEq8VyDBlB5OXeh3MT9fx7SxAoGBAKEN\n9DPLYpzJem7sVslVvJArtGG9Y1R7O24y0IJmw179sDfuzMDNka95cMNDZSQIsQSA\nP/laT/2GC1YlEygi7WPNtpi2Mhev1wIbwU6ymcUT8bo6dhEu+DBgrIHc3co24xy8\np1q/P19RHM70riHsrdotNmefX85RmH7u1VNc9ID9AoGBANGfjQC9aKB/3kJ53QiM\n14pa70PAhF8XB0pi0yhKtIIC8Lw1AdhHegsJXqxtb9MifST2rgvfLNg1b2RwS5hF\nLYj/lCdAMO4EBCN6Tld8aSPnzhsh/V/BPJqMeuPcmYTikMAp15OqgtxmeqEPkcnb\nJY3DM2rwBOccAbczIu2OJ+Fn\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuYxVpqxF6oeszGE2312s\nmydow7awPHHC8LWV8KhwOPM/3uxhQKZaQ4YROuS7sAJLzs+4xy0EgqvjrrWnGdu0\n+2WMKUNqF6FJ8jfPfekwiB3Qm20wM8hcqpjz0ywspK/31C1SbUT5cGbLrko/E263\n8pmJ/sQ9bVdRkS7kGZ50jbClhCiuSLYJ8JrCkKBivwN6oG3nzC6XuqYZ25CC7xua\n7SNleFxiwk1KDOvmGz8x+xLzWu6hNV+RTvJsr95sepIF9MBLykiJQQQ/smltRewx\nBql6tg2P0SpxixjCc01jqxueSOfHWlWn8lrUe71W884YZRMBLBJsOjyWRml1HmhM\nZwIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:44:39.975 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:44:40.038 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:44:40.039 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:44:40.039 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:44:40.043 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:44:40.044 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 07:44:40.087 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:44:40.092 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:44:40.092 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:44:40.093 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:44:40.094 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:44:40.094 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:44:40.097 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:44:40.097 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:44:40.199 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:44:40.199 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:44:40.199 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:44:40.200 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:44:40.200 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:44:40.200 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:44:40.200 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:44:40.208 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:44:40.209 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:44:40.209 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:44:40.209 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:44:40.209 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:44:40.209 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:44:40.209 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:44:40.209 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:44:40.209 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:44:40.209 AM"}
✅ Server started successfully on port 4000
[INFO] 07:44:41 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/index.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:44:41.994 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:44:41.994 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:44:41.994 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:44:41.994 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:44:41.998 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:44:41.998 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:44:42.002 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:44:43.003 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:44:43.003 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:44:43.004 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:44:43.004 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:44:43.010 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:44:43.010 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:44:43.010 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:44:43.010 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:44:43.374 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:44:43.748 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:44:43.750 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:44:43.750 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:44:43.758 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:44:43.758 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDIDKRP1VN4csTX\n15YlTR6UwoT2n8W9LfzG+8G7voghlhCCEx0laOeCipPr94ntTXvoNYDY1K/cfOZB\nQSJUbNGxqRavgb1bH5wbV9UEN/pjFb/7+x42iRw8ojbt086+c6wwI9nmD9+cE/Dj\nEVmCQR8NWBFpk7xI1dJBQbp26e0GW8zogDh3+ARa6UaVVjfOTEE+S623ducyxdyu\nFHQZ2oCD1MpSDVwu7f1MAKAdrsH8/O8mPSKC8suoUbuXjmYQeHsjb1v3HAO68L1L\nsrUCc0DwoiPCewQjXne2kRpyOU3Ty2Q8PMvLGP9NwYhViIATgHHFzSk1JVsgwJ7Q\nHtMfEuVvAgMBAAECggEAN8ByMH+S5jASFNdT1Gx0N+AoPzVS3gDJgEkcem7EsJuK\nWT3rcwgT8SkexXX03goonJQApy1LH6c9YnU9FItJO3qUxG/jblhWYLZvOuBA60ld\n+mNHTcqTcICCz3Amn6RMGhR7vyawWmaiTR4CNI9ikIz5OVO/dwsEMESZq1dRQ+Jm\nW0ZQ90j86CrDHe+iu3LA8wpGK3AhDpqJYuZ7NXd7DADxdNHVvuiojdzNw8/9Xctc\nezpi3fkG3tzoFwmxOEQuoLf7y/E+DsPd0spC0X6C1PCaH4ix5OVuQISER7cNxtDf\n7SCRVmakdg98Bim8OU8FBOVUi7oPfPJ4vcY7OVYVOQKBgQDu88crXvRd6g8snWZ4\nbSHQZXWCSvWaQJcBnGhRK5OzdnmlTIPDqONiNBZ51jlpzZexO0W92N4Qd9i+cBdt\neP4/8yDWJLhdj2s0r3J2m0Ew3RnzPEt5mFOhiFb5R4PL60vqc55LngNrNe4nhdqq\n+7SbsLvs7uphYM7mEl+t5emR1wKBgQDWUleQj9LgvUJdSvceJjpEQArOBDoXTXLX\nfR93vKRvuaFKIEFiEvLALFMGQBbZ8ZZryrPq6DdwCu7k8ugkSbk/8tgHcDDXFGOK\n/3iLqgcJCnNMJCwr2RZbHlfG21ghmOeM0VZcB1MjzIf2ZdFNWEgZjslhxFx4sB0J\nSD3hZcyGKQKBgQChcMahwNetE9QIupdeyazM1Z+c1fQ1sWnUxs2b+asi1uq9CYME\nkHiAAt0kl93WY/cW4QrvhzQRQEeJ8sWBSvvMTQFkbQ6694jg4aCeDarvzpIXyibc\nElR+kFTiurSK84Ao+NB8GlgI+TjcLw1b9A9EGRX+sDRecj+XJdbK8MjrpQKBgFqu\nMlB/Gflu+nJgspg2EncoJaovTajoYwvb7AGMdoKzJxQm+6MUY1N+LY66dTC3sC5h\ncKiWokYsyhFi2WfpLZFqHY9gH7oQ7WE1YHqvcRSZMFlqAKp4yqW4++iui+aDPI1v\nUTvU+Y9vDaPqRpmUHcV6jahpHbsOwOpZf50rplKpAoGANXCLDujxDVushZEAACms\nm9Gxxj5/QxhhfFEGwQcAwBPdR/BHHIccljUk7b7tHZPjD3oIFZKV2uiYyptdY/kg\njvDoGT8ag4kXqS2WEsIZn3BEr7WhwGwwAL61AapDLnR9jnB3+Lu3BJgV5geAjrnr\nU5DIL2R9ISGEI7zijzbTL00=\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyAykT9VTeHLE19eWJU0e\nlMKE9p/FvS38xvvBu76IIZYQghMdJWjngoqT6/eJ7U176DWA2NSv3HzmQUEiVGzR\nsakWr4G9Wx+cG1fVBDf6YxW/+/seNokcPKI27dPOvnOsMCPZ5g/fnBPw4xFZgkEf\nDVgRaZO8SNXSQUG6duntBlvM6IA4d/gEWulGlVY3zkxBPkutt3bnMsXcrhR0GdqA\ng9TKUg1cLu39TACgHa7B/PzvJj0igvLLqFG7l45mEHh7I29b9xwDuvC9S7K1AnNA\n8KIjwnsEI153tpEacjlN08tkPDzLyxj/TcGIVYiAE4Bxxc0pNSVbIMCe0B7THxLl\nbwIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:44:43.876 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:44:43.932 AM"}
Redis client connected successfully in rate-limit middleware
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:44:43.937 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:44:43.937 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:44:43.938 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:44:43.938 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"0ms","timestamp":"2025-06-05 07:44:43.958 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:44:43.963 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:44:43.963 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:44:43.964 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:44:43.964 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:44:43.964 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:44:43.967 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:44:43.968 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:44:44.069 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:44:44.069 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:44:44.069 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:44:44.070 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:44:44.070 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:44:44.070 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:44:44.070 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:44:44.076 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:44:44.079 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:44:44.079 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:44:44.079 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:44:44.079 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:44:44.080 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:44:44.080 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:44:44.080 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:44:44.080 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:44:44.080 AM"}
✅ Server started successfully on port 4000
[INFO] 07:47:53 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/secure-token-auth.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:47:53.824 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:47:53.836 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:47:53.837 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:47:53.838 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:47:53.865 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:47:53.866 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:47:53.874 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:47:54.877 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:47:54.877 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:47:54.880 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:47:54.881 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:47:54.887 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:47:54.887 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:47:54.890 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:47:54.890 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:47:55.544 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:47:56.309 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:47:56.310 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:47:56.311 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:47:56.331 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:47:56.331 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDqN1RwXPif0aAB\n+jvKLMQIGvmyzbZztVyEj8AKB/kVl8YP2ATfVedSLXSzqudEXiwUQLCeSThMcpco\nqZmICHkFY77q23AdWK/rnLH9ZYV0hCdTIT52dPpw9csH1PbAYVzAVsHT1L+9sxrM\n8fIT9X6AmMDjIqSrGqFhSjbbHVm3Yg23e331TKJSDHEkAOrJxrwD7j4KonySSBO7\nVyzA9ylBWGrppFY3QeD2NSRgUCLwipHTKvb3/4YExhil+xrVPKnxntCHjMfOXeBp\n7fetqQKJhbXPpqrGWJ2ZZuwz14NjJKeSgaYRNZUDEZtnyxgRaTk8RD7c4K896Yfx\nufOifhklAgMBAAECggEAPWkPfzypRcJBaXNSfPKa3aMxCFROu+z4GpvUVuz7PtGi\nMWJK+MH92nqnqDot1Cu68/54MLBzDfxXrOY3JsdN7/9UviCWN2ObELRvqMiXItNJ\nuk6zoXyPc9HGj8GjhxKgLqAwxxl3wsX0x3rCpcAPEKm8nXFmaqSbXraGRpJeBSo0\njUZbbmEs9Na/wiJ6tn6gQB2RVEVfykD0+kX5m4RKzpp/+ompvxoxl8pm788dqRz4\ntIL69n8I2RdaFAvPWHF3hRGhMRLq94VuAEiX26/TicIemHo8jDDL/dNMW+jst+zY\nHv4UHY7x1NO8Lw6YtNLIU/sJ6PudeH6vznQClnDO+wKBgQD6Tfz8rDqgnAyyReRN\nF3QXTz4zaUNYxbzncsF0M2Gv3upTMNC/d9NPteykkiom0Ho1flhIRLPKAaASKWfi\n9QelcqubBPDDStiK7cSO/rsbgT70GF5y+64KGW6FHFBZV+1BTaG1dh9YepB08qxA\ni3quRGg3F5mHOHSKK9csTHEd7wKBgQDvi6B6FCaoY8JISeNOPQh+CM/fOE7Nomp0\nGJG64n05CqGpMWx/cX5sZMalD+KUSkaEhNveD77Yow+STlVTemHJYUsWqSvbemPQ\nJQWZdIqPJc8x45svQZWmMfAKy62P2+v2dFY8Zbx2cfhi5PaPqe7ae4AU2crJ1Z38\nc9KojNUOKwKBgFcHtNYaAEyF1bhKquXPKNNN/z+a8wqzvknvUapYjze6V1lTmNFq\nFXQaukxCchuK02M0Kff+w1CSnhiSgweb0OvK4jYFUr1kkcREhdp+YYpftwbiTjzG\nm63xR8dKn/lgpCLXnklc5+s4um+fTRsoJCDhsiatsvkcPREpyygg8BfLAoGAQvzB\n4MG32ckj8IExHpT0xgIC14JwjxLHQDYKsr9Zk1UExkK6+5yqZPd9kXUywJNQywg4\nUA4JKZ3X4esj81c690zM6cZfLF46gV+JBFPR15wUJ/hlUj698Z7vaKVyoNM4VlBM\nOVGd9WWDt2weAyjbUZ/Nvob1LaIeLxXYqCfSAMcCgYB9POle9VG66Odb3uxL0qSu\nSAXfaTp+wGGXl5nJUj5dhDITGTLgYgN96bLhthd0tchWTMwRkui9uENDYL6K83fA\nL801Acbbvli1DZ9rmr9UMPMAXf3xkQzmSW2FuIHZFVf/mGC13FRuw8uq5aYA4y28\nJrjyppr+ryOiN3b+ceXuyw==\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA6jdUcFz4n9GgAfo7yizE\nCBr5ss22c7VchI/ACgf5FZfGD9gE31XnUi10s6rnRF4sFECwnkk4THKXKKmZiAh5\nBWO+6ttwHViv65yx/WWFdIQnUyE+dnT6cPXLB9T2wGFcwFbB09S/vbMazPHyE/V+\ngJjA4yKkqxqhYUo22x1Zt2INt3t99UyiUgxxJADqyca8A+4+CqJ8kkgTu1cswPcp\nQVhq6aRWN0Hg9jUkYFAi8IqR0yr29/+GBMYYpfsa1Typ8Z7Qh4zHzl3gae33rakC\niYW1z6aqxlidmWbsM9eDYySnkoGmETWVAxGbZ8sYEWk5PEQ+3OCvPemH8bnzon4Z\nJQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:47:56.421 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:47:56.486 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:47:56.487 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:47:56.488 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:47:56.491 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:47:56.491 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"0ms","timestamp":"2025-06-05 07:47:56.529 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:47:56.534 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:47:56.534 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:47:56.536 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:47:56.536 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:47:56.536 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:47:56.540 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:47:56.540 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:47:56.642 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:47:56.642 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:47:56.642 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:47:56.643 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:47:56.643 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:47:56.643 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:47:56.643 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:47:56.649 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:47:56.651 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:47:56.651 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:47:56.651 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:47:56.651 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:47:56.652 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:47:56.652 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:47:56.652 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:47:56.652 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:47:56.652 AM"}
✅ Server started successfully on port 4000
[INFO] 07:48:02 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/routes/admin.routes.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:48:03.000 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:48:03.001 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:48:03.001 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:48:03.001 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:48:03.007 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:48:03.008 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:48:03.010 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:48:04.011 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:48:04.011 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:48:04.012 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:48:04.012 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:48:04.018 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:48:04.018 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:48:04.019 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:48:04.019 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:48:04.578 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:48:05.200 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:48:05.202 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:48:05.202 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:48:05.216 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:48:05.216 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC+ypl7y7lftAP+\nEwhtUY30HsBrASuOv7/OJtq5ZMY44vpq8btVshkMhvwh7gIEiHZEV48KNrgUS2RA\nExNe1RJJdjDZ8Hef5TliZYHS3pUWNYf8HRPpGoVQocS79RgGxNBarGKIbC+EkHhV\n9snxJS1hq0HOhLmi0wIjCgPIGClyCOuwO7LJOb4Tx/cmcqbhymYTsWk6OQonZOHQ\nFUQt6XwmHfJvDh7A09e0FfZuuMHOfjWSYjRuEbQQCwOWjFi19VzmBKqeypJbAkFm\ny4VsS94FQEqnHrx3mX84Rl9w5FayE8mPcbZuZno+gr/o+DbdWbaobuMrMVyhYtYg\nAaBPqVajAgMBAAECggEAGhZXsC6l9SkHFrmBgHkTQNrnknoBe65KSqTTaWAXHnYi\nqXbOF6SXejgGx5jkm7wQ971FKK9csiGw3nX9Qw09R+AqQ9J2eN194C9i9fNLTVMa\neeV78HaY3fKQlOapV1uX5Z4GhwLL6INcgNySti9QKjehctyBCXtyolnfNH/hQt8q\nyCPW8u/M1wmIp014GwbXzXJVx31FzDl1xrljcbSsjSAF1TLZFMDEsibv5Pnx6doH\nKh9rSp07DmBFuzss/ulfYMVr2ca1V3P/XC5fYKXiWvXw/YQCyhTRYFHuzoX5ptVS\n8Ijyzysh8o6MJpI3lkpNPg518PqJ5Ax5BVPfggUYgQKBgQDuDMzM73qmOauO9nPm\nBnBpU6DUsTOUEjoqAKEuIOOJA6IlWTsvoFEi/PEM0lQXDT8TRj8UCwSjWQ7uHRlH\nNTN3t2m6zcyLyMA3f58AK3JUbxrHCPH79BLL46coml5nAIcf43icdzKHlSLeA9ii\nssWTr24hO2GpDfPZoviOAhmQQQKBgQDNLYr6VyO+1od9VSiuC3Y/BTIrhf3amaFj\n9RK4hAj/y9HZkDDbxOWCuSeKHBkMzo+jiSu+Bog7fh/gd0fsgSznUhBrkX9oabW+\n0hHSYxEo4y/FgwGiQeM4T9BKc4pcAFATdsg9alz39KNBMf1vab8H6IcOkqL3oyK8\nVHFoS+Mt4wKBgFCebyGcnQn8j/hryNaHKbzSAK7nkFM+VQpyiiOoKcb2PwytCplX\njwLtbOltteLUrp7ldGliTeDQQXksy6nM/7A0oo8MMZDJnSduhje1fxPPSN9NTT6J\n62+3mp3qobv6dsi67db3m1pFjLhpzw1SxAz/JaoFhU6Olh4HzmuxlFzBAoGBALfB\n7TGOL5ZwPkJyrY9K9qk0dx1h0NwiMdf7GrwkjIbDvXsT155Mdp0gRJg91/WPXjfB\n12pGIWbe65+2VLUtb9Dwv4IHektCOaLgM1Pwo+Kxrgw/64utZNn/KXY0ipshMJZu\nEKJoi0ELWdc+9VL+Kzfi+mqDy+7rrWVsX3FgXeOvAoGAKHC1D2mxDWrrFzTIVwUe\nMVaMGPAK/1UoRpP4oDiy3GhNLJAxv8cuO5hhO/X9Xl5ftsdqH/3vXsf6B3SZnlP5\nHFWjNd8bKuvZp2ej/Vy3GUrAnAmd6/qOqkSoFu+gxVIJIFw5jQprBhKJXya6+B0I\n11Wvbr+G6t350OGr/JdOFhM=\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvsqZe8u5X7QD/hMIbVGN\n9B7AawErjr+/zibauWTGOOL6avG7VbIZDIb8Ie4CBIh2RFePCja4FEtkQBMTXtUS\nSXYw2fB3n+U5YmWB0t6VFjWH/B0T6RqFUKHEu/UYBsTQWqxiiGwvhJB4VfbJ8SUt\nYatBzoS5otMCIwoDyBgpcgjrsDuyyTm+E8f3JnKm4cpmE7FpOjkKJ2Th0BVELel8\nJh3ybw4ewNPXtBX2brjBzn41kmI0bhG0EAsDloxYtfVc5gSqnsqSWwJBZsuFbEve\nBUBKpx68d5l/OEZfcORWshPJj3G2bmZ6PoK/6Pg23Vm2qG7jKzFcoWLWIAGgT6lW\nowIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:48:05.276 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:48:05.325 AM"}
Redis client connected successfully in rate-limit middleware
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:48:05.330 AM"}
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:48:05.332 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:48:05.333 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:48:05.334 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"0ms","timestamp":"2025-06-05 07:48:05.356 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:48:05.361 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:48:05.361 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:48:05.363 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:48:05.363 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:48:05.363 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:48:05.367 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:48:05.367 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:48:05.468 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:48:05.468 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:48:05.468 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:48:05.469 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:48:05.469 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:48:05.469 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:48:05.469 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:48:05.475 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:48:05.477 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:48:05.477 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:48:05.477 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:48:05.477 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:48:05.478 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:48:05.478 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:48:05.478 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:48:05.478 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:48:05.478 AM"}
✅ Server started successfully on port 4000
[INFO] 07:48:42 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/routes/admin.routes.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:48:42.235 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:48:42.236 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:48:42.236 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:48:42.236 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:48:42.239 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:48:42.239 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:48:42.240 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:48:43.242 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:48:43.242 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:48:43.243 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:48:43.244 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:48:43.250 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:48:43.250 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:48:43.250 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:48:43.251 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:48:43.895 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:48:44.626 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:48:44.627 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:48:44.628 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:48:44.649 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:48:44.649 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDDy4BXdbuepRay\nT9qlKA1+j+2fANAp2JXLiJzEsrRuhDxPjZWShmQxzp7D18XV9VsrwANC3j8vkgb6\ntX4ITM+ZRUcCojttHqnLb5bQyjn0LIUiBRElsHw84bZTLBhvFSDCeAlulJlUDkmO\nLvg/ckHC6nKvaoi8P97bVdLZsLexb3rxX9zXhbclheZ6/7UFR/y12+W/hVPf3Zco\nCtlpX9oNbrOX8YvL224YL9LDUizN9q0Eiac3DG1t6M90ZGusIEzrQpVGMhxX3L3I\nlVYpc2MU5ATLFEMXZ8CVES3JAoniLnME2mxNfZfbZgPEw+KFuwb/j/K50mmuuLyu\nQWQ3HFE5AgMBAAECggEAH29aya/zUYM746ECf6WwlPNSuUaOJUnKswTZ9pKieWPt\nsvAOZZoCGCUORG8uKi3cV2fani/EgUS2riXZeEesxPTkc73MQLa9mBXwZtExAMzt\nCws5N43gRH4QocXgnmUL/2z6RrDA9Ufd82ADJ1yWxk6R3ywBjAfNJfXfhmfi9i+h\n4N7PvkaS02de6ie/WCR2tVLZdHzTP7xEtd4UStvGtfPcKMkRb7Mk1J0ZprjhxiIM\n0iP8bYXFSp4b8oCzRUsjAY6+Pe+nJzQJab+pDebfAdDfnjfGUPBdBUbGJ2gPT2nK\nDhdEkhH0kiQh4TOBdYW1i5SONj1NirosCsQ5Lc3CoQKBgQDpCTUpmKIFLno1zU+M\ndHcBCWh/BXwQOIynNvrFOV5/iQZWkgWr55TDoph+BoUAaQRJBY+Z5OqiatlV19/z\n6RbBbkOZSaE/Qx92IQjqjotOfibUlY5jZHu2PLxEhiYZnuq7FAv5ds8JB9jEGG57\nEgnQaQtquBOCX9dwxXF1ZegopQKBgQDXFtCdnTu+LeFyEIyNMngociq7p4nhAZeU\npvuvuwZsuP7EwBz3kgbPpDWEn4s6I/EBQqSj1ofpEwkWO56nAsWbuUq0PstsdgfD\nZubohp3/dCUK3D8obZ0dbbLKQqlHjBTrq0mwKo8PMGC5b8RVLe8hof++Sr9YyEsp\nb3KnMGiOBQKBgED1DBiYLzF6jx5IKJBiNnnXgYVGphpvaOWDcctf/nNWYqnm8iXE\n27bcr90RPCmtHECuiCTBppW3avV+wzJeGrW4Yqdr2sKjlzV6Z93Z9gLfLzu6pIIY\nFFPsAh6nth8WKSAUqnHTKErAITAoD0PG921cmo4Y2XdR99+7abDrwxbxAoGAJ30I\nz+cOENxbh5WCOGoLpWFQdyNLLQQd0CzYCGtNwqg0HesnZkxo87YyHSctaH8wwAp8\nL5gzW5cjE/HeLstTfEOIc48TydXhlv5NZmNQnpW0N0o4TjPRpJV/PaL/cSNGs/2+\niZlGqoM3PtRGN103ifUz/ru6ZZJgOjs70XYRvAECgYBsF/BY3cnsRbvcXWn6MOMH\nQxx0cuFhDUCY7JLSAePzgvnjwEV4jy89KOb1ZgU61QgryRpRrV7UZPEryukDcqbb\n+z5v1X1KONgxadVESi5JJ8L2vUFYT2jl+cGFkvfEd9tiyYi7GLzmqvrwElDXc9eM\nV5FZLdRyavhGFglBKgaCUA==\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAw8uAV3W7nqUWsk/apSgN\nfo/tnwDQKdiVy4icxLK0boQ8T42VkoZkMc6ew9fF1fVbK8ADQt4/L5IG+rV+CEzP\nmUVHAqI7bR6py2+W0Mo59CyFIgURJbB8POG2UywYbxUgwngJbpSZVA5Jji74P3JB\nwupyr2qIvD/e21XS2bC3sW968V/c14W3JYXmev+1BUf8tdvlv4VT392XKArZaV/a\nDW6zl/GLy9tuGC/Sw1IszfatBImnNwxtbejPdGRrrCBM60KVRjIcV9y9yJVWKXNj\nFOQEyxRDF2fAlREtyQKJ4i5zBNpsTX2X22YDxMPihbsG/4/yudJprri8rkFkNxxR\nOQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:48:44.713 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:48:44.762 AM"}
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:48:44.762 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:48:44.763 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:48:44.763 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:48:44.765 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"0ms","timestamp":"2025-06-05 07:48:44.786 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:48:44.791 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:48:44.791 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:48:44.792 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:48:44.792 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:48:44.792 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:48:44.796 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:48:44.796 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:48:44.897 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:48:44.897 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:48:44.897 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:48:44.898 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:48:44.898 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:48:44.898 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:48:44.898 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:48:44.904 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:48:44.905 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:48:44.905 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:48:44.905 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:48:44.905 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:48:44.906 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:48:44.906 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:48:44.906 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:48:44.906 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:48:44.906 AM"}
✅ Server started successfully on port 4000
[INFO] 07:49:01 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/routes/admin.routes.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:49:01.767 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:01.770 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:01.771 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:49:01.771 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:49:01.773 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:49:01.773 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:49:01.774 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:49:02.776 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:49:02.776 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:49:02.777 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:49:02.777 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:02.783 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:02.783 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:49:02.784 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:49:02.784 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:49:03.340 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:03.973 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:49:03.975 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:49:03.975 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:49:03.994 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:49:03.995 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCzjuJADjCwaKY0\ny+YYgzZf0xZdRKv1Ku6L1m6HXYQXvLfdRRwPSO0n3Y1nZB+2mtNhZQh8e47xtsP/\nrGg9L0rgtHnnBeP8PV2bEsQtEKmjTfjj9/kgXGSXGdhmwG1ip34kasa9l137x3iT\nmD0Td+mZndnUfksQx3F3GpJIZr64thfJJaHMQr0ycHLG4mjrx7p4Fn1vjDNL+5sd\nnafSxMbb1rdPMCj/SWexad8z448qWxL0le+BNdAhrO43EoqOapBwSsRpWQRIvobH\nmUL3XNfAsIek87ZGJUTHMv8L1gYnb00j0vR6dLpmaI8KGhLrOx0OUE4rjG7FPJVw\na9nU7LadAgMBAAECggEAKMDMzCIMXfWah5AhrL2XKT+VK10LNE1mr/lew71vXh3Y\nk1F8sWFpZitsTSOV6RGR2WCfgPVgN682JADi9cQWmBKOOmeFW7on1Sr4uIu4HNb1\nHvSop/YgZIUarxOMoCAIysYrTludGqimzsT2U8VbESEZEBgL/IZv08sFmYYsUmqs\nVhxbztzYfxeeVTbQVPrWoN6sYR6d9SgVIvRE3w0lyJ/1IFBICeUlKqsESNuV7dOG\ns75/OVdqJcTdyYsVKUv2gb8I+O6dRkt93QCBYXYTCQItw8NFII3W5jzWD78eTtt3\nsTqYrxfiJjZNjRVGJJ/3Wud3OifB9E5ly2aS8XvsxwKBgQDjJn/ZE6HNCRZxz9mu\nXgVvffxHIBmmbyUDX8DFKKG+Fa+zpahqh34Uo7kA7oeKNKOu3dF7xkd9aKHljB80\n1bv3yFUSikGUyrdGg9uYGjFNCHba1d5cCrAHoRFy9r7G230V6GtprP2K2JpalyQ+\nKI6V+Ro9htTeZMa20u7s9yjxmwKBgQDKXPvswauTpYzjbP5S92C7fPMqXHELAOTW\nj1gS3+/jE/dcvW1n1/kNVhfOWDl9Zsy/uPLaQcP3x01JC7pzOPoNHfbER2DIp1i3\nCRbWgI06yrkbT5yuiq3hRLx0iWoiA10yRaGYYxxybJ/If0TXYwYXoPtoqBuZXBMC\ngvFbquI4JwKBgDS5fvt4HxpkfZ01TaW3lTNn3uLzhICpU8IQu8IHyGNCzWG5lfoE\nMTPBPPQGadeemE/ClRlR0M4/NzT87VFqOxMsoPKIvOg4lYn8mUAY9FCZIl1xPwfG\nQ03CCTbSJz4pPEOVizkgOkm8NTfJ1VPIPjB5fanCXi6w3Z8aHvNJ+2r5AoGAJnLs\nWtuhYfg+gKeg2tqtwnHHMfFGeTS+RhYOQefSiG6uvSwwsV5Tr7j/5PDWW4FAvdzC\nJ73/IgD4KjzUPDhDKmLbFAgL15QUQxKzCCZ8rwL9kLbbqj4nM3n/5JSHWdcRyg94\n2J9cNFF3On0T82iZK7wmiIgIVmcsJXoDqcsaGFkCgYEAhMQJxeaHR7ejIRmkW8iS\n9lPJpTzGn7YP9aaAoJB4RDkYSrqp4XC4RylvQblC0REC4IIDh4lFKnVcMyW57VdY\nI4oEPaLaqrSp71YDwePUd4f4pVPCQoChhCkO0I3/k9hTxlLJ9z7w7A8Yxt1PX1NQ\nuZHJoAkme0yrNrTlZ+XA26E=\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAs47iQA4wsGimNMvmGIM2\nX9MWXUSr9Srui9Zuh12EF7y33UUcD0jtJ92NZ2QftprTYWUIfHuO8bbD/6xoPS9K\n4LR55wXj/D1dmxLELRCpo0344/f5IFxklxnYZsBtYqd+JGrGvZdd+8d4k5g9E3fp\nmZ3Z1H5LEMdxdxqSSGa+uLYXySWhzEK9MnByxuJo68e6eBZ9b4wzS/ubHZ2n0sTG\n29a3TzAo/0lnsWnfM+OPKlsS9JXvgTXQIazuNxKKjmqQcErEaVkESL6Gx5lC91zX\nwLCHpPO2RiVExzL/C9YGJ29NI9L0enS6ZmiPChoS6zsdDlBOK4xuxTyVcGvZ1Oy2\nnQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:49:04.095 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:49:04.166 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:49:04.166 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:49:04.167 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:04.167 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:49:04.168 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 07:49:04.196 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:49:04.201 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:49:04.201 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:04.202 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:49:04.202 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:04.202 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:49:04.206 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:49:04.206 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:49:04.307 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:49:04.307 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:49:04.308 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:49:04.308 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:49:04.309 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:49:04.309 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:49:04.309 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:04.315 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:49:04.318 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:49:04.318 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:49:04.318 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:49:04.318 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:49:04.318 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:49:04.318 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:49:04.319 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:49:04.319 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:49:04.319 AM"}
✅ Server started successfully on port 4000
[INFO] 07:49:15 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/routes/admin.routes.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:49:15.705 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:15.706 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:15.706 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:49:15.706 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:49:15.709 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:49:15.709 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:49:15.710 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:49:16.711 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:49:16.712 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:49:16.712 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:49:16.712 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:16.719 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:16.719 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:49:16.719 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:49:16.720 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:49:17.270 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:17.911 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:49:17.912 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:49:17.912 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:49:17.929 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:49:17.929 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDTbPmc2jw0RfgB\nglXa3tmv5e/tAmS/gqAlhicZZot29Zp1dnadiqzyH3yrtbA72dnE2AJ3N0UWtn80\n3JLlht8GFFMCd32Y8II2OuZgwtS3VNfxZxrnJBjqM66ydEycqeJ1/0lrEHUNHlW6\nO5YPuVtQEWm5svbew6HwQjnQfGrOwxIyUtjO2rO83tVlUXVpe9GdcUdiJ6QaMImQ\njh9E+5SvxgRzDpb5C6iFXOi31IujkuguRzPOs6jw8OCkHvBWuO+VsDoa0zD7CT2i\nHzncPEvZSOy6vByiOv9KzCth77Vmlj1b8+/QJ9A73UfRstcQ+TIWqG0icCB2LHtq\nFE2gaukVAgMBAAECggEACLNeXlcYzSnn99/uOpCbMsLqqb1EeiEdCA5KQ6BVsvKO\nhbD3VqpjTZ+AGOzkMMJZVOFy0Ickv7eI6pr9LJbtTKm/dMWIFKgpI6Qu4OKDsHu8\nW0Hb+JEiuVihItToZjYTjLmRwuctefm6m2xiU4lUOapNyIeV4zr3yhRfnrXQC2wm\neSbb0qEQ7RW5yFoTxd8y5Y9S5N5XEzcyjRNWVqK3Wk57YoRt7ASdusIJDm3wMabG\n1+PHiNKyrVOJ+EouSVxX+Jjeladbta2DcMhdWovmpnCGxkzWtSjOJoS7fRlBR98C\nBD74JqPLvQocvO9F1skfiJh4ImdGQazKtahKavie7QKBgQD73F3tQwlaMZkLeppk\nuPo2L6Tj13gQA5Yw/HUhwgpHPx44ODEEEHYw0qkOA8VWh0B2EscWL760rYLOP2Yv\ncgPtmAFtua0QUCXdIlnPKFHXKCKl9dwjhKaqyMtmfc2kF7PiBVdz3cPqIxnDXPMa\njnv83w8xZJCJles7axEjFR3N4wKBgQDW5n0iFDqQTHfrUklTVA59pZcwvbsRtcIj\nxuP8R7UHe01eN6fm9yaHm/GqP/jv25bWFxMzrh89urlpEmlYbf80NZsh8qrKqpUO\ndbpkouaj7hJSpol//1iYiPF8e6ZyBRqPbOs69qqsZpzPoOLIjx34+DEJWeIvOlRj\nKz7E3BMepwKBgQDwZKi+IqMVlIuImlAtXSVtfNI8qletqU68mOrP+t5GnKcib/fQ\n8kltVlUHzG+ZpGTRjiC6O34iBA76/yZwmLnJGLIcYgIetPE+/V+NS+W5oFRZ5a5l\ntGJEVn1V6TPTsNAAJqsPK5eorjIT928OZPtRJDLjKSKQQCkTQKFNxAT7kwKBgQDN\nCXLAzi4mOV99XbBqWdvNk+2R6qSOvC10NzKVJNGbRtDFoTKIkqznXCmSd6ELMSdU\nMwX2HB7gpcR7dL6gSarh5HeUR1UfMuwutLLXi/mk1OQUiaLNRhMAzkAhtlRTm30A\n9TnmsyyaevkIvQdDthEx15PpySGeT/ft+nfUGeoAJwKBgGIlJe7+9UWv/caDYNrg\nLj6pm/JxlqpyV+TNaLnVrF7CIpV8T9y7VQgMNAnAbpZUhdNteOGIq7MnO3rbDgpE\nkYeaV+ED4LyFewTA6LGcZ43clAw1xPDVBa6pVKpLc6ZY9OcNN25pF+AUZj4cBDDm\nsOvNFPcp915Avf1YESfQ8l20\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA02z5nNo8NEX4AYJV2t7Z\nr+Xv7QJkv4KgJYYnGWaLdvWadXZ2nYqs8h98q7WwO9nZxNgCdzdFFrZ/NNyS5Ybf\nBhRTAnd9mPCCNjrmYMLUt1TX8Wca5yQY6jOusnRMnKnidf9JaxB1DR5VujuWD7lb\nUBFpubL23sOh8EI50HxqzsMSMlLYztqzvN7VZVF1aXvRnXFHYiekGjCJkI4fRPuU\nr8YEcw6W+QuohVzot9SLo5LoLkczzrOo8PDgpB7wVrjvlbA6GtMw+wk9oh853DxL\n2Ujsurwcojr/SswrYe+1ZpY9W/Pv0CfQO91H0bLXEPkyFqhtInAgdix7ahRNoGrp\nFQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:49:18.024 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:49:18.094 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:49:18.096 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:18.097 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:49:18.098 AM"}
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:49:18.099 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 07:49:18.139 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:49:18.144 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:49:18.144 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:18.145 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:49:18.145 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:18.145 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:49:18.149 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:49:18.149 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:49:18.250 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:49:18.251 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:49:18.251 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:49:18.252 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:49:18.252 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:49:18.252 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:49:18.252 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:18.258 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:49:18.260 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:49:18.260 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:49:18.260 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:49:18.260 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:49:18.261 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:49:18.261 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:49:18.261 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:49:18.261 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:49:18.261 AM"}
✅ Server started successfully on port 4000
[INFO] 07:49:21 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/services/EnhancedEmailService.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:49:21.396 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:21.397 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:21.397 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:49:21.397 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:49:21.400 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:49:21.400 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:49:21.401 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:49:22.404 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:49:22.405 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:49:22.407 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:49:22.408 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:22.415 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:22.415 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:49:22.416 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:49:22.417 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:49:24.084 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:24.830 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:49:24.832 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:49:24.832 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:49:24.849 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:49:24.849 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCLDqHpz79ey2pX\ncO98QvSJUXURJpIb1OICRxDjNA92uya6FHezGnm1KmJpA2oMdoyW6RPRam6JFAA6\nUoegwx6GPM02OWw81dO+zDDD9dk3h/N5P7VIJmXNiQNa8QzagJP57dgeqt0T6jCL\nlrvKbV1b52nEP4FmEULoT10hlj2GSfikyO2Iy6J9+yMHdNw+BdZ6Ba0vyC0PhvVm\nG3z1PwBt9CfFIl+iCn1mI/cbMRTi84NZGVhcLO71UbZQK/5tB2/hAaJ5tItvtk9w\nL4VKnq1U/fLcm+dX3SHGhIwuP0ici4h4wWlmaJDXolCgEhfKe/rRTbfz1aEq6T9s\nAD0/oAWfAgMBAAECggEAFq26lF0Fs0UY680xvEyt1bNg6fzQuWnyY41e4LR94nmg\nAEW+8TPb2O23rQlvLecrrfUHVBENQ/KXcuuWI7mOwd/VVrGYyHcrGHlJaWbawpFm\nkPC7Slq7dwDlzjAf+NwdcMEXN9valcPiSkcOth3jVaNxKXNzUXJ2kgKs3VcZDkxx\nOM8sK7PHecq+XvbzJWIaJDNRF3rRd4Tnml+74F7Z737K55Lc05mH9E0xSchz1dAn\n9/u5rBoBjuqQkaeQiYE5DaM1uBfLUVfYtdaXTrFzeMQpMVv1RVTeOOwa9eIU+RWp\nkdR2b9tMI9txm4qM+USfdaJP5ccosC7LJBu1JGV/4QKBgQC84O6V5wnjreQdx5Eh\nBJECfRVhhJAua7XNLqb/1AxTBDJx81SeL/ehzMsGr5EAyHjh+7yadLzqZsWj4y2d\nlwblJhhIWGu7ZscCBT3igBmeJW3Mb8Ri5ERcNoQWH4xQcFFraTMvNreWdlJ442ti\nuGbw0pj1oIK6TDW4EI58/Q2GTwKBgQC8eTwo/FFs3JJBGFJ+5iO/iMmfhPZs1wg1\n2KO5C6Ppe5dKceJYHtWLiJ4tJUlR5kgAnam6zXEs9OV0a+OCHFZGPZd+aLgQlqam\nEbnTZcUsUkcC+w2qDmQY8TJOhaHrZQxf7drx7vL++6oSgYLzmp1SHUHscBJ0HF9Z\nE9t9f0YHsQKBgQCvBxWwrb+5T7vzaKrxWOTz1GvKyWg+zCtVrySsL5kYGOySMfY4\n/KRSOI/vayRJAH0clQYKb6Fc6c2+eFgeEAUgtfOMnvt+VtiV47ucOC8FIRQlfXEU\nXwmGFjLCuYtyQxMAISWAXAk2kgEM61noyo8CHXYHMC3Ua6jgH9+arXkp+wKBgA5z\neUJnPlMLgodNNx4VxU3tThBWIJLt1epTBxKsKtA/MrV5j/JTwunk+sPZZQrLjl/F\ntvrkv7XDvUg08YfLZm4SUOhXXS2gb3yyRT5JQloIoPtAhqawXcpvy/yrUGP9JnrA\ngRYlzSnx3/N1TLYi98cRCTn4yeFvP3xUAnNX6+WxAoGBALxLikVZJSZlzlarIzij\ntzNC+8wN7G3aPSZEV28ozUpRMznM/0DL34pyvaOopuSZ2VUZFfXhlYhVNFj9V4yC\nDDe9ODK9snJm8BAYjRwVvbr9glGivEYg6iNYaxMGcS7J3FrhsjenIbXlqpFSKPeR\nUP4sM6gt6kJ8g+oCy9A/3k0e\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiw6h6c+/XstqV3DvfEL0\niVF1ESaSG9TiAkcQ4zQPdrsmuhR3sxp5tSpiaQNqDHaMlukT0WpuiRQAOlKHoMMe\nhjzNNjlsPNXTvswww/XZN4fzeT+1SCZlzYkDWvEM2oCT+e3YHqrdE+owi5a7ym1d\nW+dpxD+BZhFC6E9dIZY9hkn4pMjtiMuiffsjB3TcPgXWegWtL8gtD4b1Zht89T8A\nbfQnxSJfogp9ZiP3GzEU4vODWRlYXCzu9VG2UCv+bQdv4QGiebSLb7ZPcC+FSp6t\nVP3y3JvnV90hxoSMLj9InIuIeMFpZmiQ16JQoBIXynv60U2389WhKuk/bAA9P6AF\nnwIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:49:25.041 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:49:25.109 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:49:25.110 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:49:25.111 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:25.114 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:49:25.115 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"0ms","timestamp":"2025-06-05 07:49:25.156 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:49:25.160 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:49:25.161 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:25.162 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:49:25.162 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:25.162 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:49:25.166 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:49:25.166 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:49:25.266 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:49:25.266 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:49:25.266 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:49:25.268 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:49:25.268 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:49:25.268 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:49:25.268 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:25.276 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:49:25.282 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:49:25.282 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:49:25.282 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:49:25.282 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:49:25.283 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:49:25.283 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:49:25.283 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:49:25.283 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:49:25.283 AM"}
✅ Server started successfully on port 4000
[INFO] 07:49:27 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/services/EnhancedEmailService.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:49:27.439 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:27.440 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:27.440 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:49:27.440 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:49:27.443 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:49:27.443 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:49:27.444 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:49:28.447 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:49:28.448 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:49:28.452 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:49:28.453 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:28.459 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:28.459 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:49:28.460 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:49:28.460 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:49:29.020 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:29.625 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:49:29.627 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:49:29.627 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:49:29.640 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:49:29.640 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDDCQy3s+U6DNOc\n617PTj80TtezqOSkUCg4DYCrfGj6j38cbSnrd/MZqkWeBiLuEISbkeKmIZiTrpM/\nwTn5/1tcqg0JOREUsKEOQ/bxfRYx4vPEBUP7eF/Q2LcYytjQJ8UBZe+KDh5deAoH\nOia1sYfWgRell85t4sjMFL90qtIfd7s78PSLn4K2ONWkewJKNa+1DcbjmT4AK2iq\nTq6MepimKM03we77ZqZR2cLE77JwjB4pwmFDl4HpbmBfcjxDhw9p+0yyqfZWINan\nTbS5bjwfs5+7OQY6osOVxntWIu+i2N/wW+6Zh5/MAg3n9V1GQP7CWo0TfW5lPtsV\nX/9Zg05zAgMBAAECggEAQpOew0DGEYxaWjkgeqyvt6foSvxu3EY+jG/TifZkkY+V\naPs8sZQXKJ4uuJRIrTJ3SfHBSEu0nUkdG8jWhSftpJKp84mG8qSevdNmgyXbgzkB\nVFslyzxanNy1l+F6pIfG4MTOwbYzGF4HMlNf7msFPyx/CXhqL6mYOM4mUumS48lv\nDVTNOr4lyj51ohMuL1VexN28wAm2xedlz+cWvYXgiY4UeTRiPMcILfs+/gOZiizm\nzdkDDNH3lVw/er9xFX1VWHocght/iJVcV9+UW5n+NlZs9lRa9H/NFmvNQk0sZWhR\n/6qjTnXPeqlmaXBbAkaBn7EwL3dpJvPNzfX+dnfRPQKBgQDtQUAvMD2Oaimnvvp4\npr15jnnwKpLccfxKSbXM7C3DM7TKZNRfy1kixQk+YxADLA7zW4jsYGsR4gjc92DG\nDzzuOIgFVFvuLmy9U+Srn3IxwdHFkL2Xr9K8y6YUMNn07JVmeXMP87KgCx+XoPEj\nDQuaaGBfX2DJX+q3UPnXSjs4bwKBgQDScdxnI7Iv+uD9kOe5Ha58MP8TpJClFfAM\nILkHeRmwIb5REZ11RGVFj/2npC+HSa3XPrZnwiGf/TDyBYbOp5vRfnIm3JXdT6Kx\n3C3yQNMAeGlbu8zxlbzkglVpQXbtTi+R+c/QtvMZ07LRVQ3ebk9rqU8VDaRQIasH\nun3ZsRzkPQKBgH/HBKplcMGiq4yMbplMM/+jnEicpTvUp+vahu82w+69ikD2zOpK\nulbfh3ryH02WDPdD9RpZU1DuS5e2I4iH7GjgSWGVbW1501akOCO2W+owWKnuqi1n\npDfJ9kgphzlBsbTe8/lDZpCLbRhctYILJJSkYkL7O0U5Q1A3bFdmwz5BAoGAGihQ\n7vj+4vvaD2p9gwLvdzxX2EcyO3LYnYlLtmQVD1GCaG06FyNjOxxEuRutVLGRzBld\nbtQwfcRo2wxYz0MCGS4QXkg40INfg6AMjfoEwCA3aFGVjcnA6t5QY37hm2mGfCyC\n6jxzRxiLN33M9YLcmFM5IzLI47Trn1BM6EwdfTkCgYEAvoFkgchPyiN3ni+SUhpP\nL/Sev53xQlSQwemwztteLpqY7Aqa72Xc+g73Qxwa4wnep7K+WKnmk8+Q+k5dYrCp\nDtEFXBfmSgE0T+VhA1agB0iVvIQg3lTrxZeouO8ZwSfLKS2UmZ0b5IoSZeczsx5D\nwT7emW6J3+KGnCUuUFaf1Wc=\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwwkMt7PlOgzTnOtez04/\nNE7Xs6jkpFAoOA2Aq3xo+o9/HG0p63fzGapFngYi7hCEm5HipiGYk66TP8E5+f9b\nXKoNCTkRFLChDkP28X0WMeLzxAVD+3hf0Ni3GMrY0CfFAWXvig4eXXgKBzomtbGH\n1oEXpZfObeLIzBS/dKrSH3e7O/D0i5+CtjjVpHsCSjWvtQ3G45k+ACtoqk6ujHqY\npijNN8Hu+2amUdnCxO+ycIweKcJhQ5eB6W5gX3I8Q4cPaftMsqn2ViDWp020uW48\nH7OfuzkGOqLDlcZ7ViLvotjf8FvumYefzAIN5/VdRkD+wlqNE31uZT7bFV//WYNO\ncwIDAQAB\n-----END PUBLIC KEY-----\n"
[33m[33mwarn[33m[39m: 	[33mInvalid template ID format detected[39m {"expectedFormat":"d-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx","templateId":"d-seo-verification-template","timestamp":"2025-06-05 07:49:29.871 AM"}
[32m[32minfo[32m[39m: 	[32mTemplate manager initialized[39m {"fromEnvironment":true,"reset":false,"timestamp":"2025-06-05 07:49:29.871 AM","verification":false,"welcome":false}
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:49:29.871 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:49:29.923 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:49:29.923 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:49:29.924 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:29.925 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:49:29.926 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 07:49:29.944 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:49:29.948 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:49:29.948 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:29.949 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:49:29.949 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:29.949 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:49:29.953 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:49:29.953 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:49:30.055 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:49:30.055 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:49:30.055 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:49:30.056 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:49:30.056 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:49:30.056 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:49:30.056 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:30.061 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:49:30.065 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:49:30.065 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:49:30.065 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:49:30.065 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:49:30.065 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:49:30.065 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:49:30.065 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:49:30.066 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:49:30.066 AM"}
✅ Server started successfully on port 4000
[INFO] 07:49:33 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/services/EnhancedEmailService.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:49:33.415 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:33.415 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:33.415 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:49:33.415 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:49:33.418 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:49:33.418 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:49:33.419 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:49:34.421 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:49:34.422 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:49:34.423 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:49:34.423 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:34.429 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:34.429 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:49:34.430 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:49:34.430 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:49:34.988 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:35.643 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:49:35.645 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:49:35.645 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:49:35.659 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:49:35.659 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDVld5O9ThxOA7k\nn6SKBUOoVRjyrxEAB6l8gy3kKSWOAfMaTeJ0djXruTjUF8Fv/eyctVWEuuGh9XLs\n7Ic7bZw3OPZPogyF5jE1ajFpb8JqwyIYqH3ukcXlgOCaVf77RCtg5g99q8/d0SzE\nJ4XlvXeQNQgzcL+lbySJ4rR0enGycqM+psju6ICl1uKa/Hk7i+/LbvN17Bp5bpZ8\nJkDoDnxapR5FA9eYl/LZzZx9dTVuU8rUwGu0/v0XnOlSZ1jeBnjzBwgKeMLpxD2I\nTVYiw9ZsxxgdArQaSPcASNElImPugyjwTzb/reURMbA3oiNJUIGlNgwlX09YkpV/\nkcNrqCS7AgMBAAECggEAToxtU5Bvj4PURlRHyNKizTduk2G62M34kOgVaoGPZChn\nZVcbX0VSEzztH2MVKsCx0fgGWWf5Lvz7pRJfsYVgHBcAzsyD2oKLul8xiNsnHuhg\nk7zzg1ds9jhtYZUazwGFCn/RVqBnM+aHliQK5DDH1esK9xASCx9SyrrrLqMRSVSf\nUDGAgyLf9DHv5Cik3kOwiyQJBavFU6yL0ua9a7AWetMTULBlOIYWij+1aDhNZB9C\nw/JxyeFnJtZ3Iq+zDf2wimQTT9n2tvki1ZxRo36CNiDbkucE4HS4oLiZDdM8AnAe\nnCnIEaCFt+fAyz41PCcjOu8yBdY9gLiMpTSNL7EJMQKBgQD4lTrg2TiYScgvB+nA\ntXfCIva23jHKrfnwgzAhWd9K4kYDcmvLeqpQkjTCU6sCTlBtNTFs6gsFfbv97GN7\nFET9zEDVx4uz0+An434mCyYOaqxDVx6ieMQxNavKdEVrZtMaksZAxUkdoo8kwU3B\njzVjB4AhB43X552GpsvYropABwKBgQDb9VBz/BMUcuUV3XXqOQusLEFiqdGFDpXF\nhjjCYPv+5uzQ0HkDHw+9K3f4u5V/9OdxY0II1lkNSaXM5wlZjawrK6dP5XFrGbde\ntkJE+eVPTGbSGVPJ1cJzcCW/sS3CiJ78n9oF2RgerD7SjViwYttVUO8H48z4VXfb\nsjRKq3YgrQKBgAc4zq0ZontKKXa0VCY1H3WUbnaBnhC1XT2PkiZl5gbW7BHNkTQo\nLCqLFN1QcPdwLwX9NaJkak2OiZem9nzs6dQ1yuxrD7P5w9lk0pVoXYKttrN+JHWz\n7H9Bf+wx1JJ6OkfbW8cl9CnYPzBiLVAiSPrHjQFopsZPBFSVI/b3myyhAoGAbbSh\n5udv4MAZcFlfiW3gW4RLLFmErbeDjdwPDSvwI8erj86avKrOX8yBbuaofwR4Nv6J\nnfzCt7Tm5BbLfAYEPBfuwBOxCPjvk2aWEO8Opwl1Mw780msyK/9gZIaLSz53BYr4\n4/fOZuYEA2IKPRdhS+EtByNgRO/j8wijuiZgqZUCgYBKB9lH5759xenMwd9l8LBc\nZjuIpufhUjecCzBh+UsWAO8XMR2Bp03ypiRz8FwRBeV/AVmst5wOavjg1G9LBVE9\nHkzonplPWOo7Ae/1jcLtEJjN8Y4q1YRa4faKBi1Od07Ejp5S75IB/bev+I2PDTRZ\nuVMwlTb62Vabx4oUoYHakQ==\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1ZXeTvU4cTgO5J+kigVD\nqFUY8q8RAAepfIMt5CkljgHzGk3idHY167k41BfBb/3snLVVhLrhofVy7OyHO22c\nNzj2T6IMheYxNWoxaW/CasMiGKh97pHF5YDgmlX++0QrYOYPfavP3dEsxCeF5b13\nkDUIM3C/pW8kieK0dHpxsnKjPqbI7uiApdbimvx5O4vvy27zdewaeW6WfCZA6A58\nWqUeRQPXmJfy2c2cfXU1blPK1MBrtP79F5zpUmdY3gZ48wcICnjC6cQ9iE1WIsPW\nbMcYHQK0Gkj3AEjRJSJj7oMo8E82/63lETGwN6IjSVCBpTYMJV9PWJKVf5HDa6gk\nuwIDAQAB\n-----END PUBLIC KEY-----\n"
[33m[33mwarn[33m[39m: 	[33mInvalid template ID format detected[39m {"expectedFormat":"d-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx","templateId":"d-seo-verification-template","timestamp":"2025-06-05 07:49:35.866 AM"}
[32m[32minfo[32m[39m: 	[32mTemplate manager initialized[39m {"fromEnvironment":true,"reset":false,"timestamp":"2025-06-05 07:49:35.867 AM","verification":false,"welcome":false}
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"mappingSummary":{"resend":false,"reset":false,"verification":false,"welcome":false},"templateManagerEnabled":true,"timestamp":"2025-06-05 07:49:35.867 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:49:35.921 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:49:35.921 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:49:35.922 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:35.922 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:49:35.923 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 07:49:35.942 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:49:35.947 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:49:35.947 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:35.948 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:49:35.948 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:35.948 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:49:35.952 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:49:35.952 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:49:36.053 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:49:36.053 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:49:36.053 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:49:36.055 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:49:36.055 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:49:36.055 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:49:36.055 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:36.061 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:49:36.062 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:49:36.062 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:49:36.062 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:49:36.062 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:49:36.063 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:49:36.063 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:49:36.063 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:49:36.063 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:49:36.063 AM"}
✅ Server started successfully on port 4000
[INFO] 07:49:39 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/services/EnhancedEmailService.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:49:39.039 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:39.040 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:39.040 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:49:39.040 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:49:39.043 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:49:39.043 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:49:39.044 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:49:40.046 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:49:40.046 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:49:40.047 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:49:40.048 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:40.054 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:49:40.054 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:49:40.055 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:49:40.055 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:49:40.613 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:41.250 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:49:41.252 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:49:41.252 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:49:41.264 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:49:41.264 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCvJDPnO/NzqAIb\nFcpPNFcV3kbIQKcaa/toJqMQetDOJBah7F0IDbL3fLTKUoedx+YD9iEnoKa8zjOF\nxazIpjxzVzkJZ/BcI2yRJuvWzDR2SF6VTqnOcZbwsN4IQNsYoyo9CfzbVlOOzLUj\ni8ad5h8+hoCMo9J+WHDsAW3EVa7ixJaaS/DEbn3HU55L3qtlPdagM49Uzt3bsPun\nm7CCdei0X5nMrJ0o7m5mRrIVUKi7CSLTZ02ApCdCLVZd4hriMpMd/CLNNpzspqp/\ncAxZjGWP/hCruw58MbptNqbzXjWtnpWV+HapD58YN5pH9C+rGgXnbUOA20YJziHr\nDsCHEDjDAgMBAAECggEAAu5NKcS9NO6yrcB/dKHcBhM7c7dLi3BcltF0ax6cK6Jf\n07olAYx+2lkbLx8AcI420VMCrQapWoF/J4OAnpFBmEmsF6zq44IfG2mWU+ZNfnJg\nca3ECENhgInpvUgwkCRFJkChP+eK69nWjZi6NXDO1wsqBrB7IbXaCDIrEV0JtOTk\nMOEdvxgPzPVZUCWz2724dpQx6i9Ob+K9r9sjcSDFxMvHlqFEfPqtsSHFN7DNKA5G\n1cbzXG7JflDXjwg+jMPR0+MACMfI9pclV+9gTTYwuHFSNe9/ECxVa5cNAPT789UU\ng3iab9mIBcNmyLmJAA/PBbUPQKpQOsYRhDskC6Bp4QKBgQDkVfrOVtQvD/NqdCrD\nOL7EyHSOBNJCG8P4YBuzVjToGow7vfCMqnPYArzn6UkH7gyW9uNGJ5T0qIXj4K8K\nG8UVTbnI9NFjst7zEmlGW0HF9s8sICFoAyEq4qLEE2jKOKW0z8AjIhKtr6CDNe86\nKccr5QYLpMjMicqa/HHR/KX5UQKBgQDEXFrKz8ClpURlHNwFcsnq/bUWCCx7ZGpL\nd9wOLxrg0o2d/KlDSichr/5ajd0UnNVSufxPYvZFlWhRifNOB7vRLmcd+R30nH5F\nGH3/gw/ZgbKXfRiiLoJ3e6l0w2rA3c42x35Gap4iwlOJOAbB2ICVS6Vim3K8mx8a\nfIxk6GlL0wKBgE+ZxcCvNnNdrS88Zjf+jUrO0ws7lQ0k3tG0t5NyhykvMBoXokd3\nmMECW1bB1grkqxDp6ttnKx+LrHl/t6XffnppyU3MQz7teZnlnju/zpMz8o9geCTp\nimOH9NREK/DrhKEfF81nsHlKU7vKTqbJL70Wr1/Zx4K+upoDTa611CqxAoGBAIp9\nUJOl/wtVCm398rftA7g3A9bsIONOKSHdAVkHo/9YwQTiREbvL7Y0uEIJuBlnm5Tj\nE66x71uYSqDnmLA6CB86iQO8xYHWNcBpy8PAHhebv+fUFOGdx+qZTyTJBqvMRDqi\nbM8hNzLwt5YZ67ogBmBFn/lyBXQ8O62klig9OrZ9AoGBAM2UGR6m0VknVCuwECQC\nrJwKVexzhmo9Qin0MTG4eZyzlyra7X+Lm11iO4CHzDmI1XbswZaYXoI1GjgiXYTV\n7BvwtMBT/5JeYf/lGB0V3MjwX7ItzcgWGHqXCKT8pyaL9YQhdbWt+iAnAiRbBpaM\n4GJv5wKHLrcoKQGAbc1I+EIJ\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAryQz5zvzc6gCGxXKTzRX\nFd5GyECnGmv7aCajEHrQziQWoexdCA2y93y0ylKHncfmA/YhJ6CmvM4zhcWsyKY8\nc1c5CWfwXCNskSbr1sw0dkhelU6pznGW8LDeCEDbGKMqPQn821ZTjsy1I4vGneYf\nPoaAjKPSflhw7AFtxFWu4sSWmkvwxG59x1OeS96rZT3WoDOPVM7d27D7p5uwgnXo\ntF+ZzKydKO5uZkayFVCouwki02dNgKQnQi1WXeIa4jKTHfwizTac7Kaqf3AMWYxl\nj/4Qq7sOfDG6bTam8141rZ6Vlfh2qQ+fGDeaR/QvqxoF521DgNtGCc4h6w7AhxA4\nwwIDAQAB\n-----END PUBLIC KEY-----\n"
[33m[33mwarn[33m[39m: 	[33mInvalid template ID format detected[39m {"expectedFormat":"d-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx","templateId":"d-seo-verification-template","timestamp":"2025-06-05 07:49:41.326 AM"}
[32m[32minfo[32m[39m: 	[32mTemplate manager initialized[39m {"fromEnvironment":true,"reset":false,"timestamp":"2025-06-05 07:49:41.326 AM","verification":false,"welcome":false}
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"mappingSummary":{"resend":false,"reset":false,"verification":false,"welcome":false},"templateManagerEnabled":true,"timestamp":"2025-06-05 07:49:41.326 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:41.380 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:49:41.383 AM"}
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:49:41.383 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:49:41.383 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:49:41.384 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"0ms","timestamp":"2025-06-05 07:49:41.404 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:49:41.409 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:49:41.409 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:49:41.411 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:49:41.411 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:49:41.411 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:49:41.415 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:49:41.415 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:49:41.516 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:49:41.516 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:49:41.516 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:49:41.517 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:49:41.517 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:49:41.517 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:49:41.517 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:49:41.523 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:49:41.526 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:49:41.526 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:49:41.526 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:49:41.526 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:49:41.527 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:49:41.527 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:49:41.527 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:49:41.527 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:49:41.527 AM"}
✅ Server started successfully on port 4000
[INFO] 07:50:29 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/routes/admin.routes.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:50:29.367 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:50:29.369 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:50:29.370 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:50:29.370 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:50:29.378 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:50:29.379 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:50:29.383 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:50:30.385 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:50:30.385 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:50:30.387 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:50:30.387 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:50:30.394 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:50:30.394 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:50:30.395 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:50:30.395 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:50:31.087 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:50:31.810 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:50:31.812 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:50:31.812 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:50:31.831 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:50:31.831 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCtF6bf92Yh64Ny\niH+XSlLY+TvSnwdrwdxeBh/kP+NZfBeMHH2OLg4RUuwK3V1O8ZjeoLwewFuSPdNo\nmoAx10vwZGjLrmgqrFFpP9bRajeSp70TWyLSSKA10hTPUVeNodDLI+ZkmXRbaDIN\n8M1wjpP9uVGuD+DhRotaJCuZ8Hkr8gv3KgR2uS4EogmuA2t+xolzD6VlAOoD4qFq\nVmSpG1sLrtJmHft25m/JfLNcZ6CG4QcV8tc8btSg5T2x4pv1ERypNQS5429xl2xC\nPshWvRLHhQcxbEWOdHzRkT2j9bF15Qef/xuLDKFDASW1YqeZH1n2l+FjPScHbFyc\n7WUA/G2JAgMBAAECggEAOdM69ntp7U8GnM6pAVvdDYtFxvlFu2QKQIb/RHtrckuY\nekBSWZtdK8BuBrspHuRrU4STFBri/JoW9E0ZIo1wWyDQOatMNWVX1Td0hoVbh2zu\nJ3c8zM9iZliGhzP/cdtrK1IU9+qkCp1mi2201DNtkUfF18aKM/gjObv3rPe/I0Su\nh2BpxZq5uP1noFDjhm6dYRxygAoGFg4Ac2xjlnU3FA/jJxk5e0wRIn4rprVbAEbO\nHIfzKNrxVTocFICjicsq2iZKMfY3KUcjlxlL47OoF5PiZ3KtnZkzroBK3YUEUBTr\nWU7PtRmzNr1uaz/USxPPHQI16VQBWn4HeVWsV1yKGQKBgQDeuP831wRK+/vQSqKD\nusvZ6H9HdreCJaYpHsSEreJTwwHBXAb78plTjJs5NOvLPMnoMDyw+nM8T1yTiSP1\nRTevoNOptIU/AWMcjoEVk2aCGXZwU/txP/xSDYXyVbwdSb3xhyBPJV30FAiC9fUN\nfgZ1gYFUtEAMhWJbNBZD28AfMwKBgQDG9FQVogQT46Py1nO7gUJRQSjAMMnoNM7V\nTj/Tvam6ZrENH127b5BKoL6bm8R+uJCyZZUKEaTbON5nVwQa9D5NkGBejJnVDdeC\nBlPwHVqXAL+ABngu6/XlOJjmck9aQeL+o5E3mM9Lo0hdzLVImNzcH2N0EGnKejBV\nprRn68RwUwKBgQDZAalyT+cX5INLRJ0p+qRKslTpXYuZnHNUl2zk1cOy10trie4o\nKA0qsdJAIAcq5BTaTb2ktrH27mCGQ9YsUX/beLkjHgfCBuj51wOA8TisxIB5G+rf\nQnfnvtNm9hAu/T28Cmv5kbAEdEyCxYE53zQN49wOmv3Y9VGLCaoz/fYorwKBgQCc\npenCsrNFObpvzHyJSSf/NC+yy3deNp4YAylsPWxzEMIc0/KITzosGE6b1NSs9gMw\nA52KtQO5fBhZA4F++4pGpgPKziedQe3KOdNDPsmCFZuyYOWmBDGzDpIM+DoUlcX1\nurHvNYkaQ/EJsdGW3I0hYDF9RCMXwodmGQD4xgEAcwKBgDwfGfWK9zImvqq84SBo\nfrm02tqGFp15QCSBGltenGEnf68cvjrGB5XvV7aYVJAMNofvAZneXYY3wMVGffK5\nrmOmdiedUTmgg1N7uD3UR/oYB/53fGJxonwYs8HoOcTxyrToblYgWv1VsiS4xraT\nsR7J9VwcpMC9w84gNrnCuhH3\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArRem3/dmIeuDcoh/l0pS\n2Pk70p8Ha8HcXgYf5D/jWXwXjBx9ji4OEVLsCt1dTvGY3qC8HsBbkj3TaJqAMddL\n8GRoy65oKqxRaT/W0Wo3kqe9E1si0kigNdIUz1FXjaHQyyPmZJl0W2gyDfDNcI6T\n/blRrg/g4UaLWiQrmfB5K/IL9yoEdrkuBKIJrgNrfsaJcw+lZQDqA+KhalZkqRtb\nC67SZh37duZvyXyzXGeghuEHFfLXPG7UoOU9seKb9REcqTUEueNvcZdsQj7IVr0S\nx4UHMWxFjnR80ZE9o/WxdeUHn/8biwyhQwEltWKnmR9Z9pfhYz0nB2xcnO1lAPxt\niQIDAQAB\n-----END PUBLIC KEY-----\n"
[33m[33mwarn[33m[39m: 	[33mInvalid template ID format detected[39m {"expectedFormat":"d-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx","templateId":"d-seo-verification-template","timestamp":"2025-06-05 07:50:31.910 AM"}
[32m[32minfo[32m[39m: 	[32mTemplate manager initialized[39m {"fromEnvironment":true,"reset":false,"timestamp":"2025-06-05 07:50:31.910 AM","verification":false,"welcome":false}
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"mappingSummary":{"resend":false,"reset":false,"verification":false,"welcome":false},"templateManagerEnabled":true,"timestamp":"2025-06-05 07:50:31.911 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:50:31.969 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:50:31.969 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:50:31.970 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:50:31.973 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:50:31.973 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 07:50:32.004 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:50:32.010 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:50:32.010 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:50:32.011 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:50:32.011 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:50:32.011 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:50:32.015 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:50:32.015 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:50:32.116 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:50:32.116 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:50:32.116 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:50:32.117 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:50:32.117 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:50:32.117 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:50:32.117 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:50:32.124 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:50:32.126 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:50:32.126 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:50:32.126 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:50:32.126 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:50:32.126 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:50:32.126 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:50:32.127 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:50:32.127 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:50:32.127 AM"}
✅ Server started successfully on port 4000
[INFO] 07:50:39 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/routes/admin.routes.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:50:39.697 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:50:39.697 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:50:39.698 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:50:39.698 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:50:39.701 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:50:39.701 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:50:39.701 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:50:40.701 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:50:40.701 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:50:40.702 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:50:40.702 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:50:40.707 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:50:40.707 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:50:40.708 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:50:40.709 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:50:41.072 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:50:41.542 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:50:41.560 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:50:41.561 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:50:41.595 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:50:41.596 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCOgCOz/Fn/NLCx\nI0zUiosUVHOW8vKIw9pMdEGk1gwbLrmHPRIv6JlBVo8qjceISkZIV6uFIkFY09qD\nID+A+l2KzoZ9/3R4FevUgWSKGTqN3WJblbj/r9tmL+aewCktL6ghQX2r1cal/wRX\nnbhzPJU2gruYAJulYcf8cQNt7nh3Pgb+fpgEGpeQzzUSqn5ZFUwDirGeGECHcjpL\n9jtlIHjitlNLCuB1WZPZOsD4X010PZWgEi3lIH8T16cp2QssONWpDE9xcuA/jdbv\nCLsZEHgTB+OOb7V5sxzuKXojGTbCBHqv/QEwV7Em6oJ19DTQTa76ycfl06dDRd7X\njF2jh89bAgMBAAECgf9q36/nTVwyC1J5iAAXZ9Dnbm9CxvMfn8QZkxeoiOCLgn+i\n7iq1w70tQ74cLDl5/jq4Bwic0RQxirJXpdf648tET6CO3wh7B/XXazP8Xu+Ldn5O\nMfyNx1bFTSep6HT5bsSqLHQUbECQPrMDA0dTJhzCxUnstogFgVB8BEaOLEwtITlb\niG+R6umkC0DTmIAZ5zyanykECLNrMg0wd6F1k3jPctLzbb+ig8Euveng88m2yrOV\ndunqnVShW4TXyKAO2ortjHbNyfCPh4VlvDLBoIYT5JTZ7/0vwmzOt4lNOGdBFPrd\nko9DaOmtDRLZ5f2FNyl450aLUxKWlrRhQF4bnAECgYEAx1YytqqyDqfFJrDart+a\nxVfGC3WWrBFLXTx7O2ppCRLZMPubjb+Gn4S5vP8imKrCuiF4UTqb4M43mfyTD9Am\nKzAyE9OFjGhF5Qvbc574lWgVQ6mh8LXJF/QJFCOrkbwJOXBmqQ9U1qZqQf5rmyJe\nj0qayLB26QBBAf/uyE1fxqMCgYEAtwH0J+Dv5CpuMo4DX+Dwvf6foU7p9TD05zbJ\n6BPGMfai9HHDuUrOb2aCOHq/0Ttfov5hMtMln0df2j40BjzEiBi7CyWXALVSgKbV\n0Xz+LbpkaZFx+0Q/3uNFRfkWCblVm/wvHFkNSQ3h60OSJR7+NsVt//HlQQt4eOJX\nQNuFN+kCgYEAnTnUDlhc0UprKrVcB4q/HOC6iNda3KVXeFb4LEkmR83iGcybSRbE\nLJYXmoby1s/5f65epFNCF/MP0Bl0NYjMUkxVc2XndHPajWro0S2WjOHnw9LMtHvt\n/UKy1nu8G9rgu7l4f+hj1lq0fREb9uUJCKSjqZ/maqmUnOstgDfnT1kCgYBtK44x\np96TFrisEclzjaUvQdCKEqBAMxc1QprJhdpKfd2RwrfGNhjVnan69UauEyQnAGaN\nQiYEUTid4VN5kRCQO2iA6siclI4FzwBoOo8KSlGSJECBaqJLXPo7Fq8N1/B438Re\nvcTOGqj1hlaNLGLr23SWJP/kgGo6epMgTpO22QKBgQDGs0fPyklUm4RKMR+RiiJI\nTgBd7t+SBSuFw7rmF2xDqeYPliS8/Bl4PcYgz/HI8G2Cs1RxMSWIOAIZkMpK8OLm\nqAKXziCiWpxS7RoHhsYqffk4Ve2sSCSCGi2SFBenmzCXtisJWRWy7jq101prKuIj\nFKe9E6tUCzit0uV8i08eRg==\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAjoAjs/xZ/zSwsSNM1IqL\nFFRzlvLyiMPaTHRBpNYMGy65hz0SL+iZQVaPKo3HiEpGSFerhSJBWNPagyA/gPpd\nis6Gff90eBXr1IFkihk6jd1iW5W4/6/bZi/mnsApLS+oIUF9q9XGpf8EV524czyV\nNoK7mACbpWHH/HEDbe54dz4G/n6YBBqXkM81Eqp+WRVMA4qxnhhAh3I6S/Y7ZSB4\n4rZTSwrgdVmT2TrA+F9NdD2VoBIt5SB/E9enKdkLLDjVqQxPcXLgP43W7wi7GRB4\nEwfjjm+1ebMc7il6Ixk2wgR6r/0BMFexJuqCdfQ00E2u+snH5dOnQ0Xe14xdo4fP\nWwIDAQAB\n-----END PUBLIC KEY-----\n"
[33m[33mwarn[33m[39m: 	[33mInvalid template ID format detected[39m {"expectedFormat":"d-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx","templateId":"d-seo-verification-template","timestamp":"2025-06-05 07:50:41.761 AM"}
[32m[32minfo[32m[39m: 	[32mTemplate manager initialized[39m {"fromEnvironment":true,"reset":false,"timestamp":"2025-06-05 07:50:41.762 AM","verification":false,"welcome":false}
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"mappingSummary":{"resend":false,"reset":false,"verification":false,"welcome":false},"templateManagerEnabled":true,"timestamp":"2025-06-05 07:50:41.764 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:50:42.108 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:50:42.109 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:50:42.111 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:50:42.133 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:50:42.134 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 07:50:42.224 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:50:42.227 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:50:42.228 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:50:42.230 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:50:42.230 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:50:42.230 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:50:42.234 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:50:42.234 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:50:42.335 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:50:42.335 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:50:42.336 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:50:42.337 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:50:42.337 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:50:42.337 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:50:42.337 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:50:42.345 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:50:42.348 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:50:42.348 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:50:42.348 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:50:42.349 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:50:42.349 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:50:42.349 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:50:42.350 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:50:42.350 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:50:42.350 AM"}
✅ Server started successfully on port 4000
[31m[31merror[31m[39m: 	[31m500 - Internal Server Error - /secure-auth/login - POST - ::1[39m {"body":{},"error":"SyntaxError: Bad escaped character in JSON at position 58 (line 1 column 59)\n    at JSON.parse (<anonymous>)\n    at parse (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/node_modules/body-parser/lib/types/json.js:92:19)\n    at /Users/nicholasmangubat/CascadeProjects/seodirector/backend/node_modules/body-parser/lib/read.js:128:18\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at invokeCallback (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/node_modules/raw-body/index.js:238:16)\n    at done (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/node_modules/raw-body/index.js:227:7)\n    at IncomingMessage.onEnd (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/node_modules/raw-body/index.js:287:7)\n    at IncomingMessage.emit (node:events:518:28)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at processTicksAndRejections (node:internal/process/task_queues:90:21)","params":{},"query":{},"timestamp":"2025-06-05 07:52:46.416 AM"}
[31m[31merror[31m[39m: 	[31m500 - Internal Server Error - /secure-auth/login - POST - ::1[39m {"body":{},"error":"SyntaxError: Bad escaped character in JSON at position 58 (line 1 column 59)\n    at JSON.parse (<anonymous>)\n    at parse (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/node_modules/body-parser/lib/types/json.js:92:19)\n    at /Users/nicholasmangubat/CascadeProjects/seodirector/backend/node_modules/body-parser/lib/read.js:128:18\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at invokeCallback (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/node_modules/raw-body/index.js:238:16)\n    at done (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/node_modules/raw-body/index.js:227:7)\n    at IncomingMessage.onEnd (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/node_modules/raw-body/index.js:287:7)\n    at IncomingMessage.emit (node:events:518:28)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at processTicksAndRejections (node:internal/process/task_queues:90:21)","params":{},"query":{},"timestamp":"2025-06-05 07:53:52.763 AM"}

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:53:59.501 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:53:59.505 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:53:59.506 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:53:59.507 AM"}

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:53:59.510 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:53:59.510 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:53:59.510 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:53:59.510 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:53:59.641 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:53:59.642 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:53:59.643 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:53:59.664 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:53:59.665 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:53:59.665 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:54:00.666 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:54:00.670 AM"}
[31m[31merror[31m[39m: 	[31mError shutting down Enhanced Analysis System: Cannot read properties of null (reading 'sockets')[39m {"stack":"TypeError: Cannot read properties of null (reading 'sockets')\n    at WebSocketGateway.shutdown (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/seo-crawler/ws/WebSocketGateway.ts:387:13)\n    at EnhancedAnalysisSystem.shutdown (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/seo-crawler/enhanced-analysis-system.ts:240:7)\n    at gracefulShutdown (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/index.ts:295:11)","timestamp":"2025-06-05 07:54:00.704 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:54:00.706 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:54:00.708 AM"}
