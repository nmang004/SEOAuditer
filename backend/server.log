
> seo-director-backend@1.0.0 dev
> ts-node-dev --respawn --transpile-only src/index.ts

[INFO] 06:29:02 ts-node-dev ver. 2.0.0 (using ts-node ver. 10.9.2, typescript ver. 5.8.3)
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:29:03.162 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:29:04.213 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:29:04.214 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:29:04.215 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:29:04.319 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:29:04.319 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCUexwRwRZc54X1\nzTaGCriFuW9bC/yzux4lAZ34MQDGYj3lRfnEt+0BXHjq5nZQ2WxcftTH+RtqOjR1\ngM7TwkNA9bt2YnM3GqXJXyqul+7Al7YU6Fa44FwHEVWRd8DVREFJ0M2bXDb7BMWU\nXVC7Gp8FsViT5gZb3+w9ALb7+O00llWE5Rv++WheWy7A+Rryub5jmXv5kNtRIRPY\n6gqqjKugI/m/VsJ8DG4bqMyuhSMJnD+YWXnWlT//XEhYwBWKHcRm0B9q7e1W/A/z\n2nwOMc9NPkGJdDhnBbTq8xlqjFmthn4G+IogDbOgafWkfoPX41pUaqEVIHh+pqHk\nGpmhOvFTAgMBAAECggEAC8XxNVUunUI8ZH+XlaxO8keAVWNPb77kBoIo0O+txI0w\npDfWtKryz3tSGSoZ8pIy3eiunYaajmM8Gp8Sh0bthz6U1S+8O//QanWx0DM62qmM\n5f6ANduQYH0W4FhzAVYOqTg1vV5j+6Zmtjtp9dQIDO8Be4SvN2S7eiDO4Y7c3CD6\njagXeJHlwUwQ99HN+G+d/UvXSjXtwtISJFBXY6y7hV5wm1AE4w/Y7i7ZgN1sQcrG\nHds7qalbuSNvAJaBA27JvaLrd+wMjY3A17orKQ8Z0PSydt5FnEnHEZvwBBjJ8zhI\nejt8B+IiTNR8JzCy+/T7YMR9CaAP797E7c+3Q6T4EQKBgQDGZa/9lWWqg6vR2bbR\n1SurvE7IWu9SkEDwAG8I0d7BY3ulSUvUnV+G1N+Lvr7LHAx9KTsdm7yo0vR2r2If\nYFE87u5ZntSw7nyC0QtabDL6G6sS+RJv7amlaCDeANAJ/VOTax85dxKN3IXus/NG\ndc8BV+3nXJB3BfEZgbUxY2sGowKBgQC/l0f7CG9kueiegP+LF7Z/Yhvli80opt9a\niMW0uRIPFNRfgifJuxIXh25m2/lslWb5NYlWAM/mr4OF5IIRKbwdoOLgPDKh/EAU\ncLguD4uo7V5NDh3TFmTWLGMpD35iW99H/OBF4LcORKDCD12jLekga0OD2GHRWA/E\n/+kPskkFkQKBgDNTvXsyenHpzLrmw2h36OtuNUeaVw4aKeKtigxTF3kavrNdShQA\nfuVID2l8+KldYVHEJ/oZ/24B3aMS7qTFa18DRYDEGayIlofVg0VqdqnEHLc03vM8\nHkafsNkehrP+6O9bqGFaj99JrRC7V3XkJqDnWbIgfXN9gwmhR/o2CUtXAoGAeOcx\nsFPhX9IF3siO+qqLKxWxfwja/bVYq5w2D1be8490eZT8IMyhnSGE5PoaC5C4e7ly\nIki+6deGix7piYUpxhS6N0Elvp0dnwiG4eJDguXQJZYr8gJmvdUi+k1htxY88AO/\nT7mAK0vZmrzxnUEipaeq4m/RQrdstCe+Xn5moFECgYEAtsPYqKLpQs2ip55c+VEQ\nC3bSLvuKJWABMiqXKL5axxdWnkIIWLbuqRAS74/G8ju3N89aPzlPlSjDLUnu3AVr\n33XJ4NBV5pPJnT+Rzjq0HdHp7p3VDWGu9SrVud+z2gvcIxcUqo4FifC1zQEFqaJw\naerRwGI3UNFyEBSlkBsEWmY=\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlHscEcEWXOeF9c02hgq4\nhblvWwv8s7seJQGd+DEAxmI95UX5xLftAVx46uZ2UNlsXH7Ux/kbajo0dYDO08JD\nQPW7dmJzNxqlyV8qrpfuwJe2FOhWuOBcBxFVkXfA1URBSdDNm1w2+wTFlF1Quxqf\nBbFYk+YGW9/sPQC2+/jtNJZVhOUb/vloXlsuwPka8rm+Y5l7+ZDbUSET2OoKqoyr\noCP5v1bCfAxuG6jMroUjCZw/mFl51pU//1xIWMAVih3EZtAfau3tVvwP89p8DjHP\nTT5BiXQ4ZwW06vMZaoxZrYZ+BviKIA2zoGn1pH6D1+NaVGqhFSB4fqah5BqZoTrx\nUwIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:29:04.667 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:29:04.740 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:29:04.740 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:29:04.741 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:29:04.742 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:29:04.743 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"0ms","timestamp":"2025-06-05 06:29:04.799 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:29:04.804 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:29:04.804 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:29:04.814 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:29:04.814 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:29:04.814 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:29:04.819 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:29:04.820 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:29:04.921 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:29:04.921 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:29:04.921 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:29:04.922 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:29:04.922 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:29:04.922 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:29:04.922 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:29:04.928 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:29:04.930 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:29:04.930 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:29:04.930 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:29:04.930 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:29:04.931 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:29:04.931 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:29:04.931 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:29:04.932 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:29:04.932 AM"}
✅ Server started successfully on port 4000
[0mGET /api/health [32m200[0m 1.459 ms - 103[0m
[32m[32minfo[32m[39m: 	[32mStarting email verification send process[39m {"email":"final-test@example.com","name":"Final Test User","timestamp":"2025-06-05 06:29:32.241 AM","userId":"c73d3962-a1dd-4506-843f-0338a1d71937"}
[32m[32minfo[32m[39m: 	[32mVerification token found, attempting to send email[39m {"email":"final-test@example.com","timestamp":"2025-06-05 06:29:32.243 AM","tokenLength":64,"userId":"c73d3962-a1dd-4506-843f-0338a1d71937"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail called[39m {"name":"Final Test User","timestamp":"2025-06-05 06:29:32.243 AM","to":"final-test@example.com","verificationToken":"9fbb9981..."}
[32m[32minfo[32m[39m: 	[32mGenerated verification URL[39m {"timestamp":"2025-06-05 06:29:32.263 AM","verificationUrl":"https://seoauditer.netlify.app/verify-email/9fbb99814f4c13a6c99909bc712040d406526a6b28df815299e8f3f799e075c2"}
[32m[32minfo[32m[39m: 	[32mEmail template rendered successfully[39m {"htmlLength":8516,"subject":"Welcome to SEO Director! Please verify your email","textLength":767,"timestamp":"2025-06-05 06:29:32.263 AM"}
[32m[32minfo[32m[39m: 	[32msendEmail called[39m {"initialized":true,"providerName":"SendGrid","subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:29:32.263 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAttempting to send email via SendGrid to final-test@example.com[39m {"timestamp":"2025-06-05 06:29:32.263 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid send method called[39m {"apiKeyLength":69,"apiKeyPrefix":"SG.Y6rjeWf","configured":true,"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:29:32.263 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid send details[39m {"environment":"development","fromEmail":"admin@seodirector.co","fromName":"SEO Director","timestamp":"2025-06-05 06:29:32.264 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAbout to call SendGrid API[39m {"from":"SEO Director <admin@seodirector.co>","msgStructure":["to","from","subject","html","text","trackingSettings","tracking_settings","headers"],"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:29:32.264 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid API call completed[39m {"messageId":"RdDA0HccRjizvZq2BVIu4Q","responseBody":"","responseHeaders":{"access-control-allow-headers":"Authorization, Content-Type, On-behalf-of, x-sg-elas-acl","access-control-allow-methods":"POST","access-control-allow-origin":"https://sendgrid.api-docs.io","access-control-max-age":"600","cache-control":"no-cache","connection":"keep-alive","content-length":"0","content-security-policy":"frame-ancestors 'none'","date":"Thu, 05 Jun 2025 10:29:32 GMT","referrer-policy":"strict-origin-when-cross-origin","server":"nginx","strict-transport-security":"max-age=31536000; includeSubDomains","x-content-type-options":"no-sniff","x-message-id":"RdDA0HccRjizvZq2BVIu4Q","x-no-cors-reason":"https://sendgrid.com/docs/Classroom/Basics/API/cors.html"},"statusCode":202,"timestamp":"2025-06-05 06:29:32.410 AM"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully via SendGrid to final-test@example.com[39m {"messageId":"RdDA0HccRjizvZq2BVIu4Q","statusCode":202,"timestamp":"2025-06-05 06:29:32.411 AM"}
[32m[32minfo[32m[39m: 	[32mProvider send result[39m {"result":true,"timestamp":"2025-06-05 06:29:32.411 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully to final-test@example.com via SendGrid[39m {"timestamp":"2025-06-05 06:29:32.411 AM"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail result[39m {"result":true,"timestamp":"2025-06-05 06:29:32.411 AM","to":"final-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail verification sent successfully[39m {"email":"final-test@example.com","timestamp":"2025-06-05 06:29:32.411 AM","userId":"c73d3962-a1dd-4506-843f-0338a1d71937"}
[32m[32minfo[32m[39m: 	[32mSecurity event[39m {"email":"final-test@example.com","event":"user_registered","ipAddress":"::1","timestamp":"2025-06-05 06:29:32.420 AM","userAgent":"node-fetch/1.0 (+https://github.com/bitinn/node-fetch)","userId":"c73d3962-a1dd-4506-843f-0338a1d71937"}
[32m[32minfo[32m[39m: 	[32mUser registered successfully[39m {"email":"final-test@example.com","ipAddress":"::1","timestamp":"2025-06-05 06:29:32.421 AM","userId":"c73d3962-a1dd-4506-843f-0338a1d71937"}
[0mPOST /api/auth/register [32m201[0m 433.700 ms - 336[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749119384627_6xnylajym","ip":"::1","timestamp":"2025-06-05 06:29:44.627 AM","tokenPrefix":"9fbb9981...","userAgent":"curl/8.7.1"}
[33m[33mwarn[33m[39m: 	[33mToken validation failed - not found or expired[39m {"hashedTokenPrefix":"9b295716...","purpose":"email_verification","timestamp":"2025-06-05 06:29:44.717 AM","validationTimeMs":89}
[33m[33mwarn[33m[39m: 	[33mEmail verification failed - invalid token[39m {"correlationId":"verify_1749119384627_6xnylajym","error":"Invalid or expired verification token","timestamp":"2025-06-05 06:29:44.717 AM","tokenPrefix":"9fbb9981..."}
[0mGET /api/secure-auth/verify-email/9fbb99814f4c13a6c99909bc712040d406526a6b28df815299e8f3f799e075c2 [33m400[0m 92.928 ms - 65[0m
[INFO] 06:32:00 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/services/SecureTokenService.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:32:00.386 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:00.387 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:00.387 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:32:00.387 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:32:00.396 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:32:00.396 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:32:00.399 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:32:01.402 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:32:01.402 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:32:01.403 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:32:01.403 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:32:01.410 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:32:01.410 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:32:01.413 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:32:01.413 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:32:02.150 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:32:02.866 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:32:02.868 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:32:02.868 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:32:02.888 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:32:02.888 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDDCxzNbVtPunHh\nVchTNSUHRuSMkZ5ErKkHq+CL/cGUIndiDReNLgIftmlo1LhA8j+t6q80DJnKIGSK\noCf6LIsDaKEIhjM9ScM4Fj6wRt29qwFPoVhOGCevJqp0eOCh0//wR3amhyYa6jZ+\nTlknZBLoE6mOTvsX5+QgbLplNOVqRJ23cvufqT1VRg6HuX1E/7TF+T3I+8gq4it6\nBZD0xF7fThq4Ue5dqtZ/nZs3r5RBRDWKdOhaUA52e7yE2oVK1MN4lkoB8ZMAcGri\ndSiEXK4nfDJGzjy0uoi6yjecdp+AcDi5QV88SVdSZMLGQxXSMycU+KhtD9k8QfHR\nQ5c82+89AgMBAAECggEAKiJE6xXEI4GN51U+LMduw9crOTid3Y0FCMy2+dbsEgGu\nE4brfwqg19Pyinxlf1Y1rm7jwVU1hcYgohe9+xvTPf3Ex9Ah0owUOZIIodD1Ruth\noZ+jsV8jd4FdUkLol9zxzajKd2f7sdXFxtxLAyjpsqvItZ7XPE9SZzTFwWY/Zwih\ngLTCwBpE4IsLBjt7g6dEzJERP1s50rfyV1qpvpHssj3P3dg6iHfqPIWIwLCJAntM\nBmz/qfQmfF4pC88BAgIydY9bkuqjGJg3z51PxvaV4pZyqRcpgPZQaDyIAWG2vArO\nOCM04sVVbDG4uPuVeMPluL906N2JqYOY/sGhuaP1awKBgQD5QbFd7PUHgkBIkrwl\nBtLdX6bk5QzoURfRu0IQiqOIFJDMAfxUrOFUlU4RveSGsxJJSfd/X9caX75x0sBP\nz6v2+zu8aVdwQVp2t9tx0J0o5r12sG322I/zx5YlO8kCUncPkQBb3SGuz3nctSuI\n/Ak68wOnfj+b/X93hPHMwWwWkwKBgQDIUfLYiACUxx3nIgzx/C3BYzIjEd8ju4+e\nQzdjpDSdweWn+P41+zSrID7JsOJ75v3YgtVXte9W3O193oCl/SY0XiWiA9zHHDjR\ncUE4jhzBayj61Fs3mZKTUAn7G3kqCTYVlY2+tGG+fWr+wSK3ftQj56NwzVplftIO\nMiAAb0807wKBgG/sY6x9XnmEr0DnQryNl9n3vYVCpM0cvMlcgInU9yF/upUgvyF2\nj6ffczLcReWGO0vVfuEfNAOPwoBx1hEAe4NnxKcR1kV90xVD8bHlruxSz/ifuIED\nNYCNuon1kokMZpIC1lpprVpFp77HS0kzgyGJRbbMJdvxtG8Cr2D16YcpAoGBAJvW\nZL3ez9TuMm0lKDz4mf/gU5jExnrd5xSP5f82N1ijBy5tnhYQnyChrTbqzMbnJIPT\nBHV/q/o/VOKeviZjkd0bgNtRdefQJMOK/9ondGdkHjVEDtJqPoUrtxgKf3AcSl7w\nQZ0iZwfyOdKGHaPynsZv5c5TcweSaYdxp0OvVEcxAoGBAL3OInrJe/Ofogfe3+T/\n7zdTmh1qo2tB9Ybgqa4tB7Ov0lvDVbFRqnAM7K7cY6/qdML8PENn1O4ZS1XG8toM\ny5yTyv9d7t9YeijNxEwIPmg2QUw7uSFamF4fo/Sv3Lg6HnCzh6CmcrOmNlzc5YTN\nMoZJLq7ohsHGGHb16DjZGhly\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwwsczW1bT7px4VXIUzUl\nB0bkjJGeRKypB6vgi/3BlCJ3Yg0XjS4CH7ZpaNS4QPI/reqvNAyZyiBkiqAn+iyL\nA2ihCIYzPUnDOBY+sEbdvasBT6FYThgnryaqdHjgodP/8Ed2pocmGuo2fk5ZJ2QS\n6BOpjk77F+fkIGy6ZTTlakSdt3L7n6k9VUYOh7l9RP+0xfk9yPvIKuIregWQ9MRe\n304auFHuXarWf52bN6+UQUQ1inToWlAOdnu8hNqFStTDeJZKAfGTAHBq4nUohFyu\nJ3wyRs48tLqIuso3nHafgHA4uUFfPElXUmTCxkMV0jMnFPiobQ/ZPEHx0UOXPNvv\nPQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:32:03.039 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:32:03.098 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:32:03.098 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:32:03.099 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:32:03.101 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:32:03.102 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 06:32:03.138 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:32:03.143 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:32:03.143 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:03.145 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:32:03.145 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:32:03.145 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:32:03.149 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:32:03.149 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:32:03.250 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:32:03.250 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:32:03.250 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:32:03.251 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:32:03.251 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:32:03.251 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:32:03.251 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:32:03.257 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:32:03.260 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:32:03.260 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:32:03.260 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:32:03.260 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:32:03.261 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:32:03.261 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:32:03.261 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:32:03.261 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:32:03.261 AM"}
✅ Server started successfully on port 4000
[32m[32minfo[32m[39m: 	[32mStarting email verification send process[39m {"email":"debug-test@example.com","name":"Debug Test User","timestamp":"2025-06-05 06:32:16.349 AM","userId":"3b645177-8140-41d0-8975-d664b98cf60e"}
[32m[32minfo[32m[39m: 	[32mVerification token found, attempting to send email[39m {"email":"debug-test@example.com","timestamp":"2025-06-05 06:32:16.350 AM","tokenLength":64,"userId":"3b645177-8140-41d0-8975-d664b98cf60e"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail called[39m {"name":"Debug Test User","timestamp":"2025-06-05 06:32:16.350 AM","to":"debug-test@example.com","verificationToken":"3e4844a8..."}
[32m[32minfo[32m[39m: 	[32mGenerated verification URL[39m {"timestamp":"2025-06-05 06:32:16.352 AM","verificationUrl":"https://seoauditer.netlify.app/verify-email/3e4844a8e696cbde067fd43a6d73425fbc49432657d881bc7640420fb099d8bd"}
[32m[32minfo[32m[39m: 	[32mEmail template rendered successfully[39m {"htmlLength":8516,"subject":"Welcome to SEO Director! Please verify your email","textLength":767,"timestamp":"2025-06-05 06:32:16.352 AM"}
[32m[32minfo[32m[39m: 	[32msendEmail called[39m {"initialized":true,"providerName":"SendGrid","subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:32:16.352 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAttempting to send email via SendGrid to debug-test@example.com[39m {"timestamp":"2025-06-05 06:32:16.353 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid send method called[39m {"apiKeyLength":69,"apiKeyPrefix":"SG.Y6rjeWf","configured":true,"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:32:16.353 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid send details[39m {"environment":"development","fromEmail":"admin@seodirector.co","fromName":"SEO Director","timestamp":"2025-06-05 06:32:16.353 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAbout to call SendGrid API[39m {"from":"SEO Director <admin@seodirector.co>","msgStructure":["to","from","subject","html","text","trackingSettings","tracking_settings","headers"],"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:32:16.353 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid API call completed[39m {"messageId":"SOTsJ-EcS7iVImuJtPTS3A","responseBody":"","responseHeaders":{"access-control-allow-headers":"Authorization, Content-Type, On-behalf-of, x-sg-elas-acl","access-control-allow-methods":"POST","access-control-allow-origin":"https://sendgrid.api-docs.io","access-control-max-age":"600","cache-control":"no-cache","connection":"keep-alive","content-length":"0","content-security-policy":"frame-ancestors 'none'","date":"Thu, 05 Jun 2025 10:32:16 GMT","referrer-policy":"strict-origin-when-cross-origin","server":"nginx","strict-transport-security":"max-age=31536000; includeSubDomains","x-content-type-options":"no-sniff","x-message-id":"SOTsJ-EcS7iVImuJtPTS3A","x-no-cors-reason":"https://sendgrid.com/docs/Classroom/Basics/API/cors.html"},"statusCode":202,"timestamp":"2025-06-05 06:32:16.535 AM"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully via SendGrid to debug-test@example.com[39m {"messageId":"SOTsJ-EcS7iVImuJtPTS3A","statusCode":202,"timestamp":"2025-06-05 06:32:16.536 AM"}
[32m[32minfo[32m[39m: 	[32mProvider send result[39m {"result":true,"timestamp":"2025-06-05 06:32:16.536 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully to debug-test@example.com via SendGrid[39m {"timestamp":"2025-06-05 06:32:16.536 AM"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail result[39m {"result":true,"timestamp":"2025-06-05 06:32:16.536 AM","to":"debug-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail verification sent successfully[39m {"email":"debug-test@example.com","timestamp":"2025-06-05 06:32:16.536 AM","userId":"3b645177-8140-41d0-8975-d664b98cf60e"}
[32m[32minfo[32m[39m: 	[32mSecurity event[39m {"email":"debug-test@example.com","event":"user_registered","ipAddress":"::1","timestamp":"2025-06-05 06:32:16.542 AM","userAgent":"node-fetch/1.0 (+https://github.com/bitinn/node-fetch)","userId":"3b645177-8140-41d0-8975-d664b98cf60e"}
[32m[32minfo[32m[39m: 	[32mUser registered successfully[39m {"email":"debug-test@example.com","ipAddress":"::1","timestamp":"2025-06-05 06:32:16.542 AM","userId":"3b645177-8140-41d0-8975-d664b98cf60e"}
[0mPOST /api/auth/register [32m201[0m 443.999 ms - 336[0m
[INFO] 06:32:56 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/auth-rs256.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:32:56.133 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:56.134 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:56.134 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:32:56.134 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:32:56.136 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:32:56.136 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:32:56.137 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:32:57.137 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:32:57.138 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:32:57.138 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:32:57.138 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:32:57.145 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:32:57.145 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:32:57.145 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:32:57.146 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:32:57.807 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:32:58.541 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:32:58.543 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:32:58.543 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:32:58.561 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:32:58.562 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCzp5GrkejLWPjp\nxNccXkMoKh7paTM9GwTQJiNWt8iyafumiJBnODpOiP986mEr3UFPInoeR0/zgs58\nceC650LMrAuvgjIFMsNhD3mIbPu8lAlKKlLrNwN4yKJ9PD9/lcXXSSaxcAVKYjcv\nOaE/3RJfOTS6olF2DKv6z2P8IdFT3iZO+iiivdM9PVpswBtc/gCqq6Qgld/6dKmP\nyePWX066cKaS7Scx92pPZWXbCmOTb49sRWQv8+YwcEMI1b7v2LtD5bGUVYy4+b1N\nfQf9tA+k51YuyRxULc5Elp03ExmSKPDF3Atn2/OxG0CKFmuIA5sdM/0mr4ssY8rF\nGD6TgYx7AgMBAAECggEAOQzH9fdOOTDmTnnrI3+NjPYfPdjh5BAt7ZmG1FVlXr7I\nIqCwVo7k+SaJF1ZoiCDpSeN1ayMTMQ2DW8Jf7opczJj/1vqdvsfZgnuDCP8uy7oo\n3wvkq/wa1qLD8sgMlAvwOQbqSiN8Epxw0MbYvWqLGIEWjQPZoYaxoGJ2ak0k56AV\nLSBTS/afRztpWonFaryLtPoQgjZ9lHW8DwNZml0cCqJnCg9dx61D3rU1ByaUV5Fk\nLNlEQWbaced6sNnUJxDenhE/EULM2RVln+c1vqt0AzxcTcDfbhxdBu+N+u9g2OPU\ni2q4NMidXozKFfRFN71DnwKDhp9GcXuOmwtW0DWAmQKBgQDz79kVWJLOYbo6NeId\nDYLSsIo8cRmfPSMuX0RuKgVTF68L63BJnr29i5faYBgs189FzrbGlzldM+XIOJDu\n2+nofX5JxgnYyVZp/yocXYLgDNyUSWyuMyO/axbiqcGHENLHsaeB3a86n1OIEhOz\nTndxPq4CZVO1MpMh41ymunqzKQKBgQC8ie4dG8H9samIyOoDDWhK0ofUHUuhSJ88\nI2W79szOiaadI7Wfsec1iFuflnr5pqmb0C6f07860s4Q2YAYzuTVL8/bWqtBPncZ\n5N0/jmPrL7OGcCyoTNhlyeNay73C5MTFWK5YZ18clOZJYF69kDH5olI19TQKqd2M\nyQiEvm87AwKBgBEsg7YTBFLvYnMStBajiuBWeYUD2W/yl/V9042F+9X7xuEp9D/a\nozUjDM/dEBaoIvmhMhENOIatTrIn+Vw3s2Ig47FB9hODKUhRJJ/WnY40mZr/CF3D\nT/L8ESJoHS3rK0vP4CEugFW6PeFIlIZ9Mb+RUCLvC1Ooed9a6Hz8iALxAoGAVQq+\nHeEcYotVlj5R16ifh0hpPhMsvwYb1St+QwdyoCLUxYKK9Qpw6OOluFlPBPbZAFAq\nB6uiUS0vB8ijkA0aiNK1JhNCtf4wCL0D0xwuE7KDfrtwWUW4QkmLRLQr1xILc5yp\nn3SZITJEoYpXkZfOAvTlsjL1E25FYbB4KDAhyfMCgYAp0kV8Rt0s3jAPG6Hqum6k\nJeRBuMVcQC1HBhsz63IwBJ2L0coM4X6rFuNMftbVubPXKBxMMUCbUX2IPC07ebfv\n85f1XgjgbrVvSWbLIGMiIu3IGCit+Cz0716suE3ZIeprK8lCyvFvjXs5FvxfDMPp\nOqHDLc/Ms2GzHgSlHBmlTg==\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAs6eRq5Hoy1j46cTXHF5D\nKCoe6WkzPRsE0CYjVrfIsmn7poiQZzg6Toj/fOphK91BTyJ6HkdP84LOfHHguudC\nzKwLr4IyBTLDYQ95iGz7vJQJSipS6zcDeMiifTw/f5XF10kmsXAFSmI3LzmhP90S\nXzk0uqJRdgyr+s9j/CHRU94mTvooor3TPT1abMAbXP4AqqukIJXf+nSpj8nj1l9O\nunCmku0nMfdqT2Vl2wpjk2+PbEVkL/PmMHBDCNW+79i7Q+WxlFWMuPm9TX0H/bQP\npOdWLskcVC3ORJadNxMZkijwxdwLZ9vzsRtAihZriAObHTP9Jq+LLGPKxRg+k4GM\newIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:32:58.663 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:32:58.717 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:32:58.718 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:32:58.719 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:32:58.719 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:32:58.719 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"2ms","timestamp":"2025-06-05 06:32:58.744 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:32:58.747 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:32:58.747 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:32:58.748 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:32:58.749 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:32:58.749 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:32:58.752 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:32:58.752 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:32:58.854 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:32:58.854 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:32:58.854 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:32:58.855 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:32:58.855 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:32:58.855 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:32:58.855 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:32:58.862 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:32:58.866 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:32:58.866 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:32:58.866 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:32:58.866 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:32:58.866 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:32:58.866 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:32:58.867 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:32:58.867 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:32:58.867 AM"}
✅ Server started successfully on port 4000
[INFO] 06:33:44 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/auth-rs256.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:33:44.959 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:33:44.963 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:33:44.963 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:33:44.963 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:33:44.981 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:33:44.982 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:33:44.988 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:33:45.990 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:33:45.991 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:33:45.993 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:33:45.993 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:33:46.000 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:33:46.000 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:33:46.001 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:33:46.001 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:33:46.693 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:33:47.394 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:33:47.396 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:33:47.396 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:33:47.415 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:33:47.415 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCpga+r2PXoPJhF\n+NG6ni2m8NMk0jXeCBnax/rQzOnAmTarijCjkmPDC4NWLeul5UtCg6z1nY1yJYSx\nvtJGkWQoyk1DQV2FTdW6EucgTGWhuo1TbIpmmzuWV86MBYokDAjz/J7Yw/fdodeM\nsIJNKBVUtQ61qQsp3c2nQzvwAODkDtSqotZ/d7Weg8CNtH9Wo549FtGl6+m0k5aN\nbCeoSVV81pI9Vf5Wf7/a8kwXdyKYP/KEZdKAPLlvQdDbq0is+lWTL6SfaUoWmlPE\nna8spBJnRid7wQJtO7IK+Fr5iCczSjWmynHAHfVaYEuW4Un/cWYkRQUoe4zrkRZ1\n0TAixi0nAgMBAAECggEACEueaeCfBRkm8tDNHBtO12tGSuovW7ASXEpYlgkFpfjO\n4vSSLncd2Gjtqeb5E35Hz6mQlPTQ36rs7waaf+5iJfSqylAzxzAIy1l5XLqs2X/3\n3vTM8V3GrbQMtijDBWzsr+j5FVls743SrtdS+9Bx3eio5q8g45EFOajsgvGFZVdJ\nl8yVVLixCR7LAsgGCfVQScT3MbIQy6Yl3nL69kCnNW4oFpxHFI2vyIYwijkfv0Xx\n6Btd9TQcTF2Hgx5zLSBzVXPiEcCB48ItbKUQvI9kAurLtlbrMIGc8fgIbEDqk4FX\nQUjIiWL4lXzluUekJZaNG6REqkWW0MdFhK94FT+t4QKBgQDdc/ptY2ySrwo62qFD\nlYpqN3gIwlqL0x1EeBKo49dtmX9KryYtVqh4HwR9FSuUr58oqiU043fg0kvjwNqz\nE2WcMRqwPaw7ykfSKOAgu9jn3hKDdg0ZDB9l8NQ89x1Gew3IXWG6lDQsdYhrWOTk\nwntXGmw/PIiyYPgLgTyr6GC8BwKBgQDD8yhCsUn381L35WS7yfu+a6lFPNii7uO3\nAG1Qo+spepcGwKbQoIeZU8SbumatX87ubo9USf8EE4JfQ60ODZ0Tw1q5GxWLpSaE\nIeTZkP1+rzOrmB+tdHgOkZ9JJ7JZ4an87qlH4LJu2B9hfnaiafsQEvJ0YkgKJDpm\nFJoGVSL94QKBgQCHvJDg/7IK7rNMg7mY3U4r8LfoVoh9b/degmKdlpnzGcTGGDlE\nTPuSNSDhMlq2FjduC2wm0M4nxX6yqQDkBp2fcRG0uPia5U/EZz2JktpOtPWQEonQ\nsneEWmscuzL8gmxeRa6jWDfqkFf/xEr4VKSZLR7wW8BF5d3j32E61YKFfQKBgHGv\ndtFS2O6BfsaSkaIeKu+suPWRusK1ROqc1c9uevaCyHLDfUUXjfSYVD5hpEa8imtt\nO70UfV9ZDk/FDPdVUKfxtIYmv5ZYiAMrQwIzi89fSOQqi15wb2NMe5TO8jwRoDU+\nJnqsU/nZbEN9QskyIdaOl5qMlu1DXZpyI3a/GGEhAoGAVxpibkWklZBcdDG7j/kw\naLsN+aRayaXBBZF3jZOagiP4Iken2bp5k72x7PYDP8WsKOoOkxZutBEB7zGlW1Dv\n8m2gsNtfXuH7bMuNKhTHRc2STLbQW+xNc3dw8AOPWnfugXge40qpodcGuBJFvp/H\nyXmczfT7UdONyL97Pio2TP8=\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqYGvq9j16DyYRfjRup4t\npvDTJNI13ggZ2sf60MzpwJk2q4owo5JjwwuDVi3rpeVLQoOs9Z2NciWEsb7SRpFk\nKMpNQ0FdhU3VuhLnIExlobqNU2yKZps7llfOjAWKJAwI8/ye2MP33aHXjLCCTSgV\nVLUOtakLKd3Np0M78ADg5A7UqqLWf3e1noPAjbR/VqOePRbRpevptJOWjWwnqElV\nfNaSPVX+Vn+/2vJMF3cimD/yhGXSgDy5b0HQ26tIrPpVky+kn2lKFppTxJ2vLKQS\nZ0Yne8ECbTuyCvha+YgnM0o1pspxwB31WmBLluFJ/3FmJEUFKHuM65EWddEwIsYt\nJwIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:33:47.468 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:33:47.522 AM"}
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:33:47.522 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:33:47.522 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:33:47.523 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:33:47.523 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 06:33:47.546 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:33:47.550 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:33:47.550 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:33:47.551 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:33:47.551 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:33:47.551 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:33:47.555 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:33:47.555 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:33:47.657 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:33:47.657 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:33:47.657 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:33:47.658 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:33:47.658 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:33:47.658 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:33:47.658 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:33:47.664 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:33:47.667 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:33:47.667 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:33:47.667 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:33:47.667 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:33:47.667 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:33:47.667 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:33:47.668 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:33:47.668 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:33:47.668 AM"}
✅ Server started successfully on port 4000
[INFO] 06:33:58 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/auth-rs256.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:33:58.765 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:33:58.766 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:33:58.766 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:33:58.766 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:33:58.771 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:33:58.771 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:33:58.774 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:33:59.775 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:33:59.775 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:33:59.776 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:33:59.777 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:33:59.782 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:33:59.782 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:33:59.784 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:33:59.784 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:34:00.334 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:34:00.998 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:34:01.000 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:34:01.000 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:34:01.017 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:34:01.017 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDE0tbiK8ganaLH\nuFOfaVAyr5oXS6J4BdHFtvFzfp5UF0ccfH+MLWnhuw8uOc/N7vmM80Vn2olwr5fm\nb3/Ev287ODfr2hjQqorzHIrDYLVY4KvMFx7o/7acvU+I0DmCn7L5cTUI8XgICva7\niAbRr0ZH6U5hgvjUzkUDIzlnDF5NEBd3Mg5Zy/j6pu2tXhY1APy1TvIkAnySQl55\nbZs+OZ9A+8FuB+T6ahrUJ67791R8J3Z1dqRDrOGyLEdB6R2gHd22URi1TPBnV3/Z\nMpzSkTdRBaH4soVKuWqg+hXgJpzpukNaxRCB2tcw5I+IpcUedV7iniu1faPPMz1A\nqDu5gO73AgMBAAECggEAEgQ2tUdKrt0FHIEL7oimVa1rTnyW56Oouw9u9KJ/fbUP\nxlTDHCLAEXCdCB80nWYlo7hU/xerAwyfu/Ey4eCgHuybedRh9x/VTkGrlgzRLMyM\nDUeEhdF6dsiBckWVLhbOPDUXpLTtxtayFSJzdVg097oseZKSknA7MvlTdNJWA3mv\ngvj1eqWtn368/FUBhvtsYObM6YMF9AW99fUC82Tnlq4DzuYZeogpeEJEI1dasQLS\nkdyCYbuQQeI7r4LflQRYBfDKP6LOxpY5cvlrA+bY/cLVZcoZuaUaHf9mcfdoqlHU\nf82EftsahHwS0AZeX5Gz9K1YbFc0DM04P48nyS/SqQKBgQDjfmhPRtMJLE8kv1Kn\nsX16JAql8zod5XtN2N/X076MAKowDtxSKtpN42s8iZmUCy47dnO8ug+tUYyQspZA\nWiMgHqSzmHxw4VuOcqGXKuMISx/lCZZymosmyi/HqB5FtjP/80cnKfRIzGzzGL+n\n3jGmQYdqBU6DUC+JYucKGkyqjQKBgQDdfJZZDtOLAM+ByigHdQG5Quj70o/OpiIs\nl2FNG16nuyaTFRer4EMzd66PpwEw3wHeUnpWhY/55TC8rFFo0kBW/hk0fStgLxmv\nYDa5jdNxRPoLQamDve3Wdj12kpeyk9FrZ79GZiDKPRjG+onLPBRJygr5bv6XFhxd\nrLSMNCcAkwKBgG80R4EZOefuBPINpDXdCV0/aQUeFHawysmPDjzOgQKnAIpleUWh\nNP2GAdGh4bUAkiT3DjRfL3KlvnStF811Ql5dHF2+WHZFcx/64QqoKDrRnlGzkhuL\neCIKC7kpcULagijHnyyB0awUYd2jZ2yDrPl8ZtlopqyB8frSoeXKXVexAoGBAKyH\nv2pSVVEjaYE142ajq5sP1wNK64DTAy3vIfl5h4trCspqFM1rXY26/fyi4BecsAzp\n/KhnVFcaRJPEO4pGtZ3OQ/4SPvam2gA2F4sFQp8qVwjrtkuMaLe11X0HBioyYWCk\nKWiCZ6qCW0msoifxffBY9aGF58XzkFccEGxit7sHAoGAYhmWuFsZh2utdhE66J90\nUliLbhOUQMyWQbWGPj4/OoIwg7ppdVqOvmh4jB12EKVXysPnnl+hSkFxbna/CpxR\nRcFzmiz2+xlEG1GN1HRTn2VbemPP7LwRWPi3uBOhWl2CztkzgRrsfLuJ2PRyA+XG\nvCSJ7Ztfbm51HExIGvz5994=\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxNLW4ivIGp2ix7hTn2lQ\nMq+aF0uieAXRxbbxc36eVBdHHHx/jC1p4bsPLjnPze75jPNFZ9qJcK+X5m9/xL9v\nOzg369oY0KqK8xyKw2C1WOCrzBce6P+2nL1PiNA5gp+y+XE1CPF4CAr2u4gG0a9G\nR+lOYYL41M5FAyM5ZwxeTRAXdzIOWcv4+qbtrV4WNQD8tU7yJAJ8kkJeeW2bPjmf\nQPvBbgfk+moa1Ceu+/dUfCd2dXakQ6zhsixHQekdoB3dtlEYtUzwZ1d/2TKc0pE3\nUQWh+LKFSrlqoPoV4Cac6bpDWsUQgdrXMOSPiKXFHnVe4p4rtX2jzzM9QKg7uYDu\n9wIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:34:01.058 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:34:01.107 AM"}
Redis client connected successfully in rate-limit middleware
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:34:01.112 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:34:01.112 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:34:01.112 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:34:01.112 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 06:34:01.135 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:34:01.139 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:34:01.139 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:34:01.141 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:34:01.141 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:34:01.141 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:34:01.145 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:34:01.145 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:34:01.246 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:34:01.246 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:34:01.246 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:34:01.247 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:34:01.247 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:34:01.247 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:34:01.247 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:34:01.253 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:34:01.256 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:34:01.256 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:34:01.256 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:34:01.256 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:34:01.257 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:34:01.257 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:34:01.258 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:34:01.258 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:34:01.258 AM"}
✅ Server started successfully on port 4000
🔐 GENERATING SECURE TOKEN for user: 8e93e260-ed00-454f-bbe7-da069b47a650
[31m[31merror[31m[39m: 	[31mToken generation failed[39m {"email":"fixed-test@example.com","error":"Cannot read properties of undefined (reading 'verificationToken')","generationTimeMs":0,"purpose":"email_verification","timestamp":"2025-06-05 06:34:42.874 AM","userId":"8e93e260-ed00-454f-bbe7-da069b47a650"}
[31m[31merror[31m[39m: 	[31m500 - Internal Server Error - /api/auth/register - POST - ::1[39m {"body":{"email":"fixed-test@example.com","name":"Fixed Test User","password":"TestPassword123!@#"},"error":"Error: Failed to generate secure token\n    at SecureTokenService.generateVerificationToken (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/services/SecureTokenService.ts:130:13)\n    at AuthController.register (/Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/auth-rs256.controller.ts:129:27)","params":{},"query":{},"timestamp":"2025-06-05 06:34:42.885 AM"}
[0mPOST /api/auth/register [31m500[0m 265.685 ms - 162[0m
[INFO] 06:35:11 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/auth-rs256.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:35:11.137 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:35:11.139 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:35:11.140 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:35:11.140 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:35:11.143 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:35:11.143 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:35:11.145 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:35:12.145 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:35:12.146 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:35:12.146 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:35:12.146 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:35:12.153 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:35:12.153 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:35:12.153 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:35:12.153 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:35:12.806 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:35:13.532 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:35:13.533 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:35:13.534 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:35:13.554 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:35:13.555 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCritjlGPUY2vzE\n4YThI8B615hncAZrPEXVoxQwRUmAPH1q06X8aXAYQMWKQOReYoeN4iiOA0lBCTO7\nTL3MHGKmGvS/RZ/L34bN709KMENf7SRT6noNX9UmIY2hj2xIHhnOcEjhuLQ3D4IG\nRfYy7SGFOLw7/ea8fRV4tvAaUPa17bF3f+3ktbDIjuX9Q3GN6H2zg+Ibvx3QLNfa\nJZRKotYF1jM7exPBGlMGCPpKzFOmnLTKumejE8As0Cf1ojKerdl6eMHX5Tjatn2i\nGKbxXeOQbauxgpqEpNbWhYgK9It/Z6CM0huDf3zk0UmCouXiliHrg9J+xzQJVVr2\n/yVxYaJtAgMBAAECggEAVKf4gxMufd4wiR78ezkwF8+HDGEKIejEU/qfj3TaIZl4\nkXwyuZ71LVrlweVlbjj0ya33MqJnh9t5NrFYJz9I5c1+xFghVLUSq1WzDRtFXLVE\nzM71/dyx7Zf4c+c6WlrUhH8AULjc4yFZmyvypM5G0R6fMoIKWTHno0OwuWQEZOJB\nUswEEDKyg8+0HKtRcdzXf29zV7h53yU83FW5/S9w8W3OslcXAZIyw2h+V/ePHMpA\n0TIlvPvYG/GJVxUYsqSXr2aHZ8q7nDlh8KyiTbflPmU6nISXdmt0+kwhMXVjtf2J\nnNvEe4pwfoj3n40ANewS757JlyObt/npeYGBXgRglwKBgQDofjR5vfiXXDcylxyT\nW5C/pIoe0XZn/ViYB1n4slk3bC2uKJsUYJ229rwWZGfWSHA2RZYzodwkSjnujMz6\nV9b3YPbqtuMptnD53ItxfTVW+L1ZGPkEYtJ7/X9dajgPIqRdQVSvOKKLPC3OW3jD\nhN9k5Ln9rimDy11A76sadoFW3wKBgQC84wKyktDZp1djg9q+7ARkQuqHFtH/Ad1j\nMDX3ggCt37DSa7KxE+GL7XXirGTihbxGQzssfv6OCfvl07/CYG9jZ1szEPyF70BH\nCIe2OYQ2YIHxZ/a17HszVSiaHi1QFdDsgCzMmWQlBnFiTYVkM7iTaxXK59Ju3HWy\nosrhRjEsMwKBgCeIjlPFQeg6/gfUOj+0akCsMfBbnc7A/becSGhJq3IJKxtaPESS\nyT67ZfBI0n9Vgf84hfnxpAVnucIenxxSo3MdQd9Xifkl1MAoCG4b5F4NneTwoidk\nxnXe/TFdRnsMYPaajVPeRYV3jjJwy3Azv+jgG+BPJTAL/Kd2GZo+XG/xAoGBAJyU\ns0/FVUyY5GCilVtf2+QhdLm3uS1kJlprRNGA+38nyDUnAmK40Ghm2SqnLpp5srGs\nWglw3SRyMlc7SeOgfbYxn/CdTDjbNLWt5JKy618Ica/lNydoelj7Z0UbbwTMkPz8\n5CZXoiTvSl7rVIDUP1Y1l0M1GcS9DPSg7v4AahLxAoGBANZD5+Om4AainKb/4HQG\nh2MRBLA2+82VWTsrpJxelkk7anJEI9rSJceTdOkmJ5VLqvgUC8Le20KZEV9Oex+2\nNrQj73zHLooXjlRmis+XPGsLl4n5WFuUmIySEf0GISSxEEvHQQtb7MA1bcgGMJTV\nFhjFTLYWHFUMvSJ5zHtOHP2P\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAq4rY5Rj1GNr8xOGE4SPA\neteYZ3AGazxF1aMUMEVJgDx9atOl/GlwGEDFikDkXmKHjeIojgNJQQkzu0y9zBxi\nphr0v0Wfy9+Gze9PSjBDX+0kU+p6DV/VJiGNoY9sSB4ZznBI4bi0Nw+CBkX2Mu0h\nhTi8O/3mvH0VeLbwGlD2te2xd3/t5LWwyI7l/UNxjeh9s4PiG78d0CzX2iWUSqLW\nBdYzO3sTwRpTBgj6SsxTppy0yrpnoxPALNAn9aIynq3ZenjB1+U42rZ9ohim8V3j\nkG2rsYKahKTW1oWICvSLf2egjNIbg3985NFJgqLl4pYh64PSfsc0CVVa9v8lcWGi\nbQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:35:13.785 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:35:13.837 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:35:13.837 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:35:13.838 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:35:13.838 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:35:13.840 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"0ms","timestamp":"2025-06-05 06:35:13.860 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:35:13.864 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:35:13.864 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:35:13.866 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:35:13.866 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:35:13.866 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:35:13.870 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:35:13.870 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:35:13.971 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:35:13.971 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:35:13.971 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:35:13.972 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:35:13.972 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:35:13.972 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:35:13.972 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:35:13.978 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:35:13.981 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:35:13.981 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:35:13.981 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:35:13.981 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:35:13.982 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:35:13.982 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:35:13.982 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:35:13.982 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:35:13.982 AM"}
✅ Server started successfully on port 4000
🔐 GENERATING SECURE TOKEN for user: d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7
=== STORING TOKEN DEBUG ===
Email: final-fixed-test@example.com
HashedToken prefix: c01d521651962110...
UserId: d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7
Purpose: email_verification
Sequence: 1
ExpiresAt: 2025-06-05T11:35:44.602Z
Creating token with data: {
  hashedToken: 'c01d521651962110253bf4188c465e77ec4d116cfcaa5a281fcd8e7f9df6d0f1',
  userId: 'd0ba879f-ca57-487e-bc84-a7cd4a5dd0a7',
  email: 'final-fixed-test@example.com',
  purpose: 'email_verification',
  sequence: 1,
  expiresAt: 2025-06-05T11:35:44.602Z,
  isValid: true,
  createdAt: 2025-06-05T10:35:44.602Z
}
✅ Token stored successfully: {
  id: 'f7cab79e-c64a-4aa8-92ca-2a40ef827117',
  email: 'final-fixed-test@example.com',
  hashedTokenPrefix: 'c01d521651962110...'
}
✅ Token verified in database: {
  id: 'f7cab79e-c64a-4aa8-92ca-2a40ef827117',
  email: 'final-fixed-test@example.com',
  isValid: true,
  expiresAt: 2025-06-05T11:35:44.602Z
}
[32m[32minfo[32m[39m: 	[32mSecure token generated[39m {"email":"final-fixed-test@example.com","expiresAt":"2025-06-05T11:35:44.602Z","generationTimeMs":26,"hashedTokenPrefix":"c01d5216...","purpose":"email_verification","sequence":1,"timestamp":"2025-06-05 06:35:44.628 AM","tokenLength":64,"userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
✅ SECURE TOKEN GENERATED: {
  userId: 'd0ba879f-ca57-487e-bc84-a7cd4a5dd0a7',
  email: 'final-fixed-test@example.com',
  tokenLength: 64,
  tokenPrefix: 'de2af091ed4df453...'
}
[32m[32minfo[32m[39m: 	[32mStarting email verification send process[39m {"email":"final-fixed-test@example.com","name":"Final Fixed Test User","timestamp":"2025-06-05 06:35:44.628 AM","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[32m[32minfo[32m[39m: 	[32mVerification token found, attempting to send email[39m {"email":"final-fixed-test@example.com","timestamp":"2025-06-05 06:35:44.629 AM","tokenLength":64,"userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail called[39m {"name":"Final Fixed Test User","timestamp":"2025-06-05 06:35:44.629 AM","to":"final-fixed-test@example.com","verificationToken":"de2af091..."}
[32m[32minfo[32m[39m: 	[32mGenerated verification URL[39m {"timestamp":"2025-06-05 06:35:44.631 AM","verificationUrl":"https://seoauditer.netlify.app/verify-email/de2af091ed4df4534ff1ee7d3f0c182ad17197906a14e6930d4453b6edea1490"}
[32m[32minfo[32m[39m: 	[32mEmail template rendered successfully[39m {"htmlLength":8522,"subject":"Welcome to SEO Director! Please verify your email","textLength":773,"timestamp":"2025-06-05 06:35:44.631 AM"}
[32m[32minfo[32m[39m: 	[32msendEmail called[39m {"initialized":true,"providerName":"SendGrid","subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:35:44.631 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAttempting to send email via SendGrid to final-fixed-test@example.com[39m {"timestamp":"2025-06-05 06:35:44.632 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid send method called[39m {"apiKeyLength":69,"apiKeyPrefix":"SG.Y6rjeWf","configured":true,"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:35:44.632 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid send details[39m {"environment":"development","fromEmail":"admin@seodirector.co","fromName":"SEO Director","timestamp":"2025-06-05 06:35:44.632 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mAbout to call SendGrid API[39m {"from":"SEO Director <admin@seodirector.co>","msgStructure":["to","from","subject","html","text","trackingSettings","tracking_settings","headers"],"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:35:44.632 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid API call completed[39m {"messageId":"v2RX4BkEQQ6HhsnmO2LC4w","responseBody":"","responseHeaders":{"access-control-allow-headers":"Authorization, Content-Type, On-behalf-of, x-sg-elas-acl","access-control-allow-methods":"POST","access-control-allow-origin":"https://sendgrid.api-docs.io","access-control-max-age":"600","cache-control":"no-cache","connection":"keep-alive","content-length":"0","content-security-policy":"frame-ancestors 'none'","date":"Thu, 05 Jun 2025 10:35:45 GMT","referrer-policy":"strict-origin-when-cross-origin","server":"nginx","strict-transport-security":"max-age=31536000; includeSubDomains","x-content-type-options":"no-sniff","x-message-id":"v2RX4BkEQQ6HhsnmO2LC4w","x-no-cors-reason":"https://sendgrid.com/docs/Classroom/Basics/API/cors.html"},"statusCode":202,"timestamp":"2025-06-05 06:35:44.908 AM"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully via SendGrid to final-fixed-test@example.com[39m {"messageId":"v2RX4BkEQQ6HhsnmO2LC4w","statusCode":202,"timestamp":"2025-06-05 06:35:44.908 AM"}
[32m[32minfo[32m[39m: 	[32mProvider send result[39m {"result":true,"timestamp":"2025-06-05 06:35:44.908 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully to final-fixed-test@example.com via SendGrid[39m {"timestamp":"2025-06-05 06:35:44.908 AM"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail result[39m {"result":true,"timestamp":"2025-06-05 06:35:44.908 AM","to":"final-fixed-test@example.com"}
[32m[32minfo[32m[39m: 	[32mEmail verification sent successfully[39m {"email":"final-fixed-test@example.com","timestamp":"2025-06-05 06:35:44.908 AM","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[32m[32minfo[32m[39m: 	[32mSecurity event[39m {"email":"final-fixed-test@example.com","event":"user_registered","ipAddress":"::1","timestamp":"2025-06-05 06:35:44.912 AM","userAgent":"node-fetch/1.0 (+https://github.com/bitinn/node-fetch)","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[32m[32minfo[32m[39m: 	[32mUser registered successfully[39m {"email":"final-fixed-test@example.com","ipAddress":"::1","timestamp":"2025-06-05 06:35:44.913 AM","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[0mPOST /api/auth/register [32m201[0m 553.286 ms - 348[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749119760889_dni4v0sxq","ip":"::1","timestamp":"2025-06-05 06:36:00.894 AM","tokenPrefix":"de2af091...","userAgent":"curl/8.7.1"}
[32m[32minfo[32m[39m: 	[32mToken validation successful[39m {"email":"final-fixed-test@example.com","purpose":"email_verification","sequence":1,"timestamp":"2025-06-05 06:36:00.952 AM","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7","validationTimeMs":54}
[32m[32minfo[32m[39m: 	[32mToken invalidated[39m {"affectedRows":1,"hashedTokenPrefix":"c01d5216...","timestamp":"2025-06-05 06:36:00.991 AM"}
[32m[32minfo[32m[39m: 	[32mEmail verification successful[39m {"correlationId":"verify_1749119760889_dni4v0sxq","email":"final-fixed-test@example.com","timestamp":"2025-06-05 06:36:00.992 AM","tokenPrefix":"de2af091...","userId":"d0ba879f-ca57-487e-bc84-a7cd4a5dd0a7"}
[0mGET /api/secure-auth/verify-email/de2af091ed4df4534ff1ee7d3f0c182ad17197906a14e6930d4453b6edea1490 [32m200[0m 105.556 ms - 222[0m
[32m[32minfo[32m[39m: 	[32mFound existing user during registration[39m {"email":"nmang004@gmail.com","emailVerified":false,"timestamp":"2025-06-05 06:38:50.496 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mResending verification email for existing unverified user[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 06:38:50.496 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mStarting email verification send process[39m {"email":"nmang004@gmail.com","name":"Nicholas Mangubat","timestamp":"2025-06-05 06:38:50.496 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mVerification token found, attempting to send email[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 06:38:50.520 AM","tokenLength":64,"userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail called[39m {"name":"Nicholas Mangubat","timestamp":"2025-06-05 06:38:50.520 AM","to":"nmang004@gmail.com","verificationToken":"90bd1137..."}
[32m[32minfo[32m[39m: 	[32mGenerated verification URL[39m {"timestamp":"2025-06-05 06:38:50.521 AM","verificationUrl":"https://seoauditer.netlify.app/verify-email/90bd1137b2886e58430f78cbc28127f00315f366101cba6467379f473ef26481"}
[32m[32minfo[32m[39m: 	[32mEmail template rendered successfully[39m {"htmlLength":8518,"subject":"Welcome to SEO Director! Please verify your email","textLength":769,"timestamp":"2025-06-05 06:38:50.521 AM"}
[32m[32minfo[32m[39m: 	[32msendEmail called[39m {"initialized":true,"providerName":"SendGrid","subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:38:50.521 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mAttempting to send email via SendGrid to nmang004@gmail.com[39m {"timestamp":"2025-06-05 06:38:50.521 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid send method called[39m {"apiKeyLength":69,"apiKeyPrefix":"SG.Y6rjeWf","configured":true,"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:38:50.521 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid send details[39m {"environment":"development","fromEmail":"admin@seodirector.co","fromName":"SEO Director","timestamp":"2025-06-05 06:38:50.521 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mAbout to call SendGrid API[39m {"from":"SEO Director <admin@seodirector.co>","msgStructure":["to","from","subject","html","text","trackingSettings","tracking_settings","headers"],"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 06:38:50.521 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid API call completed[39m {"messageId":"V5lyMxwqR4W5nPGHnvDy4w","responseBody":"","responseHeaders":{"access-control-allow-headers":"Authorization, Content-Type, On-behalf-of, x-sg-elas-acl","access-control-allow-methods":"POST","access-control-allow-origin":"https://sendgrid.api-docs.io","access-control-max-age":"600","cache-control":"no-cache","connection":"keep-alive","content-length":"0","content-security-policy":"frame-ancestors 'none'","date":"Thu, 05 Jun 2025 10:38:51 GMT","referrer-policy":"strict-origin-when-cross-origin","server":"nginx","strict-transport-security":"max-age=31536000; includeSubDomains","x-content-type-options":"no-sniff","x-message-id":"V5lyMxwqR4W5nPGHnvDy4w","x-no-cors-reason":"https://sendgrid.com/docs/Classroom/Basics/API/cors.html"},"statusCode":202,"timestamp":"2025-06-05 06:38:50.856 AM"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully via SendGrid to nmang004@gmail.com[39m {"messageId":"V5lyMxwqR4W5nPGHnvDy4w","statusCode":202,"timestamp":"2025-06-05 06:38:50.857 AM"}
[32m[32minfo[32m[39m: 	[32mProvider send result[39m {"result":true,"timestamp":"2025-06-05 06:38:50.857 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully to nmang004@gmail.com via SendGrid[39m {"timestamp":"2025-06-05 06:38:50.857 AM"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail result[39m {"result":true,"timestamp":"2025-06-05 06:38:50.857 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mEmail verification sent successfully[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 06:38:50.857 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[0mPOST /api/auth/register [32m200[0m 418.780 ms - 131[0m
[INFO] 06:40:46 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/services/SecureTokenService.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 06:40:46.328 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:40:46.330 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:40:46.331 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 06:40:46.332 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 06:40:46.345 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 06:40:46.346 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 06:40:46.350 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 06:40:47.352 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 06:40:47.353 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 06:40:47.355 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 06:40:47.355 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:40:47.362 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 06:40:47.362 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 06:40:47.369 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 06:40:47.369 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 06:40:48.000 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:40:48.698 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 06:40:48.700 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 06:40:48.700 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 06:40:48.721 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 06:40:48.721 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDGdpaE560IVKNx\nDILeqtalnJxxeMWFWLmXbA292LD2HoOqghHNd6hIcdErtO2hOmzqszzSstUSaEib\nZw/iVeymMxOnWNZKmEq81Q0YQ2K8lA7G2MzaDi5PjW7uNSk8BzB7rtLb8Rc28qNn\nbaGnvzXWAo+hVGxkFJNaBqXO82QeYyREh0WEZTomKK9I2OEt7/gXrkJrZ2XIK69w\n3oMAbftMhoi9Hl/JQI0fXy09fcDGSABkcH6yYvCH1c/9J4Z7kM3rSur4HwWg3QY/\nPf2biO6ljqG2/rVNWedhPT64m8fieLSaHXjCjnt0hWnDmKEG5Et51uluC6BZ1okx\nO3mCRgS1AgMBAAECggEAF0EH6/S1apd4OyPLJcoAspECJ62N/0zhGiP4DDmaqovy\nw4TQDzIpDqv/ZU6i1VRiNLHhu5JmsuxzLXpK+ys0OlkbwW0AVuc3Qp74FNK4e/4h\nKR14C0jEFmAtEk46UaVKAgP/AvRh0vdlPBY1bdFSvou4Rp/8v1FF3rOOtAwCvCiO\n1B2Rf9BNMvAUHcN6COsS3hPHYbN/mKGSd2KICkdAEswQ9PJsMTXTVb7aS0HQwE89\nKpV4byE6ikvBKXOzjJ8tztQ9MJNtTU/hJZ2PUhG8tbawqgxODG+LBYpKzcsuwE6K\ndTj4v494LCc2TI/1e9VaGMvdlXnSNxCFNdqQLClLwQKBgQDr0Fg3NI8M+k7F4NYX\nRA98bZzltc3O0bRupuomlUa8zCpK/XUUKblL5cro8kt8YOiHJtYWB/+Zu6ELjZBz\nUhM20ggmSZmIeUqoItAXoGicsQyC28YxrnRy6XW0NjkERNArKoGvtyC1OoycuACA\n6FqbQr9Sp9p4DhAEy1syA1aNkQKBgQDXc7y4dGGgpR/aNaa3f34k4Z7D6CTUzME5\n47D4rbgNIHFzwVlQTXvVyrmjEa9qoVB9Nrbg7YqWp7mRwXjWaPl99jiqlaGHqiY8\n/YBvrYwsxMFiAdOqGdv4yEeL1wfViQM5IiaauItJfU0Yy8b/J76Y+VGVdm9PI2EH\nM9gCurpC5QKBgAPNo26YgWojK1wTqUBMz7chCXPG/9/DEBbsyEABDlgDLvdwqQ+/\nMIbh2Ojy53bFFVsArFlEncG7/ffyu46wlzC+KHV9oGVMF4EotpR6+NT2Ig6GPucU\nOjqUO1rBuR+xgG4BzH+qA3QI0rXAXfm2RafVZsKNhH+FMorxQLJIzX+RAoGBAKKi\npB/dAmEgpIW0oC++FrvCcHVTxJG6KlYHkWx2vgtypRGLL19VzhfZWv5EeFUWhkqu\nxafOyCHnZEYpdIztWwABoE7seq2M/CZn+c7Tg4+7ynqwBFZQBOOsU420+R3wujUj\nmV6L1eDYrBz+ni23k8Gn2jTn3Sgw/apRMUsGJ1odAoGBAMXQMGl2LjKMMCcJOj+J\ntp2uEZZMzXcBxqC4ATvK9yfyLA3gLAKNTvigxzhELwn/tzeRbM176CIrvPVSvKB3\noKiSzvVvs9Z0fyzcWbCUClbrq9ptkf0YtgLGibGqjnFM4Xqa++gYZiLew0EmRlT0\n6f34z3gtrU4VUkupV2/7K9RW\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxnaWhOetCFSjcQyC3qrW\npZyccXjFhVi5l2wNvdiw9h6DqoIRzXeoSHHRK7TtoTps6rM80rLVEmhIm2cP4lXs\npjMTp1jWSphKvNUNGENivJQOxtjM2g4uT41u7jUpPAcwe67S2/EXNvKjZ22hp781\n1gKPoVRsZBSTWgalzvNkHmMkRIdFhGU6JiivSNjhLe/4F65Ca2dlyCuvcN6DAG37\nTIaIvR5fyUCNH18tPX3AxkgAZHB+smLwh9XP/SeGe5DN60rq+B8FoN0GPz39m4ju\npY6htv61TVnnYT0+uJvH4ni0mh14wo57dIVpw5ihBuRLedbpbgugWdaJMTt5gkYE\ntQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 06:40:48.835 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 06:40:48.894 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 06:40:48.895 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 06:40:48.895 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 06:40:48.895 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:40:48.901 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 06:40:48.930 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 06:40:48.935 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 06:40:48.936 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 06:40:48.937 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 06:40:48.937 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 06:40:48.937 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 06:40:48.941 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 06:40:48.941 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 06:40:49.041 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 06:40:49.041 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 06:40:49.041 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 06:40:49.042 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 06:40:49.042 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 06:40:49.042 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 06:40:49.042 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 06:40:49.049 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 06:40:49.050 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 06:40:49.051 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 06:40:49.051 AM"}
✅ Server started successfully on port 4000
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749121202301_9dzuzbhcx","ip":"::1","timestamp":"2025-06-05 07:00:02.303 AM","tokenPrefix":"90bd1137...","userAgent":"axios/1.9.0"}
[33m[33mwarn[33m[39m: 	[33mToken validation failed - not found or expired[39m {"hashedTokenPrefix":"8733bf27...","purpose":"email_verification","timestamp":"2025-06-05 07:00:02.464 AM","validationTimeMs":153}
[33m[33mwarn[33m[39m: 	[33mEmail verification failed - invalid token[39m {"correlationId":"verify_1749121202301_9dzuzbhcx","error":"Invalid or expired verification token","timestamp":"2025-06-05 07:00:02.465 AM","tokenPrefix":"90bd1137..."}
[0mGET /api/secure-auth/verify-email/90bd1137b2886e58430f78cbc28127f00315f366101cba646737f473ef2d5bef8 [33m400[0m 183.980 ms - 65[0m
[32m[32minfo[32m[39m: 	[32mFound existing user during registration[39m {"email":"nmang004@gmail.com","emailVerified":false,"timestamp":"2025-06-05 07:03:44.095 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mResending verification email for existing unverified user[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 07:03:44.095 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mStarting email verification send process[39m {"email":"nmang004@gmail.com","name":"Nicholas Mangubat","timestamp":"2025-06-05 07:03:44.095 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32mVerification token found, attempting to send email[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 07:03:44.096 AM","tokenLength":64,"userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail called[39m {"name":"Nicholas Mangubat","timestamp":"2025-06-05 07:03:44.098 AM","to":"nmang004@gmail.com","verificationToken":"90bd1137..."}
[32m[32minfo[32m[39m: 	[32mGenerated verification URL[39m {"timestamp":"2025-06-05 07:03:44.105 AM","verificationUrl":"https://seoauditer.netlify.app/verify-email/90bd1137b2886e58430f78cbc28127f00315f366101cba6467379f473ef26481"}
[32m[32minfo[32m[39m: 	[32mEmail template rendered successfully[39m {"htmlLength":8518,"subject":"Welcome to SEO Director! Please verify your email","textLength":769,"timestamp":"2025-06-05 07:03:44.107 AM"}
[32m[32minfo[32m[39m: 	[32msendEmail called[39m {"initialized":true,"providerName":"SendGrid","subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 07:03:44.107 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mAttempting to send email via SendGrid to nmang004@gmail.com[39m {"timestamp":"2025-06-05 07:03:44.107 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid send method called[39m {"apiKeyLength":69,"apiKeyPrefix":"SG.Y6rjeWf","configured":true,"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 07:03:44.108 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid send details[39m {"environment":"development","fromEmail":"admin@seodirector.co","fromName":"SEO Director","timestamp":"2025-06-05 07:03:44.108 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mAbout to call SendGrid API[39m {"from":"SEO Director <admin@seodirector.co>","msgStructure":["to","from","subject","html","text","trackingSettings","tracking_settings","headers"],"subject":"Welcome to SEO Director! Please verify your email","timestamp":"2025-06-05 07:03:44.109 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mSendGrid API call completed[39m {"messageId":"_q-OJTq_Tu28syHqFgu65A","responseBody":"","responseHeaders":{"access-control-allow-headers":"Authorization, Content-Type, On-behalf-of, x-sg-elas-acl","access-control-allow-methods":"POST","access-control-allow-origin":"https://sendgrid.api-docs.io","access-control-max-age":"600","cache-control":"no-cache","connection":"keep-alive","content-length":"0","content-security-policy":"frame-ancestors 'none'","date":"Thu, 05 Jun 2025 11:03:44 GMT","referrer-policy":"strict-origin-when-cross-origin","server":"nginx","strict-transport-security":"max-age=31536000; includeSubDomains","x-content-type-options":"no-sniff","x-message-id":"_q-OJTq_Tu28syHqFgu65A","x-no-cors-reason":"https://sendgrid.com/docs/Classroom/Basics/API/cors.html"},"statusCode":202,"timestamp":"2025-06-05 07:03:44.461 AM"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully via SendGrid to nmang004@gmail.com[39m {"messageId":"_q-OJTq_Tu28syHqFgu65A","statusCode":202,"timestamp":"2025-06-05 07:03:44.461 AM"}
[32m[32minfo[32m[39m: 	[32mProvider send result[39m {"result":true,"timestamp":"2025-06-05 07:03:44.461 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mEmail sent successfully to nmang004@gmail.com via SendGrid[39m {"timestamp":"2025-06-05 07:03:44.461 AM"}
[32m[32minfo[32m[39m: 	[32msendWelcomeEmail result[39m {"result":true,"timestamp":"2025-06-05 07:03:44.461 AM","to":"nmang004@gmail.com"}
[32m[32minfo[32m[39m: 	[32mEmail verification sent successfully[39m {"email":"nmang004@gmail.com","timestamp":"2025-06-05 07:03:44.461 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[0mPOST /api/auth/register [32m200[0m 509.640 ms - 131[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749121811069_7a24g4hrk","ip":"::1","timestamp":"2025-06-05 07:10:11.071 AM","tokenPrefix":"aaa76376...","userAgent":"axios/1.9.0"}
[32m[32minfo[32m[39m: 	[32mToken validation successful[39m {"email":"nmang004@gmail.com","purpose":"email_verification","sequence":1,"timestamp":"2025-06-05 07:10:11.092 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80","validationTimeMs":18}
[32m[32minfo[32m[39m: 	[32mToken invalidated[39m {"affectedRows":1,"hashedTokenPrefix":"52e2cea4...","timestamp":"2025-06-05 07:10:11.114 AM"}
[32m[32minfo[32m[39m: 	[32mEmail verification successful[39m {"correlationId":"verify_1749121811069_7a24g4hrk","email":"nmang004@gmail.com","timestamp":"2025-06-05 07:10:11.115 AM","tokenPrefix":"aaa76376...","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[0mGET /api/secure-auth/verify-email/aaa76376c53cf903a027817bc1f516aff273a8c3120d70034ed44291f15e9b38 [32m200[0m 52.877 ms - 212[0m
[INFO] 07:11:19 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/secure-token-auth.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:11:19.327 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:11:19.330 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:11:19.330 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:11:19.332 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:11:19.351 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:11:19.352 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:11:19.357 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:11:20.358 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:11:20.359 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:11:20.362 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:11:20.364 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:11:20.369 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:11:20.369 AM"}
[31m[31merror[31m[39m: 	[31mError closing HTTP server: Server is not running.[39m {"code":"ERR_SERVER_NOT_RUNNING","stack":"Error: Server is not running.\n    at Server.close (node:net:2358:12)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitCloseNT (node:net:2418:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)","timestamp":"2025-06-05 07:11:20.372 AM"}
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:11:20.374 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:11:21.153 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:11:21.905 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:11:21.906 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:11:21.906 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:11:21.929 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:11:21.930 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDIX/Pt3NgyB/G4\nq9k1SHyq4bUYq2xPetpkcAg9bXCjgEkBgM01cRM6UmgPgndAE4pZKtjAm3ymuBMg\nPlhNFdEXelewFlR7tUIsdP+WFg4YU8/EYCGPROfb77A/YjC3YYZJ9pn9gic0wek1\nI/qXJa0ZEVlnl1ZvBRwaaO/xHc/2r1E4I/pq4RT3Z+nnesWq5mTs/jAXQoUr4xxi\nfFpvb4lrz3vmcRfdP8nV47U4/Sr2jNP8tArGcEAjy9hV/7FI9JoM3/2ZN+kpJmux\nJc+WnvRD1JKjpJbCPJy7BvTQpBXMkjgxUF1YkMuPAbAukl8Hq8AfbU8Kdn6c3/QR\ntO6yW2XHAgMBAAECggEAT8cMSp8MINdS4VDieTl0EWEuBjVyOS7Ttvt3/GUPXLmd\n15Bdo7Jyklzu+4XZTtS414mcpQsDFSniy4qnA4H1LuDR+tTZLCvdve+TN0FuuTbd\nWPVhRzaLDeEfjgzdEpYsrlQVuX5Rd8rgu/yoL/ebNIjYzMrPagJhzw4Kwjg5baBo\n9ii+EQxifU2WzKzqqDU9jYiSj5IbVCjqLCs2+LV+e8T77OGJvzD9K7PHo0MkScqJ\ndLDu0eSBPbjcCNa9hgWG5jcepqp1FmZxAqtILB5MJALibq1DMuydKuafN0+u1iYv\nAbc8IKWZyN49pz1UXIwwbeGd9JpjH07k5zGEK/lboQKBgQDyTVs71F07MJ+WKl7c\n6V3eAERY9gzLoJnXM53GjNpSR1/p23MnYsH/zVvIh3G+9BYkBwx7vy5A94EyLkL7\n+SslxkeWmiKQz4bjM8gOzJKkOr+IlCH51c3dws8GTUWyQl2eXbNWr7+B6wKyqhZJ\nlrKVeQzFykWjGcoAT3uvt9kndwKBgQDTs9DRF/o0v2nlBzHzjobP/WnPg9L3ttNH\nd96noC1S/kuvQvglCfsQJWzNsK7zwZCvKaO3smiXmG2ZMqEvRnnKBubX02JEKQse\nAlou9CcOF6G5veKbCbrylJ5grOFa7+0lOSBFJbID/L8lBZ44aLyGUF91YZWXH0SS\ngDNsqfHoMQKBgQCMTtsr1BeAtPFUhYiVJ9WhPkpVsXVLXN54zXzpgprR1l7mDpuq\nDPgF5qblgfkN+E3x4tsJtXVVTX1Uz5EeU/T2VNETloG5lVKosk2AtFmeHB7ZOd5K\ny9IAPlSfc5OOW/vWPrAg3HhrBOl1CCULy+XxxDzvM+gLQF3GvEAFStLGlQKBgQDM\n8dYkpfa2G9xTOSz1YTRHpEdL+o1A/D/7fyMQ2fMm1kHE0KtTiB8CWYjEc9ha6De+\nKyxwSIoSwCDR337FOo/qsdXGeMA3xhgaHCLcM8afUOdi3l3Cw5+0+YV9h7++fmjw\n0SXZaw2z6HnPSGoMp/Bigup2w1rC6yVCQlQGTVt/8QKBgQCiSlc1nR4HN8coPZx0\nRd8Y80LrVLWM4c3mxES/tvc/haNIV0rguaXCGIJAQC3jv81Dg1TWOpcdkWvImajd\nNwRFFYvouXG/l6hFRYULsweIUTghyv6n5TXC9/m4TLoidrFlCRHSoHewq7vX64jO\nUJwYcH0v4t4HS+XJVL5sVwB5SA==\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyF/z7dzYMgfxuKvZNUh8\nquG1GKtsT3raZHAIPW1wo4BJAYDNNXETOlJoD4J3QBOKWSrYwJt8prgTID5YTRXR\nF3pXsBZUe7VCLHT/lhYOGFPPxGAhj0Tn2++wP2Iwt2GGSfaZ/YInNMHpNSP6lyWt\nGRFZZ5dWbwUcGmjv8R3P9q9ROCP6auEU92fp53rFquZk7P4wF0KFK+McYnxab2+J\na8975nEX3T/J1eO1OP0q9ozT/LQKxnBAI8vYVf+xSPSaDN/9mTfpKSZrsSXPlp70\nQ9SSo6SWwjycuwb00KQVzJI4MVBdWJDLjwGwLpJfB6vAH21PCnZ+nN/0EbTusltl\nxwIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:11:22.041 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:11:22.098 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:11:22.098 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:11:22.099 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:11:22.101 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:11:22.101 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"2ms","timestamp":"2025-06-05 07:11:22.140 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:11:22.147 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:11:22.147 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:11:22.148 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:11:22.148 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:11:22.148 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:11:22.152 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:11:22.152 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:11:22.253 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:11:22.253 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:11:22.253 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:11:22.254 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:11:22.254 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:11:22.254 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:11:22.254 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:11:22.260 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:11:22.262 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:11:22.262 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:11:22.262 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:11:22.262 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:11:22.263 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:11:22.263 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:11:22.263 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:11:22.263 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:11:22.263 AM"}
✅ Server started successfully on port 4000
[32m[32minfo[32m[39m: 	[32mRegistration attempt started[39m {"correlationId":"reg_1749121892637_nlmclvrmm","email":"token-test@example.com","ip":"::1","name":"Token Test User","timestamp":"2025-06-05 07:11:32.637 AM","userAgent":"axios/1.9.0"}
[32m[32minfo[32m[39m: 	[32mCreating new user[39m {"correlationId":"reg_1749121892637_nlmclvrmm","email":"token-test@example.com","timestamp":"2025-06-05 07:11:32.884 AM"}
[32m[32minfo[32m[39m: 	[32mSending verification email[39m {"correlationId":"reg_1749121892637_nlmclvrmm","email":"token-test@example.com","isNewUser":true,"timestamp":"2025-06-05 07:11:32.915 AM","userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[32m[32minfo[32m[39m: 	[32mStarting verification email send[39m {"correlationId":"email_1749121892915_ngi7pb52l","email":"token-test@example.com","name":"Token Test User","timestamp":"2025-06-05 07:11:32.915 AM","userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
=== STORING TOKEN DEBUG ===
Email: token-test@example.com
HashedToken prefix: ae793b5b140869c9...
UserId: 15dd73a1-2133-44d7-93fc-a935290e9e06
Purpose: email_verification
Sequence: 1
ExpiresAt: 2025-06-05T12:11:32.915Z
Creating token with data: {
  hashedToken: 'ae793b5b140869c9a0b291db326bc78f890cf7d5e5f816452cb53a9e36c3a6fe',
  userId: '15dd73a1-2133-44d7-93fc-a935290e9e06',
  email: 'token-test@example.com',
  purpose: 'email_verification',
  sequence: 1,
  expiresAt: 2025-06-05T12:11:32.915Z,
  isValid: true,
  createdAt: 2025-06-05T11:11:32.915Z
}
✅ Token stored successfully: {
  id: '4a563f1a-d8a7-4d1e-9a50-92d60bede6f3',
  email: 'token-test@example.com',
  hashedTokenPrefix: 'ae793b5b140869c9...'
}
✅ Token verified in database: {
  id: '4a563f1a-d8a7-4d1e-9a50-92d60bede6f3',
  email: 'token-test@example.com',
  isValid: true,
  expiresAt: 2025-06-05T12:11:32.915Z
}
[32m[32minfo[32m[39m: 	[32mSecure token generated[39m {"email":"token-test@example.com","expiresAt":"2025-06-05T12:11:32.915Z","generationTimeMs":16,"hashedTokenPrefix":"ae793b5b...","purpose":"email_verification","sequence":1,"timestamp":"2025-06-05 07:11:32.931 AM","tokenLength":64,"userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[32m[32minfo[32m[39m: 	[32mFresh token generated for email[39m {"correlationId":"email_1749121892915_ngi7pb52l","email":"token-test@example.com","expiresAt":"2025-06-05T12:11:32.915Z","timestamp":"2025-06-05 07:11:32.931 AM","tokenPrefix":"697bf974...","tokenSequence":1,"userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[32m[32minfo[32m[39m: 	[32mSending email via SendGrid[39m {"correlationId":"email_1749121892915_ngi7pb52l","templateId":"d-seo-verification-template","timestamp":"2025-06-05 07:11:32.931 AM","to":"token-test@example.com","tokenPrefix":"697bf974...","trackingDisabled":true}
[31m[31merror[31m[39m: 	[31mSendGrid email send failed[39m {"correlationId":"email_1749121892915_ngi7pb52l","error":"Bad Request","responseBody":{"errors":[{"field":"template_id","help":"http://sendgrid.com/docs/API_Reference/Web_API_v3/Mail/errors.html#message.template_id","message":"The template_id must be a valid GUID, you provided 'd-seo-verification-template'."},{"field":"subject","help":"http://sendgrid.com/docs/API_Reference/Web_API_v3/Mail/errors.html#message.subject","message":"The subject is required. You can get around this requirement if you use a template with a subject defined or if every personalization has a subject defined."},{"field":"content","help":"http://sendgrid.com/docs/API_Reference/Web_API_v3/Mail/errors.html#message.content","message":"Unless a valid template_id is provided, the content parameter is required. There must be at least one defined content block. We typically suggest both text/plain and text/html blocks are included, but only one block is required."}]},"statusCode":400,"timestamp":"2025-06-05 07:11:33.296 AM"}
[31m[31merror[31m[39m: 	[31mVerification email send failed[39m {"correlationId":"email_1749121892915_ngi7pb52l","email":"token-test@example.com","error":"Bad Request","timestamp":"2025-06-05 07:11:33.296 AM","totalTimeMs":381,"userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[31m[31merror[31m[39m: 	[31mFailed to send verification email[39m {"correlationId":"reg_1749121892637_nlmclvrmm","email":"token-test@example.com","error":"Bad Request","timestamp":"2025-06-05 07:11:33.296 AM","userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[0mPOST /api/secure-auth/register [31m500[0m 660.756 ms - 61[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749121942046_xjcchxx8g","ip":"::1","timestamp":"2025-06-05 07:12:22.046 AM","tokenPrefix":"3a983207...","userAgent":"axios/1.9.0"}
[32m[32minfo[32m[39m: 	[32mToken validation successful[39m {"email":"token-test@example.com","purpose":"email_verification","sequence":2,"timestamp":"2025-06-05 07:12:22.055 AM","userId":"15dd73a1-2133-44d7-93fc-a935290e9e06","validationTimeMs":8}
[32m[32minfo[32m[39m: 	[32mToken invalidated[39m {"affectedRows":1,"hashedTokenPrefix":"a238b096...","timestamp":"2025-06-05 07:12:22.075 AM"}
[32m[32minfo[32m[39m: 	[32mEmail verification successful[39m {"correlationId":"verify_1749121942046_xjcchxx8g","email":"token-test@example.com","timestamp":"2025-06-05 07:12:22.076 AM","tokenPrefix":"3a983207...","userId":"15dd73a1-2133-44d7-93fc-a935290e9e06"}
[0mGET /api/secure-auth/verify-email/3a983207d458477aac59ae0f3b4e2a6937542325d1ca72f8c30c2e76b247dced [32m200[0m 39.286 ms - 216[0m
[32m[32minfo[32m[39m: 	[32mResend verification attempt[39m {"correlationId":"resend_1749122037357_l6kkcflzp","email":"nmang004@gmail.com","ip":"::1","timestamp":"2025-06-05 07:13:57.357 AM"}
[33m[33mwarn[33m[39m: 	[33mResend verification failed - already verified[39m {"correlationId":"resend_1749122037357_l6kkcflzp","email":"nmang004@gmail.com","timestamp":"2025-06-05 07:13:57.362 AM","userId":"2e3b439a-fe9c-4070-ab79-14cb079efc80"}
[0mPOST /api/secure-auth/resend-verification [33m400[0m 5.428 ms - 53[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749122046488_dhgqncmgs","ip":"::1","timestamp":"2025-06-05 07:14:06.488 AM","tokenPrefix":"90bd137b...","userAgent":"curl/8.7.1"}
[33m[33mwarn[33m[39m: 	[33mToken validation failed - not found or expired[39m {"hashedTokenPrefix":"008c43f0...","purpose":"email_verification","timestamp":"2025-06-05 07:14:06.491 AM","validationTimeMs":3}
[33m[33mwarn[33m[39m: 	[33mEmail verification failed - invalid token[39m {"correlationId":"verify_1749122046488_dhgqncmgs","error":"Invalid or expired verification token","timestamp":"2025-06-05 07:14:06.491 AM","tokenPrefix":"90bd137b..."}
[0mGET /api/secure-auth/verify-email/90bd137b2886e58430f78cbc28127f003f5f366101cba6467379f473ef26481 [33m400[0m 4.138 ms - 65[0m
[32m[32minfo[32m[39m: 	[32mEmail verification attempt[39m {"correlationId":"verify_1749122054001_52tv8dlzd","ip":"::1","timestamp":"2025-06-05 07:14:14.001 AM","tokenPrefix":"90bd137b...","userAgent":"curl/8.7.1"}
[33m[33mwarn[33m[39m: 	[33mToken validation failed - not found or expired[39m {"hashedTokenPrefix":"008c43f0...","purpose":"email_verification","timestamp":"2025-06-05 07:14:14.003 AM","validationTimeMs":1}
[33m[33mwarn[33m[39m: 	[33mEmail verification failed - invalid token[39m {"correlationId":"verify_1749122054001_52tv8dlzd","error":"Invalid or expired verification token","timestamp":"2025-06-05 07:14:14.003 AM","tokenPrefix":"90bd137b..."}
[0mGET /api/secure-auth/verify-email/90bd137b2886e58430f78cbc28127f003f5f366101cba6467379f473ef26481 [33m400[0m 3.271 ms - 65[0m
[INFO] 07:17:00 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/secure-token-auth.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:17:00.765 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:17:00.772 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:17:00.774 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:17:00.777 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:17:00.894 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:17:00.895 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:17:00.903 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:17:01.906 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:17:01.908 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:17:01.912 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:17:01.913 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:17:01.927 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:17:01.927 AM"}
[31m[31merror[31m[39m: 	[31mForceful shutdown due to timeout[39m {"timestamp":"2025-06-05 07:17:11.928 AM"}
❌ Forceful shutdown due to timeout
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:17:11.930 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:17:12.757 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:17:13.632 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:17:13.634 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:17:13.634 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:17:13.653 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:17:13.653 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCT+fhX+j5R/p09\nmT+ocRURdw4AbVSdrUst0DmhDPKI//ch/MSz+mPN+a6i1+sONOgexutp3I00nAFq\nTqeEz6rTIRL+Q2Gxbzdac2ieZOApn7GpyZz7tLMjYHLi1iNGACda+AzX5Pp0d76X\nVRVdsqIQjeCUoOvADFDRDPZ2zre+Qr1L3dLNgoA9cIJDWdQxs2U5P8vk7yitAsUR\nnWFkd7B+BOfeN5gGZA6VJLaX2ip5RwYcLFZqaIBmrr92cbpVasthAQkw9xO4QHvz\nrkUpty/rn+D+U9WJa+uiel+P3m8MUaVVXxCYn7orb8zTjzwc7a5fBpkm+PnePzNP\nxg6NS4eDAgMBAAECggEABCpbtszztybV3KI1PAke4N8l6kDUSnH9NUdwxTCnnSVT\ncBtSRYditYLLSzM3ydkXFagKKsXgxbPZ3a5kIdAfYhJtcJyLTKLcVIlTecNOL23F\njbQqsp0wvmoHIeKJm1Ktc5lFnJ2J/VWnlvv3/itlS4EAQD7Svr+6AKsplEjtEYfQ\nHE2rXgG55dxhiBBLxLmS43nU/7qqaJhOFiKlX2S9Zgwhk7EcljXZb8MNuEZggmc5\nEtSl5kcoGKagd1qJkDKKMq7HY18PaWdVXoj9CH8B5o1PgvVEIaRJ8E3xtaqk2hws\nbs56/o4O8Gyd0oG/m3Jf5O03HnCo9QNXRWceAXjKRQKBgQDN93PA06fa3yKbWv1g\n5hWzxf5ZPbtvIbBu2AX3ap6RAW74arp3CPTutl7FiPtDK0z98nzh3hJ8OdAlPSQk\nbmieaooh6fNnB2RfhtAmC+4rxh6QMbvp3zqQBHYh/3/nO/M7uMiVLA9eGTTT5XKy\ng71mAzNUPrGXQG7f11BRQYEnNQKBgQC37EE56ofWzaAQ/AsoJpZefAN4IDq2nfqo\nZ+JG7p2ZHxOSFhK543KM1Q+bEfTV2cBJDTUlvUoZkmpM4z6cQMaXFnnySdfU3l03\nzbMkEVwrLYBKCCG50HrqcNF5K/I4nNwm0l8kY8qMtgkq3mXh8SsxiUGDKyYAzwjJ\nmI2wcqZy1wKBgQDEEr7CIXvY87SpOoydk0uzsVe6MvddCzA/xSyg5YIAPuIaYNgT\n+5XYLgq4d/ficLVBx3c1OkhUtGC/Ip5mhCjaLkhDksjhGvtlqRw8K/1W9Ksh0Aa4\n1IaWlXi0Utu7EKoz/2wL/j6+8LYGxpZS9PD3zTIvD+PWPkOOmhXe1MITxQKBgQCD\ncuffM76oB8gpu2lh5co8dxenqCkuUVRPPgfbuDiMskgzdXEmx+cbvj7sDnZUzM7/\npt/gPBwUkK9Ginc6B5WncBnxz1LhQZeQBYTN91ZPSbLRtmQcQGNI4R7lIkJ4sasq\nV9pF0Mh3rrZ4nABm7g131ugqjhEYLN/T7SL/A8HwewKBgC40Q20YMmDfT44o+XpV\nJh3yJxPF5Y7GAG9vdmkDLxs0Gu1I2WkP1+MmBsXsLBUZ1fjEgrwd+JqvuJ9F8QN8\nLe9I1PDlW+2ySnpFU421MD0TeJrwxSMiWKc5GczHxiqph6me+IMesmVhb5OEMl74\nRloaJv5SxCHtf5wx70htTSja\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAk/n4V/o+Uf6dPZk/qHEV\nEXcOAG1Una1LLdA5oQzyiP/3IfzEs/pjzfmuotfrDjToHsbradyNNJwBak6nhM+q\n0yES/kNhsW83WnNonmTgKZ+xqcmc+7SzI2By4tYjRgAnWvgM1+T6dHe+l1UVXbKi\nEI3glKDrwAxQ0Qz2ds63vkK9S93SzYKAPXCCQ1nUMbNlOT/L5O8orQLFEZ1hZHew\nfgTn3jeYBmQOlSS2l9oqeUcGHCxWamiAZq6/dnG6VWrLYQEJMPcTuEB7865FKbcv\n65/g/lPViWvronpfj95vDFGlVV8QmJ+6K2/M0488HO2uXwaZJvj53j8zT8YOjUuH\ngwIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:17:13.742 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:17:13.812 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:17:13.812 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:17:13.813 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:17:13.814 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:17:13.816 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"2ms","timestamp":"2025-06-05 07:17:13.872 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:17:13.882 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:17:13.882 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:17:13.884 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:17:13.884 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:17:13.884 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:17:13.888 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:17:13.888 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:17:13.989 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:17:13.989 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:17:13.989 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:17:13.990 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:17:13.990 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:17:13.990 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:17:13.990 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:17:13.996 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:17:14.000 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:17:14.000 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:17:14.000 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:17:14.000 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:17:14.001 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:17:14.001 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:17:14.001 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:17:14.001 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:17:14.001 AM"}
✅ Server started successfully on port 4000
[INFO] 07:18:40 Restarting: /Users/nicholasmangubat/CascadeProjects/seodirector/backend/src/controllers/secure-token-auth.controller.ts has been modified

--- Received SIGTERM, starting graceful shutdown ---
[32m[32minfo[32m[39m: 	[32mReceived SIGTERM, starting graceful shutdown[39m {"timestamp":"2025-06-05 07:18:40.931 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:18:40.936 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:18:40.936 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down enhanced worker...[39m {"timestamp":"2025-06-05 07:18:40.937 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker shutdown complete[39m {"timestamp":"2025-06-05 07:18:40.942 AM"}
[32m[32minfo[32m[39m: 	[32mShutting down WebSocket Gateway...[39m {"timestamp":"2025-06-05 07:18:40.943 AM"}
[32m[32minfo[32m[39m: 	[32mBroadcasted system update: System Maintenance[39m {"timestamp":"2025-06-05 07:18:40.947 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway shutdown completed[39m {"timestamp":"2025-06-05 07:18:41.949 AM"}
[32m[32minfo[32m[39m: 	[32mClosing Enhanced Queue Adapter...[39m {"timestamp":"2025-06-05 07:18:41.949 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Queue Adapter closed[39m {"timestamp":"2025-06-05 07:18:41.951 AM"}
[33m[33mwarn[33m[39m: 	[33mRedis connection closed - queue functionality disabled[39m {"timestamp":"2025-06-05 07:18:41.951 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:18:41.963 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System shutdown completed[39m {"timestamp":"2025-06-05 07:18:41.963 AM"}
[31m[31merror[31m[39m: 	[31mForceful shutdown due to timeout[39m {"timestamp":"2025-06-05 07:18:51.964 AM"}
❌ Forceful shutdown due to timeout
Process exiting with code: 1
[31m[31merror[31m[39m: 	[31mProcess exiting with code: 1[39m {"timestamp":"2025-06-05 07:18:51.965 AM"}
--- Backend process starting ---
--- http imported ---
--- express imported ---
--- socket.io imported ---
--- cors imported ---
--- helmet imported ---
--- morgan imported ---
--- redis imported ---
--- Loading config.ts ---
--- Validating environment variables ---
--- Environment variables validated successfully ---
--- logger imported ---
--- errorHandler imported ---
[32m[32minfo[32m[39m: 	[32mLoaded existing RSA keys for JWT signing[39m {"timestamp":"2025-06-05 07:18:52.713 AM"}
AuthRateLimiter using memory backend
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:18:53.441 AM"}
[32m[32minfo[32m[39m: 	[32mStarting enhanced worker...[39m {"timestamp":"2025-06-05 07:18:53.442 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker started successfully[39m {"timestamp":"2025-06-05 07:18:53.442 AM"}
[32m[32minfo[32m[39m: 	[32mSendGrid provider configured successfully[39m {"timestamp":"2025-06-05 07:18:53.463 AM"}
[32m[32minfo[32m[39m: 	[32mEmail service initialized with SendGrid provider[39m {"timestamp":"2025-06-05 07:18:53.463 AM"}
JWT keys not found in environment, generating new ones for development
Generated JWT Keys (save these to environment variables):
JWT_PRIVATE_KEY= "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCcQTM7Co0cn5Yk\n0Cumsbn4g67kKCrLYO1VS/4aNuiSrDQrRqAL+JCXgeXKy/r2Emc5Rw1b5Ckk9veM\nQlxQmzKvCAvxKbe/bsdTow398yOzTvTogV5ly63VCenjqWqJiFlkhl06zeKnVDCb\naSL08tP3wedYZ8nOnjdpra+yimbzMjxkXBzIgb8qUqApDAXfhlbLfX7vnC5swFki\nIE7vMpvx09jq9WtJqRelgFlLWkXAOm0LCxCVLZQXy78LyqHVj4ANVaTOnWukfuss\n6gzXJ4f5yf6r00CU5qtL3FG+EI8UocO6SM0zpMx6E5Rle6dgfUK6+LX8405J5Q+z\nTzgmxThVAgMBAAECggEABscUp/H1XLYNrekbZwoOyJk8g9FONnh1/B0J4L83jDZM\n20n60KodWA4wzVwf/sed3J29X1Ep1Nx+sKZehwNo7mZkz1uTv4mPTUNKEV5O92hH\nyLIJky/xQDVoBMhyVLkqWKAPZujd4rB6nPxDxg0UHGalfQINx5kCJpnEyaqBM0Jp\nSXNWs6xN2QN29fposKqNt8RgBbe6eFG2K3AkTvDNtN9nVjr4aPqzk+ztaPDM/9L4\ncThajX1RZUvVgnjHnTh2OBDqU3nW9Oqm08H0n3L13o9udliCWXISp0+EVsayUNKx\nENKdhmERZZ7cVbcQZtELaWH916afeI8/L2iOY4r7/QKBgQDciX5AN6dRG6MuV80k\nY+nXphsX6IijVuD8FHXCj2gzOOhkBPR0zEUYlLOUX2ZvEmCQYZUhuLODqkCh0tfV\nfjVPS/gleyqNHUBN8f1C9fTcn9OOzGAKpUVANUxVKeBGCLGffwzkMUxgb3GL9QYA\nRIMznFWl6SIiIztFkUQ/acbxrwKBgQC1YX5gfrnY9l4+RCKU/m0UlRUg8Z1CPV1O\nXGkMxaHt1u/JP5ftUlWaC34bu8eqazaU3wKbMFEMUfP+deOzKhlwqNhpnP7kJYGP\nkb6U+yiKqoWOyB2VS5cDtZV1x3B/vYM2BBJw2dGeCYDbtRjLuIq3ytmGkesC4GuS\nZPbHbkcLOwKBgQDNIN5boOhyGsDXdDeNp5l0Sj5dKJ8fPsoZ7nXyOC11p3MQxUMT\n+IQ0buvyECJZIcDLythJ+2COESf43QKAw9mWHlV7l2pmw1Ryq6kkRV4ycD75TcPv\nYvZc2LZdaIwA2ElOz4AQKIKgGEiHI6snSJK4yKspnQVwt1CETrAqQ5sWZQKBgQCn\nnV/fJlzyXcH7wpU+oNwGwDpVRlJwCys1pfpCHkSk+RKAJK9uVb7bazFvyZkbKJa4\n/ll3NjA/tWBIT4NLZ2U5Eh9jgfyesvZGyYWYQX1Wn3xq1Q1ZkRAOEnj67YJN2cDu\nYtbzyKaIZ/nXj0RJxtESRXe9fwzxjJh8IadX5tXqTwKBgENpRrAahdxjVolL4SGK\nXd+w2eNhQVAtTOyn5aKuEby541/QBZ2f+NaDk5+Cgip4nhQRCE5Dd90mSqmYfY1j\nqeLHnhuZbFGaCDbWepWaPmllShfHD8oOE+D6niUvBuZ4gUK88PeFFz01p9kM3ktF\ndXl7xPkBnmuC3+cuLLS88gJ0\n-----END PRIVATE KEY-----\n"
JWT_PUBLIC_KEY= "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnEEzOwqNHJ+WJNArprG5\n+IOu5Cgqy2DtVUv+Gjbokqw0K0agC/iQl4Hlysv69hJnOUcNW+QpJPb3jEJcUJsy\nrwgL8Sm3v27HU6MN/fMjs0706IFeZcut1Qnp46lqiYhZZIZdOs3ip1Qwm2ki9PLT\n98HnWGfJzp43aa2vsopm8zI8ZFwcyIG/KlKgKQwF34ZWy31+75wubMBZIiBO7zKb\n8dPY6vVrSakXpYBZS1pFwDptCwsQlS2UF8u/C8qh1Y+ADVWkzp1rpH7rLOoM1yeH\n+cn+q9NAlOarS9xRvhCPFKHDukjNM6TMehOUZXunYH1Cuvi1/ONOSeUPs084JsU4\nVQIDAQAB\n-----END PUBLIC KEY-----\n"
[32m[32minfo[32m[39m: 	[32mEnhanced email service initialized[39m {"configured":true,"templatesEnabled":true,"timestamp":"2025-06-05 07:18:53.694 AM"}
--- Config loaded successfully ---
--- Express app and server initialized ---
--- Initializing Redis client ---
--- Redis client initialized ---
--- Initializing Database Manager ---
--- OpenAPI spec loaded successfully ---
--- startServer: BEGIN ---
--- Attempting Redis connection ---
--- After startServer() call ---
--- Redis connected successfully ---
[32m[32minfo[32m[39m: 	[32mConnected to Redis[39m {"timestamp":"2025-06-05 07:18:53.758 AM"}
--- Attempting database connection via Database Manager ---
[32m[32minfo[32m[39m: 	[32mAttempting database connection (attempt 1/5)[39m {"connectionString":"postgresql://nicholasmangubat@localhost:5432/rival_outranker","poolSize":25,"timeout":30000,"timestamp":"2025-06-05 07:18:53.758 AM"}
Redis client connected successfully in rate-limit middleware
Upgraded rate limiters to use Redis
Redis client connected successfully in rate-limit middleware
[32m[32minfo[32m[39m: 	[32mConnected to Redis for JWT service[39m {"timestamp":"2025-06-05 07:18:53.759 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:18:53.760 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase info: Starting a postgresql pool with 17 connections.[39m {"target":"quaint::pooled","timestamp":"2025-06-05 07:18:53.760 AM"}
[32m[32minfo[32m[39m: 	[32m✅ Database connected successfully[39m {"attempt":1,"connectionPoolSize":25,"database":"rival_outranker","pgVersion":"15.13","responseTime":"1ms","timestamp":"2025-06-05 07:18:53.794 AM"}
[32m[32minfo[32m[39m: 	[32mpg_stat_statements extension enabled for query monitoring[39m {"timestamp":"2025-06-05 07:18:53.800 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase optimized for SEO analysis workloads[39m {"effectiveCacheSize":"2GB","optimizations":13,"timestamp":"2025-06-05 07:18:53.801 AM","workMem":"256MB"}
--- Database Manager connected successfully ---
[32m[32minfo[32m[39m: 	[32mInitializing Enhanced Analysis System...[39m {"timestamp":"2025-06-05 07:18:53.802 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced queue adapter...[39m {"timestamp":"2025-06-05 07:18:53.802 AM"}
[32m[32minfo[32m[39m: 	[32mConnecting to Redis for queue: redis://localhost:6379[39m {"timestamp":"2025-06-05 07:18:53.802 AM"}
[32m[32minfo[32m[39m: 	[32mQueue adapter initialized and healthy[39m {"timestamp":"2025-06-05 07:18:53.806 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing WebSocket gateway...[39m {"timestamp":"2025-06-05 07:18:53.806 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket Gateway initialized[39m {"timestamp":"2025-06-05 07:18:53.907 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway initialized[39m {"timestamp":"2025-06-05 07:18:53.907 AM"}
[32m[32minfo[32m[39m: 	[32mInitializing enhanced worker...[39m {"timestamp":"2025-06-05 07:18:53.907 AM"}
[32m[32minfo[32m[39m: 	[32mWorker event handlers configured[39m {"timestamp":"2025-06-05 07:18:53.908 AM"}
[32m[32minfo[32m[39m: 	[32mWorker initialized with concurrency: 5[39m {"timestamp":"2025-06-05 07:18:53.908 AM"}
[32m[32minfo[32m[39m: 	[32mSetting up queue cleanup every 3600000ms[39m {"timestamp":"2025-06-05 07:18:53.908 AM"}
[32m[32minfo[32m[39m: 	[32mValidating system health...[39m {"timestamp":"2025-06-05 07:18:53.908 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced worker is ready to process analysis jobs[39m {"timestamp":"2025-06-05 07:18:53.914 AM"}
[32m[32minfo[32m[39m: 	[32mDatabase connectivity verified[39m {"timestamp":"2025-06-05 07:18:53.917 AM"}
[32m[32minfo[32m[39m: 	[32mWebSocket gateway health verified[39m {"timestamp":"2025-06-05 07:18:53.917 AM"}
[32m[32minfo[32m[39m: 	[32mSystem health validation completed successfully[39m {"timestamp":"2025-06-05 07:18:53.917 AM"}
[32m[32minfo[32m[39m: 	[32mEnhanced Analysis System initialized successfully[39m {"timestamp":"2025-06-05 07:18:53.917 AM"}
[32m[32minfo[32m[39m: 	[32mSystem Status:[39m {"cleanupInterval":3600000,"initialized":true,"queueMetrics":{"active":0,"averageProcessingTime":300000,"completed":0,"delayed":0,"failed":0,"paused":0,"totalProcessingTime":0,"waiting":0},"timestamp":"2025-06-05 07:18:53.918 AM","webSocketEnabled":true,"workerConcurrency":5}
[32m[32minfo[32m[39m: 	[32mAnalysis system initialized successfully[39m {"timestamp":"2025-06-05 07:18:53.918 AM"}
[32m[32minfo[32m[39m: 	[32mServer is running on port 4000[39m {"timestamp":"2025-06-05 07:18:53.918 AM"}
[32m[32minfo[32m[39m: 	[32mEnvironment: development[39m {"timestamp":"2025-06-05 07:18:53.918 AM"}
[32m[32minfo[32m[39m: 	[32mAPI Documentation: http://localhost:4000/api-docs[39m {"timestamp":"2025-06-05 07:18:53.918 AM"}
✅ Server started successfully on port 4000
